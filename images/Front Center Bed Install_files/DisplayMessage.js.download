//>>built
require({cache:{"ws/mail/DisplayMessageWidget":function(){define("ws/mail/DisplayMessageWidget","dojo/_base/declare dojo/text!ws/mail/DisplayMessageWidget.html dojo/text!ws/mail/DisplayMessageWidget.css dojo/window dojo/on dojo/sniff dojo/query dojo/mouse dojo/topic dojo/string dojo/keys dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/request/iframe dojo/_base/kernel dojo/_base/array dojo/_base/lang dojo/_base/connect dijit/registry dijit/_Widget dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/selection ws/address/AddressModel ws/address/AddContactCard ws/mail/AddTaskCard ws/widget/Button ws/widget/WSMenu ws/widget/WSMenuItem ws/widget/WSMenuSeparator ws/widget/WSInputableMenuItem ws/calendar/CalendarViewModel ws/calendar/AddEventDialog ws/Spinner linkify/linkify-full dijit/layout/BorderContainer ws/mail/ComposeMessageWidget ws/widget/popup ws/calendar/CalendarViewModel ws/pictures/PictureViewControl ws/html ws/io ws/lang ws/reporting ws/string ws/widget/Dialogs ws/widget/Pane ws/widget/util ws/widget/WSToolbar".split(" "),
function(v,l,m,d,e,h,t,b,c,r,p,z,B,q,D,a,g,u,k,w,f,x,K,fa,E,na,I,jb,R,U,V,ga,L,W,ha,J){return v([x,K,fa],{templateString:l,css:{templateString:m},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,model:null,picturesModel:null,msgInfo:null,addEditDialog:null,calendarModel:null,extraBodyHtml:"\x3cstyle\x3e.AOLWebSuite .AOLAttachedImage {max-width:"+Config.InsertedPictureLongestEdge+"px; max-height:"+Config.InsertedPictureLongestEdge+"px;} .AOLWebSuite .AOLPicturesFullSizeLink { height: 1px; width: 1px; overflow: hidden; } .AOLWebSuite a {color:blue; text-decoration: underline; cursor: pointer} .AOLWebSuite a.hsSig {cursor: default} .AOLWebSuiteM1 {margin: 10px 20px 4px;} .AOLWebSuiteM2 {margin: 5px;} .AOLWebSuiteM3 {margin: 10px;} .dmItemSelected {padding: 2px !important;text-decoration: none !important;color:#fff !important;background-color: #656565 !important;border-radius: 2px;}\x3c/style\x3e",
microFormatStyles:"\x3clink rel\x3d'stylesheet' type\x3d'text/css' href\x3d'"+Config.BaseCssURL+"microformat.css'/\x3e",pictureViewControls:[],showNewWindowLink:!0,showFullMessageLink:!1,showSearchItems:!0,showToolbar:!0,beaconSuffix:"",isPopup:!1,isPreviewPane:!1,isStandAlone:!1,parentScrollNode:null,enableNextPrev:!0,enableFilters:!0,enableAddressActionMenu:!0,hideFeedbackDelay:7E3,enableBackToMail:!1,undoFeedbackCB:null,msgMarkedUp:!1,imagesRemoved:Settings.DisplayImageWarning,hideImages:Settings.DisplayImageWarning,
foldersOK:!1,kidTeenAccount:"Y"==ws.UserContext.ParentalControls||"K"==ws.UserContext.ParentalControls,lastDispMsgTime:0,addrMap:{},presenceCount:0,_handlers:[],bodyId:0,scheduleDisplayMessageHandle:null,flagHandler:null,startup:function(){this.isPopup&&_ws_isOpenerWS()?(this.idleSubscribe=opener.dojo.subscribe,this.addressModel=opener.ws.WebSuite.theAddressModel):this.isStandAlone?(this.idleSubscribe=c.subscribe,this.addressModel=new na({fetchDataOnInit:!0,sortable:!0})):(this.idleSubscribe=c.subscribe,
this.addressModel=ws.WebSuite.theAddressModel);this.actionButton.menu=this.actionMenu;q.add(this.messageArea.domNode,"needLayout");this.showToolbar?this.connect(this.toolbar,"wrap","wrapToolbar"):this.toolbar.hide();this.updateToolbarState();var a=this.showNewWindowLink&&ws.settings.allowPopups();ws.html.setShowing(this.newWindowLink,a);ws.html.setShowing(this.fullMessageLink,this.showFullMessageLink);this.defineActionMenu();this.connect(this.actionButton,"updateMenu","updateActionMenu");this.model&&
!this.isPopup&&(this.connect(this.model,"folderListChanged","updateFolderFlag"),this.connect(this.model,"moveListChanged","updateFolderFlag"),this.connect(this.model,"modelUpdated","updateNextPrevButtons"));this.backToMail.setShowing(this.enableBackToMail);c.subscribe("Suite/onKeyOnPress",k.hitch(this,"_suiteOnKeyPress"));c.subscribe("MessageList/flagMessage",k.hitch(this,"onMsgListFlagMessage"));Config.PrintingSupported||(this.printLink.style.display="none");a=this.isPreviewPane?"":" \x3cspan\x3e("+
Config.Strings.KeyMailPrint+")\x3c/span\x3e";this.printLink.setAttribute("title",Config.Strings.PrintMessage+a);a=this.isPreviewPane?"":" \x3cspan\x3e("+Config.Strings.KeyMailAddToCalendar+")\x3c/span\x3e";this.createEventLink.setAttribute("title",Config.Strings.CreateEvent+a);a=this.isPreviewPane?"":" \x3cspan\x3e("+Config.Strings.KeyMailAddToToDo+")\x3c/span\x3e";this.addToTaskLink.setAttribute("title",Config.Strings.CreateTodo+a);a=this.isPreviewPane?"":" \x3cspan\x3e("+Config.Strings.KeyMailPopout+
")\x3c/span\x3e";this.newWindowLink.setAttribute("title",Config.Strings.NewWindowTip+a);this.nextButtonNode.setTip(Config.Strings.NextMessage+" \x3cspan\x3e("+Config.Strings.KeyMailNext+")\x3c/span\x3e");this.prevButtonNode.setTip(Config.Strings.PreviousMessage+" \x3cspan\x3e("+Config.Strings.KeyMailPrevious+")\x3c/span\x3e");this.backButton.setTip(Config.Strings.MessageCloseTip+" \x3cspan\x3e("+Config.Strings.KeyMailClose+")\x3c/span\x3e");dojo.isIE&&t(".headerIcon",this.subjectContainer).forEach(function(a){var n=
a.innerHTML;a.innerHTML="";a.innerHTML=n});9>dojo.isSafari&&t(".subjectLine",this.domNode).style("top","6px");this.isPopup||this.isStandAlone?q.add(this.domNode,"popupWin"):ws.WebSuite.SidePanel.setupAdScroll(this.messageArea.domNode,"preview");this.model&&this.model.idleMonitor?this.idleMonitorStarted():this.idleSubscribe("IdleMonitor/started",k.hitch(this,"idleMonitorStarted"))},postCreate:function(){if(this.isPreviewPane){this.displayMessageAd&&this.displayMessageAd.block(!0);var a=this.headerArea;
this.layoutWidget.domNode.removeChild(a);z.place(a,this.messageArea.domNode,"first")}},setModel:function(a){this.model=a;this.statusDialog&&(this.statusDialog.model=a)},setPicturesModel:function(a){this.picturesModel=a;u.forEach(this.pictureViewControls,function(n){n.picturesModel=a})},onHide:function(){this.hidePopups();this.displayMessageAd&&this.displayMessageAd.block(!0);this.updateBtnsTimer&&(window.clearInterval(this.updateBtnsTimer),this.updateBtnsTimer=null)},hidePopups:function(){this.taskView&&
this.taskView.close()},scheduleDisplayMessage:function(a,f){this.folder=a;this.uid=f;this._scheduleDisplayMessage()},_scheduleDisplayMessage:function(){this.scheduleDisplayMessageHandle&&(this.disconnect(this.scheduleDisplayMessageHandle),this.scheduleDisplayMessageHandle=null);this.model.isLoading()?this.scheduleDisplayMessageHandle=this.connect(this.model,"modelUpdated","_scheduleDisplayMessage"):this.displayMessage()},displayMessage:function(a,b,M,g,d,u){a=a||this.folder;b=b||this.uid;d=(new Date).getTime();
var n=d-this.lastDispMsgTime;g=this.lastUid==b;if(!(g&&400>n)){(n=this.model.getUidData(b))&&(a=this.model.getFNameFromRow(n));a!==this.lastFolder&&(g=!1);g||(this.hideImages=this.imagesRemoved=Settings.DisplayImageWarning);ws.WebSuite.setLastReadMsg(a,b);this.readReportDone=!1;this.skipPreviewReportingOnRet=u;this.lastDispMsgTime=d;u=this.model.getFolderByName(a);var O=this.model.isFolderType(u,"DRAFT");O?(ws.html.setShowing(this.addToLinksNode,!1),ws.html.setShowing(this.editDraft,!0)):(ws.html.setShowing(this.addToLinksNode,
!0),ws.html.setShowing(this.editDraft,!1));this.lastFolder=a;this.lastUid=b;d=this.model.screenName;this.folder=a;this.uid=b;this.recipSNs=[];d==ws.UserContext.ActiveScreenName&&(Settings.ViewNewOld||"NewMail"!=this.folder&&"OldMail"!=this.folder?Settings.ViewNewOld&&"inbox"==this.folder.toLowerCase()&&(this.folder="NewMail"):this.folder=this.model.getInboxFolderName());c.publish("WSFeedbackStart",Config.Strings.MessageLoading);this.headerArea.style.visibility="hidden";this.slideShowBtn&&this.slideShowBtn.domNode&&
(this.slideShowBtn.domNode.style.display="none");this.model.isFolderType(u,"BULK")?g||this.imagesRemoved||(this.hideImages=this.imagesRemoved=!0):this.checkForImageBlock(b);this.fullHeaderState=Settings.DisplayFullHeader;this.savedScrollLeft=this.savedScrollTop=0;this.inlineComposeReset();!this.updateBtnsTimer&&this.isPopup&&(this.updateBtnsTimer=window.setInterval(k.hitch(this,"updateNextPrevButtons"),2E3));var r=f.byId("messageList");this.model.getMessage(this.uid,this.folder,this.imagesRemoved).then(k.hitch(this,
function(a){r&&r.previewPaneUidBucket[b]&&delete r.previewPaneUidBucket[b];var n=!1;!O&&this.model.isFolderType(a.message.folder,"DRAFT")&&(this.getComposeCB(k.hitch(this,function(a){this.setToolbarEnabled(!0);ws.WebSuite.composeSrc="displayDraft";a.openDraft("Draft",this.uid)})),n=!0);n||(this.messageReceived(this.uid,a),"NONE"!=this.model.getTypeName(this.msgInfo.message)&&ws.html.setShowing(this.addToLinksNode,!1));c.publish("WSFeedbackEnd",Config.Strings.MessageLoading);this.show();n||M&&M(b)}),
k.hitch(this,function(a){c.publish("WSFeedbackEnd",Config.Strings.MessageLoading);r&&(r.previewPaneUidBucket[b]?delete r.previewPaneUidBucket[b]:(window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.getMessage-displayMessage",a,"DisplayMessageWidget.js"),ws.widget.Dialogs.ok(Config.Strings.ErrorLoadingMessage,this.isPreviewPane?k.hitch(this,function(){this.messageArea.hide();r.selectChild(r.emptyPreview);this.layoutWidget.resize()}):k.hitch(this,
"backToList"))))}))}},messageReceived:function(a,f){if(a==this.uid){for(;0<this._handlers.length;)try{w.disconnect(this._handlers.pop())}catch(Q){}this.flagHandler&&(this.flagHandler.remove(),this.flagHandler=null);this.hidePopups();this.msgInfo=f;var n=f.message,b=this.model.getSenderInfo(n);this.msgInfo.message.flags.read=!0;this.fromAddressBook=this.msgInfo.message.flags.recent=!1;this.messageArea.show();this.addrMap={};this.presenceCount=0;this.fromMe=ws.UserContext.UserAddress==b.email;this.setupShortHeader();
this.setupFullHeader();this.setFullHeader(this.fullHeaderState);n.headers.subject||(n.headers.subject="");try{if(this.model.getSearchString()&&Config.HighlightSeachTermInMessageRead){var O=this.markupSearchString(n.headers.subject);this.subjectNode.innerHTML=O||Config.Strings.NoSubject}else ws.html.setInnerText(this.subjectNode,n.headers.subject||Config.Strings.NoSubject)}catch(Q){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"Exception in msg headers innerHTML",Q,"DisplayMessageWidget.js")}this.subjectContainer.style.display=
"";t(".flag",this.domNode).toggleClass("flagged",!!n.flags.flagged);this.updateInfoStrips();this.updateAttachments();this.updateActionMenu();this.bodyWritten=this.bodySetupDone=!1;this.writeBody();this.setToolbarEnabled(!0);h("ie")&&c.publish("toolbarLayoutUpdate");this.updateToolbarState();this.updateMargins();this.layout();this.headerArea.style.visibility="inherit";setTimeout(k.hitch(this,function(){this.messageArea.domNode.focus()}),0)}},onMouseMove:function(a){var n=f.byId("messageList");if(n&&
n.splitContainer){var b=D.position(this.bodyFrame);n.splitContainer.changeSizing(a,a.pageX+b.x,a.pageY+b.y)}},ampGenerateMessagingToken:function(){var a=null;try{var f=new Uint8Array(32);window.crypto&&window.crypto.getRandomValues(f);var b=String.fromCharCode.apply(null,Array.from(f)),a=btoa(b)}catch(P){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"Exception ampGenerateMessagingToken",P,"DisplayMessageWidget.js")}return a},ampMessageDefaultHandler:function(a,f){return Promise.resolve()},
ampIframeHeightHandler:function(a,f){f&&a&&"documentHeight"==a&&f.height&&(this.ampFrame.style.height=f.height+"px")},ampIframeLoadHandler:function(a){if(window.g_WS_ampMessagingImport&&window.g_WS_ampMessagingImport.Messaging){this.ampFrameLoadHandler&&(this.ampFrame.removeEventListener("load",this.ampFrameLoadHandler,!0),this.ampFrameLoadHandler=null);this.ampFrame.contentWindow.postMessage({amp:a},"*");a=this.ampFrame;var n=null;try{n=window.g_WS_ampMessagingImport.Messaging.waitForHandshakeFromDocument(window,
a.contentWindow,"null",this.messagingToken)}catch(M){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"AMP exception in Messaging.waitForHandshakeFromDocument",M);return}if(n)try{n.then(dojo.hitch(this,function(a){try{a.setDefaultHandler(dojo.hitch(this,this.ampMessageDefaultHandler)),a.registerHandler("documentHeight",dojo.hitch(this,this.ampIframeHeightHandler))}catch(P){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"AMP exception in registerHandler",P)}}),function(){window.ws_ErrLgr&&
ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"AMP waitForHandshakeFromDocument promise fail")})}catch(M){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"AMP exception calling waitForHandshakeFromDocument",M)}}else window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"AMP Messaging object missing"),this.bodyWritten=!1,this.writeBody(!0)},ampWriteBody:function(a){2==window.g_WS_ampMessagingJsULoadState?this._ampWriteBody(a):(this.ampMessagingLoadedFunc=dojo.hitch(this,this._ampWriteBody,
a),1!=window.g_WS_ampMessagingJsULoadState&&(window.g_WS_ampMessagingJsULoadState=1,a=document.createElement("script"),a.type="text/javascript",a.src=Config.AMPMailMessagingJsURL,a.onload=dojo.hitch(this,function(){window.g_WS_ampMessagingJsULoadState=2;this.ampMessagingLoadedFunc()}),document.getElementsByTagName("head")[0].appendChild(a)))},_ampWriteBody:function(a){try{this.frameLoaded=null;var n='\x3ciframe src\x3d"'+(Config.BaseSameDomainURL+"amp_viewer_handler?locale\x3d"+Config.PageLocale+
"\x26brand\x3d"+Config.UIVariant+"#origin\x3d"+encodeURIComponent(window.location.origin)+"\x26messagingToken\x3d"+encodeURIComponent(this.messagingToken)+"\x26visibilityState\x3dvisible")+'" data-test-id\x3d"amp-iframe-page" allow\x3d"'+Config.AMPMailIFrameFeaturePolicy+'"sandbox\x3d"'+Config.AMPMailIFrameSandbox+'"scrolling\x3d"no" class\x3d"displayMessage_ampIframe" /\x3e';this.bodyCont.innerHTML=n;var f=dojo.query("iframe",this.bodyCont);f&&f.length?(this.ampFrame=f[0],this.ampFrameLoadHandler=
dojo.hitch(this,this.ampIframeLoadHandler,a),this.ampFrame.addEventListener("load",this.ampFrameLoadHandler,!0)):(window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"AMP iframe create error"),this.bodyWritten=!1,this.writeBody(!0))}catch(P){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"AMP iframe create exception",P),this.bodyWritten=!1,this.writeBody(!0)}},ampAllowedBrowser:function(){!this.ampAllowedBrowserVersions&&Config.AMPMailAllowedBrowsers&&(this.ampAllowedBrowserVersions=
dojo.fromJson(Config.AMPMailAllowedBrowsers)||"");var a,f,b=this.ampAllowedBrowserVersions;if("object"==typeof b){a=ws.browser.isEdge();f=b.edge;if(a)return f&&a>=f;a=ws.browser.isOpera();f=b.opera;if(a)return f&&a>=f;a=dojo.isFF;f=b.ff;if(a)return f&&a>=f;a=dojo.isSafari;f=b.safari;if(a)return f&&a>=f;a=dojo.isChrome;f=b.chrome;if(a)return f&&a>=f}return!1},writeBody:function(a){if(this.msgInfo&&!this.bodyWritten){this.bodyWritten=!0;var f=this.msgInfo.message&&this.msgInfo.message.folder&&!this.model.isFolderType(this.msgInfo.message.folder,
"BULK"),n=this.msgInfo.simpleBody&&this.msgInfo.simpleBody.amp;if(Settings.UserHash<Config.AMPMailEnableThreshold&&Config.AMPMailMessagingJsURL&&!a&&Settings.AmpEmail&&n&&f&&!this.hasImagesBlocked()&&this.ampAllowedBrowser()&&(this.messagingToken=this.ampGenerateMessagingToken()))this.ampWriteBody(n),ws.reporting.reportDLAction("Mail-ReadMessage-AmpEmailViewed");else{a=this.msgInfo.simpleBody.html||this.msgInfo.simpleBody.text||"";"Draft"!=this.folder||Settings.UseRichEditor||(a=this.msgInfo.simpleBody.html);
if(this.msgInfo)var b=a.search(/<div class=.hChat/i),b=this.msgInfo.containsHchat=-1!=b;try{Config.EnableClientLinkification&&window.linkifyHtml&&(a=a.replace(/<!doctype[^]*?>|<meta[^]*?>|<.?head[^]*?>|<.?html[^]*?>/ig,""),a=linkifyHtml(a,{attributes:{rel:"noopener noreferrer"},className:"",ignoreTags:["style"]}))}catch(X){}a+="\x3c/div\x3e";f=0;try{f=D.getMarginBox(this.headerArea).h}catch(X){}this.bodyId++;n=['\x3cbody wsbdid\x3d"',this.bodyId,'" style\x3d"'];f&&(n.push("padding-top:"),n.push(f),
n.push("px; "));n.push('background-color: white;font-family: Arial,sans-serif;font-size: 10pt;border: 0px;" class\x3d"AOLWebSuite"\x3e');n.push(this.extraBodyHtml);b&&n.push(this.microFormatStyles);b=-1!=a.indexOf("\x3cbody")?a.replace(/(<body[^>]*>)/i,n.join("")):n.join("")+a+"\x3c/body\x3e";Config.BypassDownloadUrl&&13<dojo.isSafari&&(b=this.model.fixDownloadUrls(b));this.bodyCont.innerHTML=b;setTimeout(k.hitch(this,"onBodyLoaded"),0)}this.readReportDone||(this.readReportDone=!0,b=0,a=!1,Settings.PreviewPaneVisible&&
Settings.PreviewPaneVisible&&!Settings.ReadInPopup&&(b=1E3,a=!0),f="Read Message - "+this.beaconSuffix,ws.lang.setTimeout(this,k.hitch(this,function(a,f,n){f=ws.WebSuite.getCurrentViewId();this.skipPreviewReporting&&n&&("displayMessage"==f||"composeMessage"==f)||this.skipPreviewReportingOnRet||(n={msgId:this.msgInfo.message.id},n.msgImg=Settings.DisplayImageWarning?this.imagesRemoved?"off":"fixed":"on",ws.reporting.report(a,"Mail",n))}),b,f,this.skipPreviewReporting,a))}},onBodyDomReady:function(){this.bodySetupDone||
this.bodyReadySetup();this.initializeImages();this.scrollPosReset()},onBodyLoaded:function(){this.bodySetupDone||this.bodyReadySetup();this.setupAttachThumbs();this.initializeImages();this.updateInfoStrips();this.scrollPosReset();this.messageArea.domNode.scrollTop=0},bodyReadySetup:function(){this.bodySetupDone=!0;this._handlers.push(w.connect(this.bodyCont,"onclick",k.hitch(this,"onMailBodyClick")));this._handlers.push(w.connect(this.bodyCont,"onkeypress",k.hitch(this,function(a){this._suiteOnKeyPress(a)})));
this.enableNextPrev&&Config.EnableClientSideMessagePrefetch&&ws.lang.setTimeout(this,"_prefetchAdjacentMessages",2E3)},onShow:function(){this.inherited(arguments);this.domNode.style.display="";this.displayMessageAd&&!this.isPreviewPane&&this.displayMessageAd.block(!1);!this.isStandAlone&&this.model.getSearchString()&&ws.WebSuite.Navigation.showMnSearch(!0)},scrollPosReset:function(){},_prefetchAdjacentMessages:function(){this.model.prefetchAdjacentMessages(this.msgInfo.message.id)},onResized:function(){this.isShowing()&&
(this.inherited(arguments),this.resizeJamTimer&&clearTimeout(this.resizeJamTimer),this.resizeJamTimer=setTimeout(k.hitch(this,function(){this.updateMargins();this.layout();u.forEach(this.pictureViewControls,function(a){a.positionSelf()});this.imageSlideshow&&this.imageSlideshow.images&&this.imageSlideshow.images.length&&this.setImageSlideshow(0)}),50))},marginClasses:["AOLWebSuiteM2","AOLWebSuiteM2","AOLWebSuiteM3","AOLWebSuiteM1"],updateMargins:function(){this.bodyCont.className="AOLWebSuite "+this.marginClasses[ws.WebSuite.widthMode-
1]},layout:function(){if(this.isShowing()){this.toolbar.layout();var a=D.getMarginBox(this.toolbar.domNode).h,f=D.getMarginBox(this.headerArea).h;this.isPreviewPane&&(a=f=0);this.messageArea.domNode.style.top=a+f+"px"}},popoutLayout:function(){var a=D.getMarginSize(this.toolbar.domNode).h+D.getMarginSize(this.messageArea.domNode).h;if(this.layoutWidget._contentBox.h<a)this.onResized()},getButtonConfig:function(){this.folderData=this.model.getFolderByName(this.folder);if(!this.folderData)return!1;
this.buttonViz=this.model.getButtonViz(this.folderData);return!0},updateToolbarState:function(){this.model&&this.showToolbar&&this.getButtonConfig()&&(this.spamButton.setShowing(this.buttonViz[4]&&Config.EnableSpamButton),this.notSpamButton.setShowing(this.buttonViz[5]&&Config.EnableSpamButton),this.restoreButton.setShowing(this.buttonViz[8]||this.model.isFolderType(this.folderData,"TRASH")&&Settings.ViewNewOld),this.keepNewButton.setShowing(this.buttonViz[12]&&Settings.ViewNewOld),this.updateNextPrevButtons())},
updateNextPrevButtons:function(){!this.updateBtnsTimer||this.domNode&&"none"!=this.domNode.style.display||(window.clearInterval(this.updateBtnsTimer),this.updateBtnsTimer=null);var a=this.model&&this.model.activeCachedList&&this.msgInfo&&this.enableNextPrev;this.nextButtonNode&&this.nextButtonNode.domNode&&q.toggle(this.nextButtonNode.domNode,"btnDisabled",!a||null==this.model.getAdjacentMessageUid(this.msgInfo.message.id,1));this.prevButtonNode&&this.prevButtonNode.domNode&&q.toggle(this.prevButtonNode.domNode,
"btnDisabled",!a||null==this.model.getAdjacentMessageUid(this.msgInfo.message.id,-1))},setToolbarEnabled:function(a){u.forEach(this.toolbar.getChildren(),function(f){f.enable&&f.setEnabled(a)});q.add(this.nextButtonNode.domNode,"btnDisabled");q.add(this.prevButtonNode.domNode,"btnDisabled")},updateSearchInfo:function(){this.model.getSearchString()?ws.WebSuite.Navigation&&!this.isPopup&&ws.WebSuite.Navigation.searchActive(!0,this.searchInfoPane):ws.WebSuite.Navigation&&!this.isPopup&&ws.WebSuite.Navigation.searchActive(!1,
this.searchInfoPane)},showFullHeader:function(a){this.fullHeaderState=!0;this.setFullHeader(this.fullHeaderState);this.layout();a.stopPropagation()},showShortHeader:function(a){this.fullHeaderState=!1;this.setFullHeader(this.fullHeaderState);this.layout();a.stopPropagation()},setFullHeader:function(a){var f=this.msgInfo.message.headers;q.toggle(this.subjectContainer,"subjectShort",!a);ws.html.setShowing(this.shortHeaderContainer,!a);this.fullDateField.innerHTML="\x3cspan class\x3d'time'\x3e"+ws.date.formatDateTime(new Date(1E3*
parseInt(f.internalDate,10)),Config.Strings.MsgViewDateFormat)+"\x3c/span\x3e";ws.html.setShowing(this.hideLink,a);ws.html.setShowing(this.fullFromTable,a);ws.html.setShowing(this.fromRow,a);ws.html.setShowing(this.toRow,a&&0<f.to.length);ws.html.setShowing(this.ccRow,a&&0<f.cc.length);ws.html.setShowing(this.bccRow,a&&0<f.bcc.length)},createHdrAddress:function(a,f,b,c,g,d,u){var n=document.createElement("span");q.add(n,"addressItem");u&&(q.add(n,"fromAddress"),n.innerHTML='\x3cspan class\x3d"flag"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconFlag"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/span\x3e');
d&&d.appendChild(n);d=document.createElement("span");n.appendChild(d);this.enableAddressActionMenu&&(d.onclick=k.hitch(this,this.onAddressSelect,a,d),q.add(d,"address wsItem"),ws.html.addHoverClass(d,"wsItemHover"));a=document.createElement("span");a.innerHTML=f;q.add(a,"addressDispForm");d.appendChild(a);c&&(d.appendChild(document.createTextNode(" ")),g&&(b+=","),d.appendChild(document.createTextNode(b)));u&&(this.flagHandler=t(".flag",this.domNode).on("click",k.hitch(this,"toggleFlag")));return n},
handleAddContact:function(){this.addContactCard?this.addContactCard.reset():(this.addContactCard=new I({addressModel:this.addressModel,isPopup:this.isPopup}),this.addContactCard.startup());this.currentScreenNameOrEmail?this.addContactCard.setData(null,null,this.currentScreenNameOrEmail,null,null):this.addContactCard.reset();var a=D.position(this.currentAddressItemNode);this.addContactCard.open({x:a.x,y:a.y});this.addContactCard.popupNode.style.zIndex="998"},handleViewContact:function(){this.currentContact&&
(this.isPopup&&_ws_isOpenerWS()?opener.ws.WebSuite.showContactDetails(this.currentContact):ws.WebSuite.showContactDetails(this.currentContact))},onAddressSelect:function(a,f,b){q.add(f,"itemSelected");this.openAddrActionMenu(a,f);b.stopPropagation()},getContactInfo:function(a){var f=this.addressModel.getRecordByEmail(a);f||-1!=a.indexOf("@")||(f=this.addressModel.getRecordByScreenName(a));return{contact:f,snOrEmail:f&&f.screenName?f.screenName:a}},openAddrActionMenu:function(a,f){var b=ws.lang.undefinedOrNull(ws.string.getScreenNameForAddress(a));
if(!this.addrActionMenu){var n=[];n.push({emailItem:!0,caption:Config.Strings.AddrAction_Email,onClick:k.hitch(this,function(){ws.WebSuite.getCompose(null,k.hitch(this,function(a){a.reset({to:this.currentScreenNameOrEmail||"",backToString:"setFolder"})}))})});n.push({addItem:!0,caption:Config.Strings.AddrAction_Add,onClick:k.hitch(this,function(){this.handleAddContact()})});n.push({viewItem:!0,caption:Config.Strings.AddrAction_Veiw,onClick:k.hitch(this,function(){this.handleViewContact()})});this.addrActionMenu=
ws.widget.createMenu(n);this.connect(this.addrActionMenu,"onClose","clearAddrActionMenu")}var c=this.getContactInfo(a);this.currentScreenNameOrEmail=c.snOrEmail;this.currentContact=c.contact;this.currentAddressItemNode=f;for(var n=c.contact?"none":"",c=c.contact?"":"none",g=this.addrActionMenu.getChildren(),d=0;d<g.length;d++)g[d].chatItem&&(g[d].disabled=b,g[d].updateDisabled()),g[d].addItem&&(g[d].domNode.style.display=n),g[d].viewItem&&(g[d].domNode.style.display=c);this.addrActionMenu.bindDomNode(f,
null,!0);this.addrActionMenu.openMyself()},clearAddrActionMenu:function(){try{q.remove(this.addrActionMenu.boundNode,"itemSelected")}catch(n){}},addFullDisplayAddress:function(a,f){if(!a)return"";f.innerHTML="";for(var b=0;b<a.length;b++){var n=a[b].email?a[b].email:Config.Strings.None,c=ws.string.escapeXml(n),g=ws.string.escapeXml(a[b].name?a[b].name:""),d=b<a.length-1;this.createHdrAddress(n,g,c,!0,d,f);d&&f.appendChild(document.createTextNode(" "))}return""},setupFullHeader:function(){var a=this.msgInfo.message.headers;
this.addFullDisplayAddress(a.from,this.fullFromNode);this.addFullDisplayAddress(a.to,this.fullToNode);this.addFullDisplayAddress(a.cc,this.fullCcNode);this.addFullDisplayAddress(a.bcc,this.fullBccNode)},setupShortHeader:function(){if(this.msgInfo){var a=this.msgInfo.message.headers,f=this.model.getSenderInfo(this.msgInfo.message),b=z.create("span",{className:"toAddressLabel",innerHTML:Config.Strings.To+":"});this.shortHeaderNode.innerHTML="";var c=f.email||Config.Strings.None,g=ws.string.escapeXml(f.name);
this.model.getSearchString()&&Config.HighlightSeachTermInMessageRead&&(g=this.markupSearchString(g));this.createHdrAddress(c,g,"("+c+")",!0,!1,this.shortHeaderNode,!0);c=Config.Strings.ToYou;f=this.model.getFolderByName(this.folder);this.model.isFolderType(f,"DRAFT")||this.model.isFolderType(f,"SENT")?(this.shortHeaderNode.appendChild(b),0<a.to.length?(c=a.to[0].email,b=[["",c]],f=this.findMoreCount(b),g=ws.string.escapeXml(a.to[0].name),g||(g=ws.string.parseEmailAddress(a.to[0].email).name),this.createHdrAddress(c,
g,null,!1,!1,this.shortHeaderNode),f&&(b=" "+ws.string.substituteParams(Config.Strings.plusMore,f),a=document.createElement("span"),this.shortHeaderNode.appendChild(a),a.innerHTML=b)):this.shortHeaderNode.appendChild(document.createTextNode(Config.Strings.None))):(a=ws.UserContext.UserAddress,f=this.isBCCorDistro(),f.isDistro?(this.shortHeaderNode.appendChild(b),c=this.msgInfo.distroListId,b=[["",c]],f=this.findMoreCount(b),b=c.indexOf("@"),g=-1!=b?c.substr(0,b):c,this.createHdrAddress(c,g,null,!1,
!1,this.shortHeaderNode),f&&(a=document.createElement("span"),this.shortHeaderNode.appendChild(a),a.innerHTML=" "+ws.string.substituteParams(Config.Strings.plusMore,f))):(f.isBCC&&(c+=" ("+Config.Strings.Bcc+")"),f=this.findMoreCount(this.model.sendAddresses),c=ws.string.substituteParams("\x3cspan title\x3d'%{0}'\x3e%{1}\x3c/span\x3e",a,c),c+=0<f?" "+ws.string.substituteParams(Config.Strings.plusMore,f):"",a=document.createElement("span"),this.shortHeaderNode.appendChild(b),this.shortHeaderNode.appendChild(a),
a.innerHTML=c))}},findMoreCount:function(a){var f=0,b=this.msgInfo.message.headers,c=b.to.concat(b.cc);0<b.bcc.length&&(c=c.concat(b.bcc));for(b=0;b<c.length;b++){var n=c[b].email.toLowerCase(),g=!1;if(-1==n.indexOf("@")&&-1!=n.indexOf("undisclosed")&&-1!=n.indexOf("recipients"))g=!0;else for(var d=0;d<a.length;d++)if(n==a[d][1].toLowerCase()){g=!0;break}g||f++}return f},isBCCorDistro:function(){var a={isBCC:!1,isDistro:!1},f=this.msgInfo.message.headers,b=f.to.concat(f.cc);0<f.bcc.length&&(b=b.concat(f.bcc));
for(var f=!1,c=this.model.sendAddresses,g=0;g<b.length;g++){for(var d=b[g].email.toLowerCase(),k=0;k<c.length;k++)if(d==c[k][1].toLowerCase()){f=!0;break}if(f)break}f||(a.isBCC=!0);return a},updateInfoStrips:function(){var a,f=function(){var b=z.create("div",{className:"bar"}),f=z.create("table",null,b),f=z.create("tbody",null,f),f=z.create("tr",null,f),c=z.create("td",{className:"barLeft"},f);a=z.create("span",{},c);a.innerHTML="\x3csvg class\x3d'svgIcon'\x3e\x3cuse xlink:href\x3d'#iconAlert'\x3e\x3c/use\x3e\x3c/svg\x3e";
var n=z.create("td",{className:"barRight"},f),f=z.create("td",{className:"barRightBlock",align:"right"},f);return{bar:b,barLeft:c,barRight:n,barIcon:a,barAction:f}};this.infoStrips.innerHTML="";var b,c,g,d=!1,r="chrome sdham sduser spf spam virus".split(" "),x=this.model.isFolderType(this.msgInfo.message.folder,"BULK"),p=this.model.isFolderType(this.msgInfo.message.folder,"INBOX");r.push(x?"spamFolder":"images");for(var e=0;e<r.length&&!d;e++)switch(r[e]){case "chrome":g=[["isOfficialMail","official",
"AOLOfficialMail","iconOfficial"],["isCertifiedMail","certified","AOLCertifiedMail","iconCertified"],["isVoicemail","official","AOLVoiceMail","iconOfficial"]];b=this.model.getTypeName(this.msgInfo.message);c="CERTIFIED"==b;b="OFFICIAL"==b;if(c||b){b=f();this.infoStrips.appendChild(b.bar);var h=Config.Strings[g[1][2]],K=c?Config.Strings.AOLCertifiedMailMsg:Config.Strings.AOLOfficialMailMsg,w=g[1][1];q.add(b.barLeft,w+"Left");q.add(b.bar,w+"Bar");b.barIcon.innerHTML="\x3csvg class\x3d'svgIcon'\x3e\x3cuse xlink:href\x3d'#"+
g[1][3]+"'\x3e\x3c/use\x3e\x3c/svg\x3e";b.barIcon.appendChild(document.createTextNode(h));b.barRight.appendChild(document.createTextNode(K+" "));g=document.createElement("a");g.href=c?Config.LearnMoreCertifiedMailURL:Config.LearnMoreOfficialMailURL;g.target="_blank";g.appendChild(document.createTextNode(Config.Strings.dm_LearnMore));q.add(g,"wsLink");q.add(g,w+"Link");b.barRight.appendChild(g)}break;case "sdham":Config.EnableSpamSchemaCheck&&p&&this.model.hasSchemaContactAllowed(this.msgInfo.message)&&
(b=f(),this.phishBar=b.bar,this.infoStrips.appendChild(b.bar),q.add(b.barLeft,"alertLeft"),q.add(b.bar,"alertBar"),q.add(b.bar,"alertBarFlex"),b.barLeft.appendChild(document.createTextNode(Config.Strings.SpamContactAllowedTitle)),b.barRight.appendChild(document.createTextNode(Config.Strings.SpamContactAllowedMsg)),c=document.createElement("span"),b.barAction.appendChild(c),c.appendChild(document.createTextNode(Config.Strings.dm_MessageSafe)),q.add(c,"wsLink blockBarLink alertLink"),c.onclick=k.hitch(this,
"spamAction",!1,null,!0),c=document.createElement("span"),q.add(c,"barPipe"),c.innerHTML="\x26nbsp;\x26nbsp;|\x26nbsp;\x26nbsp;",b.barAction.appendChild(c),d=!0,c=document.createElement("span"),b.barAction.appendChild(c),c.appendChild(document.createTextNode(Config.Strings.SpamContactActionSpam)),q.add(c,"wsLink blockBarLink alertLink"),c.onclick=k.hitch(this,"removeContactMarkSpam"));break;case "sduser":Config.EnableSpamSchemaCheck&&x&&this.model.hasSchemaUserMark(this.msgInfo.message)&&(b=f(),this.phishBar=
b.bar,this.infoStrips.appendChild(b.bar),q.add(b.barLeft,"alertLeft"),q.add(b.bar,"alertBar"),q.add(b.bar,"alertBarFlex"),b.barLeft.appendChild(document.createTextNode(Config.Strings.SpamContactAllowedTitle)),b.barRight.appendChild(document.createTextNode(Config.Strings.SpamUserMarked)),d=!0);break;case "spf":Config.EnablePhishWarning&&!x&&this.model.hasDeco(this.msgInfo.message,"BDM")&&(b=f(),this.phishBar=b.bar,this.infoStrips.appendChild(b.bar),q.add(b.barLeft,"alertLeft"),q.add(b.bar,"alertBar"),
q.add(b.bar,"alertBarFlex"),b.barLeft.appendChild(document.createTextNode(Config.Strings.dm_SpfCheckTitle)),b.barRight.appendChild(document.createTextNode(Config.Strings.dm_SpfCheckMsg)),c=document.createElement("span"),b.barAction.appendChild(c),b=new R,b.setLabel(Config.Strings.dm_MessageSafe),b.onClick=k.hitch(this,"reportSafeMessage"),b.startup(),c.appendChild(b.domNode),q.add(b.domNode,"phishSafeBtn"));break;case "spam":Config.EnableSpamWarning&&!x&&this.model.hasDeco(this.msgInfo.message,"FTSP")&&
(b=f(),this.infoStrips.appendChild(b.bar),q.add(b.barLeft,"alertLeft"),q.add(b.bar,"alertBar"),b.barLeft.appendChild(document.createTextNode(Config.Strings.dm_SpamCheckTitle)),b.barRight.appendChild(document.createTextNode(Config.Strings.dm_SpamCheckMsg)));break;case "virus":0<this.msgInfo.message.attachmentCount&&u.some(this.msgInfo.message.attachments,function(a){return a.virus&&"Y"==a.virus})&&"Draft"!=this.folder&&"Sent"!=this.folder&&(b=f(),this.infoStrips.appendChild(b.bar),q.add(b.barLeft,
"alertLeft"),q.add(b.bar,"alertBar"),b.barLeft.appendChild(document.createTextNode(Config.Strings.dm_NotScannedTitle)),b.barRight.appendChild(document.createTextNode(Config.Strings.dm_NotScannedMsg+" ")),g=document.createElement("a"),g.href=Config.LearnMoreVirusURL,g.target="_blank",g.appendChild(document.createTextNode(Config.Strings.dm_LearnMore)),q.add(g,"wsLink alertLink"),b.barRight.appendChild(g));break;case "images":this.hasImagesBlocked()&&(b=f(),this.imagesRemovedBar=b.bar,q.add(b.barLeft,
"alertLeft"),q.add(b.bar,"alertBar"),b.barLeft.appendChild(document.createTextNode(Config.Strings.dm_ImageBlockedTitle)),this.infoStrips.appendChild(b.bar),c=document.createElement("span"),b.barRight.appendChild(c),c.appendChild(document.createTextNode(Config.Strings.dm_ImageEnable)),q.add(c,"wsLink blockBarLink alertLink"),c.onclick=k.hitch(this,"restoreImages"),c=document.createElement("span"),q.add(c,"barPipe"),c.innerHTML="\x26nbsp;\x26nbsp;|\x26nbsp;\x26nbsp;",b.barRight.appendChild(c),c=document.createElement("span"),
b.barRight.appendChild(c),c.appendChild(document.createTextNode(Config.Strings.dm_ImageEnable4Sender)),q.add(c,"wsLink blockBarLink alertLink"),c.onclick=k.hitch(this,"restoreImagesAddContact"),Config.TurnOffLinkAndImageBlockingInSettings&&(c=document.createElement("span"),b.barAction.appendChild(c),c.appendChild(document.createTextNode(Config.Strings.dm_ImageOffBlocking)),q.add(c,"wsLink blockBarRightLink alertLink"),c.onclick=k.hitch(this,"restoreImagesUpdateSettings")));break;case "spamFolder":if(this.hasImagesBlocked()){b=
f();q.add(b.barLeft,"alertLeft");q.add(b.bar,"alertBar alertBarSpam");z.create("div",{innerHTML:Config.Strings.LinksImagesInSpam},b.barLeft);this.infoStrips.appendChild(b.bar);if(!this.hasImagesBlocked())return;z.create("span",{innerHTML:Config.Strings.dm_ImageEnable,className:"wsLink blockBarLink alertLink",onclick:k.hitch(this,"restoreImages")},b.barRight)}}},hasImagesBlocked:function(){return this.imagesRemoved&&(this.model.hasBlockedContent(this.msgInfo)||this.model.hasImageAttachments(this.msgInfo.message))},
checkForImageBlock:function(a){if(this.hideImages){var b=this.model.getUidData(a);if(b){var f=this.model.getSenderInfo(b).email;a=!1;""!=f&&(a=this.addressModel.getRecordByEmail(f));f=this.model.isMyAddress(f);b=b.hasOwnProperty("verifiedDomains");this.imagesRemoved=this.hideImages&&!a&&!f&&!b}}},_restoreImages:function(){this.restoreBlocked()},restoreBlocked:function(){this.hideImages=this.imagesRemoved=!1;this.model.skipCachedMsg=!0;this.displayMessage()},_addContact:function(){var a={postData:{source_contacts:[{aol_tag:"Auto-Added",
endpoints:[{ep:"smtp:"+this.msgInfo.message.headers.from[0].email}]}]},load:k.hitch(this,function(){c.publish("WSFeedbackStart",Config.Strings.SenderAdded,!0)})};this.addressModel.createContact(a)},restoreImages:function(){this.imagesRemoved&&this._restoreImages()},restoreImagesAddContact:function(){this.imagesRemoved&&(this._restoreImages(),this._addContact(),this.imagesRemoved=!1)},restoreImagesUpdateSettings:function(){if(this.imagesRemoved){this._restoreImages();this.messageReceived(this.uid,
this.msgInfo);ws.settings.save({DisplayImageWarning:!1});Settings.DisplayImageWarning=!1;var a=f.byId("GeneralSettings");a&&a.DisplayImageWarning.checked&&(a.DisplayImageWarning.checked=!1);this.imagesRemoved=!1}},getTipForAddr:function(a){if(a)for(var b=this.model.getIdentities(),f=0;f<b.length;f++)if(a.toLowerCase()==b[f][1])return b[f][0]==b[f][1]?b[f][1]:b[f][0]+"  "+b[f][1];return a},confirmClose:function(a,b){if(this.inlineReplyWidget){var f=dojo.hitch(this,function(){this.setToolbarEnabled(!0)}),
c=dojo.hitch(this,function(){this.inlineComposeReset();a&&a()});this.inlineReplyWidget.confirmClose(c,b,f)}else a&&a()},inlineComposeReset:function(){this.inlineReplyWidget&&(this.inlineReplyWidget.destroyRecursive(),this.inlineReplyWidget=null);this.inlineComposeBar.style.display="inline-block";this.inlineCompose.style.display="none"},inlineForward:function(){this.inlineComposer("forward")},inlineReply:function(){this.inlineComposer("reply")},inlineReplyAll:function(){this.inlineComposer("replyAll")},
inlineOpenDraft:function(a,b){this.inlineComposer("openDraft",a,b)},inlineComposer:function(a,b,f){ws.lang.ensureLayersLoadedExtra(dojo.hitch(this,function(){require(["ws/mail/ComposeMessageWidget"],dojo.hitch(this,function(g){this.inlineComposeBar.style.display="none";this.inlineCompose.style.display="block";var n=document.createElement("div");this.inlineCompose.appendChild(n);var d=this.parentScrollNode||f||this.messageArea.domNode;try{var k=new g({showNewWindowLink:!1,showCancelXButton:!1,model:this.model,
parentScrollNode:d,cancelCB:dojo.hitch(this,function(a,b,f,c){c&&"sendConfirmationPage"===c.id?(this.backToList(),this.inlineComposeReset()):this.inlineReplyWidget&&this.inlineReplyWidget.confirmClose&&this.inlineReplyWidget.confirmClose(dojo.hitch(this,function(){this.inlineComposeReset()}))}),sendSuccessCB:dojo.hitch(this,function(a){if("all"!=Config.EnableShowSendConfPageSetting||Settings.ShowSendConfPage){a=a.getSendConfirmationSetUpParams();var b=ws.WebSuite.ViewWidget;window.DM&&window.DM.notebook&&
(b=window.DM.notebook);ws.WebSuite.setupSendConfirmation(b,a)}else c.publish("WSFeedbackStart",Config.Strings.ComposeSentTitle,!0);this.inlineComposeReset()}),composeCompleteCleanup:dojo.hitch(this,function(){this.inlineComposeReset()}),beaconSuffix:"",isInlineReply:!0},n)}catch(Y){}k.startup();this.msgInfo.selectedText=this.selectedHtml;dojo.addClass(this.inlineCompose,"toastComposeDiv");dojo.addClass(k.domNode,"inlineComposeNode");dojo.addClass(k.domNode,"toastComposeDomNode");k.addressModel.setABListReadyCB(dojo.hitch(this,
function(){if("openDraft"==a)k.openDraft(this.model.currentFolder,b);else k[a](this.msgInfo)}));k.resize();this.inlineReplyWidget=k}))}),{layers:["DisplayMessage"]})},reply:function(){this.composeResponse("reply")},replyAll:function(){this.composeResponse("replyAll")},forward:function(){this.composeResponse("forward")},composeResponse:function(a){this.getComposeCB&&(this.msgInfo.selectedText=this.selectedHtml,this.getComposeCB(k.hitch(this,function(b){b.isStandAlone=this.isStandAlone;b[a](this.msgInfo)})))},
openDraft:function(){this.getComposeCB(k.hitch(this,function(a){a.openDraft(this.model.currentFolder,this.uid)}))},onMsgListFlagMessage:function(a,b){if(this.isPreviewPane){for(var f=0,c=!1;f<a.length;){if(a[f]==this.msgInfo.message.id){c=!0;break}f++}c&&(this.msgInfo.message.flags.flagged=b,t(".flag",this.domNode).toggleClass("flagged",b))}},toggleFlag:function(a,b){a&&a.stopPropagation();var f=!this.msgInfo.message.flags.flagged;this.msgInfo.message.flags.flagged=f;t(".flag",this.domNode).toggleClass("flagged",
f);this.model.flagMessages([this.msgInfo.message.id],f,b?"DMAct":"DMHdr").then(k.hitch(this,function(){c.publish("WSFeedbackStart",f?Config.Strings.MessageFlagged:Config.Strings.MessageUnflagged,!0)}),function(a){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.flagMessages-toggleFlag",a,"DisplayMessageWidget.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorSettingFlag)})},markRead:function(){this.changeReadState(!0)},markUnread:function(){this.changeReadState(!1)},
changeReadState:function(a){var b=this.getNextUid();this.model.changeMessagesReadState([this.msgInfo.message.id],a,!1).then(k.hitch(this,function(){this.msgInfo.message.flags.read=a;c.publish("WSFeedbackStart",a?Config.Strings.MessageMarkedRead:Config.Strings.MessageMarkedNew,!0)}),function(a){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.changeMessagesReadState-changeReadState",a,"DisplayMessageWidget.js");ws.widget.Dialogs.ok(Config.Strings.MarkReadError)});
var f=this.model.getFolderByName(this.folder);(a&&Config.EnableMoveForMarkSeen&&this.model.isFolderType(f,"NewMail")||!a&&Config.EnableMoveForMarkUnseen&&this.model.isFolderType(f,"OldMail"))&&this.showNextOrList(b)},deleteMessage:function(){var a=this.model.getFolderByName(this.folder);if(this.model.isFolderType(a,"TRASH")||this.model.isFolderType(a,"BULK"))ws.widget.Dialogs.okCancel(Config.Strings.PermDeleteConfirmation,k.hitch(this,function(a){a&&this.deleteMessageHelper()}));else return a=this.model.getFolderByType("TRASH"),
a=this.model.getFolderDisplayName(a),this.deleteMessageHelper(a);return""},deleteMessageHelper:function(a){var b=this.getNextUid(),f=this.msgInfo.message.id,g=null,n="";if(a&&"string"==typeof a){this.model.getFolderByType("TRASH");var n=ws.string.substituteParams(Config.Strings.MessageMoved,ws.string.unescapeXml(a)),d={};d[this.folder]=[f];g=k.hitch(this.model,"undoMoveMessages",d)}else n=Config.Strings.MessageDeleted;this.setToolbarEnabled(!1);this.model.deleteMessages([f]).then(k.hitch(this,function(d){this.isPopup?
Settings.GotoNextOnDelete?this.showNextOrList(b,k.hitch(this,function(){c.publish("WSFeedbackStart",n,!0,null)})):(this.undoFeedbackCB&&this.undoFeedbackCB("Delete",[f],n,a,this.folder),this.showNextOrList(b)):c.publish("WSFeedbackStart",n,!0,g)}),function(a){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteMessages-deleteMessageHelper",a,"DisplayMessageWidget.js");ws.widget.Dialogs.ok(Config.Strings.DeleteMessageError)});this.isPopup||
this.showNextOrList(b)},_undoReportSpamMessages:function(a){this.model.undoReportSpamMessages(a)},_undoMoveMessages:function(a){this.model.undoMoveMessages(a)},restoreMessage:function(){this._restoreMessage()},_restoreMessage:function(){var a=this.getNextUid();this.setToolbarEnabled(!1);var b=this.msgInfo.message.id;this.model.restoreMessages([b]).then(k.hitch(this,function(f){b&&(a=b);this.isPopup?Settings.GotoNextOnDelete?this.showNextOrList(a,k.hitch(this,function(){this.model.refetchFolderIndex(this.model.currentFolder);
c.publish("WSFeedbackStart",Config.Strings.MessageRestored,!0)})):(this.undoFeedbackCB&&this.undoFeedbackCB("None",[b],Config.Strings.MessageRestored),this.showNextOrList(a)):(this.model.refetchFolderIndex(this.model.currentFolder),b&&this.showNextOrList(a),c.publish("WSFeedbackStart",Config.Strings.MessageRestored,!0))}),function(a){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.restoreMessages-_restoreMessage",a,"DisplayMessageWidget.js");
ws.widget.Dialogs.ok(Config.Strings.RestoreMessageError)});this.isPopup||b||this.showNextOrList(a)},moveMessage:function(a){this.confirmClose(k.hitch(this,function(){var b=this.getNextUid(),f=this.model.getFolderByName(this.folder),g=this.model.getFolderByName(a),d=this.model.getFolderDisplayName(g);this.model.isFolderType(f,"TRASH")||"Trash"!=a?this.model.isFolderType(g,"BULK")?this.spamAction(!0):this.model.isFolderType(f,"BULK")?this.spamAction(!1,a):(this.setToolbarEnabled(!1),this.model.moveMessages([this.msgInfo.message.id],
a).then(k.hitch(this,function(){if(this.isPopup)Settings.GotoNextOnDelete?this.showNextOrList(b,k.hitch(this,function(){c.publish("WSFeedbackStart",ws.string.substituteParams(Config.Strings.MessageMoved,ws.string.unescapeXml(d)),!0,null)})):(this.undoFeedbackCB&&this.undoFeedbackCB("Move",[this.msgInfo.message.id],Config.Strings.MessageRestored,ws.string.unescapeXml(a),this.folder),this.showNextOrList(b));else{var f={};f[this.folder]=[this.msgInfo.message.id];f=k.hitch(this.model,"undoMoveMessages",
f);c.publish("WSFeedbackStart",ws.string.substituteParams(Config.Strings.MessageMoved,ws.string.unescapeXml(d)),!0,f)}}),function(a){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.moveMessages-moveMessage",a,"DisplayMessageWidget.js");ws.widget.Dialogs.ok(Config.Strings.MoveMessageError)}),this.isPopup||this.showNextOrList(b)):this.deleteMessageHelper(d)}))},backToInbox:function(){ws.reporting.reportDLAction("Mail-ReadMessage-BackToInbox");
this.backToList(!0)},reportSpam:function(){this.spamAction(!0)},reportNotSpam:function(){this.spamAction(!1)},spamAction:function(a,b,f){var c=this.msgInfo.message,g=this.model.getSenderInfo(c);if(a&&Config.EnableUnsubscribe&&ws.settings.loadConsolidated("EnableUnsubscribing")&&this.model.getDeco(c,"USB")){var d=g.email||Config.Strings.None,n=Settings.ShowSenderDisplayName?ws.string.escapeXml(g.name):null;ws.widget.Dialogs.showUnsubDialog(d,n,k.hitch(this,function(g){if(g){var u=this.getNextUid();
ws.Jws.unsubscribe(c.id).then(k.hitch(this,function(){var a=g?ws.string.substituteParams(Config.Strings.UnsubConfirm,null!=n?n:d):Config.Strings.MessageMarkedSpam;dojo.publish("WSFeedbackStart",[ws.string.unescapeXml(a),!0,null]);this.showNextOrList(u)}),k.hitch(this,function(a){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for unsubscribe",a,"DisplayMessageWidget.js");ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.UnsubError,null!=
n?n:d))}))}else this._reportSpam(a,b,f)}))}else this._reportSpam(a,b,f)},_reportSpam:function(a,b,f){var g={},d=this.getNextUid();g.Bulk=[this.msgInfo.message.id];this.model.reportSpamMessages([this.msgInfo.message.id],a,b,this.msgInfo.message).then(k.hitch(this,function(){a?this.isPopup?Settings.GotoNextOnDelete?this.showNextOrList(d,k.hitch(this,function(){c.publish("WSFeedbackStart",ws.string.unescapeXml(Config.Strings.MessageMarkedSpam),!0,null)})):(this.undoFeedbackCB&&(this.model.isInboxNewOld(this.model.currentFolder)?
this.undoFeedbackCB("Spam",g,Config.Strings.MessageMarkedSpam):this.undoFeedbackCB("Move",g,Config.Strings.MessageMarkedSpam)),this.showNextOrList(d)):(c.publish("WSFeedbackStart",ws.string.unescapeXml(Config.Strings.MessageMarkedSpam),!0,null),this.showNextOrList(d)):(c.publish("WSFeedbackStart",ws.string.unescapeXml(Config.Strings.MessageMarkedNotSpam),!0,null),f||this.showNextOrList(d))}),function(a){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.reportSpamMessages-spamAction",
a,"DisplayMessageWidget.js");ws.widget.Dialogs.ok(Config.Strings.ReportSpamError)})},nextMessage:function(){q.contains(this.nextButtonNode.domNode,"btnDisabled")||this.nextPrevMessage(1)},prevMessage:function(){q.contains(this.prevButtonNode.domNode,"btnDisabled")||this.nextPrevMessage(-1)},nextPrevMessage:function(a){var b=this.model.getAdjacentMessageUid(this.msgInfo.message.id,a);b&&this.confirmClose(dojo.hitch(this,function(){this.isPopup?DM.showMessage(b):(this.setToolbarEnabled(!1),ws.WebSuite.openMessage(this.folder,
b,!1,this.model.screenName))},"displayMessage"))},getNextUid:function(){var a=this.msgInfo.message.id;return this.model.getAdjacentMessageUid(a,1)||this.model.getAdjacentMessageUid(a,-1)},showNextOrList:function(a,b){Settings.GotoNextOnDelete&&a&&this.enableNextPrev?this.isPopup?DM.showMessage(a):(this.setToolbarEnabled(!1),ws.WebSuite.openMessage(this.folder,a,!1,this.model.screenName)):ws.lang.setTimeout(this,"backToList",100,!1,a);b&&b()},backToList:function(a,b,f){if(this.backToListCB){var c=
dojo.hitch(this,function(){"boolean"!=typeof a&&(a=null);b||(b=this.uid);var c=this.model.activeCachedList.GetAvailableRowsForUIDs([b]),c=1==c.length?c[0]:-1,g=this.model.getCurrentFolder();(this.model.isFolderType(g,"NEWMAIL")||this.model.isFolderType(g,"OLDMAIL"))&&this.model.refetchFolderIndex(this.model.currentFolder);this.backToListCB(a,c,b,f)});this.isStandAlone?this.confirmClose(k.hitch(this,function(){c()})):this.isPopup?this.confirmClose(k.hitch(this,function(){ws.io.closeWindow()})):c()}},
defineActionMenu:function(){this.actionButton.menuDefinition=[{caption:Config.Strings.MarkReadActionLabel,onClick:k.hitch(this,"markRead")},{caption:Settings.ViewNewOld?Config.Strings.KeepAsNewActionLabel:Config.Strings.MarkUnreadActionLabel,onClick:k.hitch(this,"markUnread")},{caption:Config.Strings.FlagForFollowUp,onClick:k.hitch(this,"toggleFlag",null,!0)},{caption:Config.Strings.ClearFlag,onClick:k.hitch(this,"toggleFlag",null,!0)},{caption:Config.Strings.MailFilter_CreateFilter,onClick:k.hitch(this,
"onClickCreateFilter")},{separator:!0},{caption:Config.Strings.SearchForSubject,onClick:k.hitch(this,"searchForSubject")},{caption:Config.Strings.SearchForSender,onClick:k.hitch(this,"searchForSender")},{separator:!0},{caption:Config.Strings.PrintMessage,onClick:k.hitch(this,"print")},{caption:Config.Strings.ViewMessageSource,onClick:k.hitch(this,"viewSource")},{separator:!0}]},updateActionMenu:function(){var a=this.actionButton.menu;if(a&&this.getButtonConfig()){q.add(a.domNode,"popupMenuLimit");
var b=a.getChildren();"initialChildCount"in a||(a.initialChildCount=b.length);var f=b[0],c=b[1],g=b[2],d=b[3],k=b[4],a=b[5],u=b[6],r=b[7],x=b[9],p=this.buttonViz&&this.buttonViz[7]&&this.model.canChangeMessageReadState(this.msgInfo.message.folder.name);f.setShowing(p&&!this.msgInfo.message.flags.read);c.setShowing(p&&this.msgInfo.message.flags.read);k.setShowing(this.enableFilters&&Config.EnableFiltersSettings);c.setCaption(Settings.ViewNewOld?Config.Strings.KeepAsNewActionLabel:Config.Strings.MarkUnreadActionLabel);
f=this.msgInfo?!!this.msgInfo.message.flags.flagged:!1;g.setShowing(!f);d.setShowing(f);g=this.msgInfo.message.folder;g=this.showSearchItems&&!this.model.isFolderType(g,"SENT")&&!this.model.isFolderType(g,"CHATS");u.setShowing(this.showSearchItems);r.setShowing(g);a.setShowing(g);x.setShowing(Config.PrintingSupported);!this.isPopup&&this.foldersOK||this.updateActionFolders(this.actionButton);this.model.getSearchString()&&Config.UseOMS&&Config.CrossFolderSearch&&b[7].setCaption(Config.Strings.SearchForFromTo)}},
updateActionFolders:function(a){var b=a.menu;if(b){a=b.getChildren();for(var f,c=0<this.model.getFoldersCanMoveTo().length,g=a.length-1;g>=b.initialChildCount;g--)f=a[g],b.removeChild(f),f!=this.newFolderSeparator&&f!=this.newFolderMenu&&f!=this.newFolderInputMenu&&f.destroyRecursive();c&&(f=new V({caption:Config.Strings.MoveActionLabel,isLabel:!0}),f.setShowing(c),b.addChild(f),u.forEach(this.model.folders,k.hitch(this,function(a){-1!=u.indexOf(this.model.getFoldersCanMoveTo(),a.name)&&(f=new V({caption:this.model.getFolderDisplayName(a)}),
f.onClick=k.hitch(this,"moveMessage",a.name),b.addChild(f),f.startup())})),this.newFolderSeparator||(this.newFolderSeparator=new ga,this.newFolderSeparator.startup(),this.newFolderMenu=new V({caption:Config.Strings.NewFolder}),this.newFolderMenu._onClick=k.hitch(this,"newFolder"),this.newFolderMenu.startup()),b.addChild(this.newFolderSeparator),b.addChild(this.newFolderMenu),b._setAboutToShow||(b.aboutToShow=k.hitch(this,function(){if(this.newFolderInputMenu){var a=this.actionButton.menu;a&&(a._setAboutToShow=
!0);this.newFolderInputMenu.restore()}})));this.foldersOK=!0}},updateFolderFlag:function(){this.foldersOK=!1},newFolder:function(a){a&&a.stopPropagation();var b=this.actionButton.menu;b&&(this.newFolderMenu.hide(),this.newFolderInputMenu||(this.newFolderInputMenu=new L({okCB:k.hitch(this,"moveToNewFolder"),defaultValue:Config.Strings.NewFolder,originalMenuItem:this.newFolderMenu,maxlength:ws.mail.folderName.MaxLength})),ws.lang.setTimeout(this,function(){b.addChild(this.newFolderInputMenu);this.newFolderInputMenu.show();
this.newFolderInputMenu.initializeText(Config.Strings.NewFolder);d.scrollIntoView(this.newFolderInputMenu.domNode)},0))},moveToNewFolder:function(a){a&&a.newName&&ws.mail.folderName.validate(a.newName,null,this.model.folders,null)&&this.model.createFolder(a.newName).then(k.hitch(this,function(){c.publish("WSFeedbackStart",Config.Strings.FolderCreated,!0);this.moveMessage(a.newName)}),function(b){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.createFolder-moveToNewFolder",
b,"DisplayMessageWidget.js");ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.ErrorCreatingFolder,a.newName))})},popOut:function(){window.openerContext={model:this.model,picturesModel:this.picturesModel,folder:this.folder,uid:this.msgInfo.message.id,Settings:Settings,undoFeedbackPopup:this.undoFeedbackCB,callback:k.hitch(this,"backToList",!0,null,!0),calendarDataUpdated:k.hitch(ws.WebSuite,"calendarDataUpdated"),webSuite:ws.WebSuite,jwsData:{wssid:ws.Jws.jwsData.wssid,mboxId:ws.Jws.jwsData.mboxId,
baseMailboxUrl:ws.Jws.jwsData.baseMailboxUrl}};ws.io.openWindow(Config.BaseMailPagesURL+"DisplayMessage?ws_popup\x3dtrue\x26ws_suite\x3dtrue","","status\x3dyes,resizable\x3dyes,left\x3d5,top\x3d5,width\x3d885,height\x3d606")},showFullMessage:function(){"Draft"==this.folder?this.getComposeCB(k.hitch(this,function(a){a.openDraft(this.model.currentFolder,this.uid)})):this.showFullMessageCB&&this.showFullMessageCB(this.folder,this.uid)},searchForSubject:function(){var a=this.model.getBaseSubject(this.msgInfo.message.headers.subject);
this.model.search({subject:a});this.backToList()},searchForSender:function(){var a=this.model.getSenderInfo(this.msgInfo.message);this.model.search({from:a.email});this.backToList()},getLinkHandler:function(a){try{if(0==a.indexOf("mailto:"))return k.hitch(this,"onMailtoClick",a)}catch(O){}return null},onMailtoClick:function(a,b){var f=a.match(/mailto:([^?]+)(\?(.*))?/i),c={to:decodeURIComponent(f[1])};if(f=f[3])for(var g=["subject","cc","bcc","body"],f=f.split("\x26"),d=0;d<f.length;d++){var n=f[d].split("\x3d"),
r=n[0]&&n[0].toLowerCase(),n=n[1];r&&n&&-1!=u.indexOf(g,r)&&(c[r]="body"==r?ws.string.escapeXml(decodeURIComponent(n)):decodeURIComponent(n))}this.getComposeCB(k.hitch(this,function(a){this.isPopup||(c.beaconSuffix="Inline Response");a.reset(c)}));b&&b.preventDefault()},viewSource:function(){var a=ws.Jws.getMessageSourceUrl(this.msgInfo.message.id);ws.io.openWindow(a,"","status\x3dyes,resizable\x3dyes,menubar\x3dyes,scrollbars\x3dyes");ws.reporting.report("Message Source","Mail")},printR:function(){ws.reporting.reportDLAction("Mail-ReadMessage-Print");
this.print()},print:function(){window.printContext=this.msgInfo;window.printContext.message.hideImages=this.hideImages;ws.io.openWindow(Config.BaseMailPagesURL+"PrintMessage",null,"")},getSizeLabeled:function(a){var b=a+" B";1024<Number(a)&&(b=(a/1024).toFixed(0)+" KB");1048576<Number(a)&&(b=(a/1048576).toFixed(1)+" MB");return b},makeAttachmentsLabel:function(a,b){var f=this.getSizeLabeled(b),c=a.lastIndexOf("."),g=a.substr(c+1);-1==c?30<a.length&&(a=a.substr(0,30)+"..."):30<c?a=4<g.length?a.substr(0,
30)+"...":a.substr(0,30)+"..."+g:30<c+g.length&&(a=a.substr(0,30)+"...");return a+" ("+f+")"},updateAttachments:function(){var a=this.msgInfo.message.attachments||[];if(this.imagesRemoved){var b=this.model.getUidData(this.msgInfo.message.id);b&&(a=b.attachments)}this.attachmentsRow.innerHTML="";for(b=0;b<a.length;b++){var f=a[b];if("attachment"==f.disposition){var c=ws.string.escapeXml(f.filename),g=f.downloadUrl,d=new R({fixSize:!0});d.startup();d.setLabel(this.makeAttachmentsLabel(c,f.size));f.virus&&
"N"!=f.virus||"Draft"==this.folder||"Sent"==this.folder?"Y"==f.virus&&d.setTip("("+this.getSizeLabeled(f.size)+") "+Config.Strings.dm_NotScannedMsg):d.setTip("("+this.getSizeLabeled(f.size)+") "+Config.Strings.NoVirusesFound);d.onClick=k.hitch(this,"getAttachment",g);q.add(d.domNode,"attBtn");this.attachmentsRow.appendChild(d.domNode)}}ws.html.setShowing(this.attachmentsRow,0<a.length)},getAttachment:function(b){var f=k.hitch(this,function(){var f=g.byId("attachFrame");if(f){var c;try{c=a.doc(f)}catch(Q){}if(c){if(f=
c.getElementById("ErrorCodeSpan"))f=f.innerHTML,window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - ("+f+") Error Handler for getAttachment",null,"DisplayMessageWidget.js"),ws.widget.Dialogs.ok(Config.Strings.Error_15_Title+"\x3cp\x3e"+Config.Strings.Error_15_Message+"\x3c/p\x3e")}else(opener||window).open(b,"_self")}}),c=g.byId("attachFrame");c&&g.destroy(c);c=z.create("iframe",{id:"attachFrame",src:b,style:"left:-10000px;position:absolute;"},document.body);c.attachEvent?
c.attachEvent("onload",f):c.onload=f},fullScreenOp:function(a,b){if(!this.imageSlideshow)return null;if(!this.imageSlideshow.fullScrAPI&&-1!==this.imageSlideshow.fullScrAPI){this.imageSlideshow.fullScrAPI=-1;for(var f=[{req:"requestFullscreen",xit:"exitFullscreen",elm:"fullscreenElement",hnl:"fullscreenchange"},{req:"webkitRequestFullscreen",xit:"webkitExitFullscreen",elm:"webkitFullscreenElement",hnl:"webkitfullscreenchange"},{req:"webkitRequestFullScreen",xit:"webkitCancelFullScreen",elm:"webkitCurrentFullScreenElement",
hnl:"webkitfullscreenchange"},{req:"mozRequestFullScreen",xit:"mozCancelFullScreen",elm:"mozFullScreenElement",hnl:"mozfullscreenchange"},{req:"msRequestFullscreen",xit:"msExitFullscreen",elm:"msFullscreenElement",hnl:"MSFullscreenChange"}],c=0;c<f.length;c++)if("undefined"!=typeof document[f[c].xit]){this.imageSlideshow.fullScrAPI=f[c];break}}if(-1===this.imageSlideshow.fullScrAPI)return null;switch(a){case "hasAPI":return!0;case "reqFS":f=this.imageSlideshow.fullScrAPI.req;if(b&&f&&b[f])b[f]();
break;case "exitFS":if((f=this.imageSlideshow.fullScrAPI.xit)&&document[f])document[f]();break;case "isInFS":return!!document[this.imageSlideshow.fullScrAPI.elm];case "FSchangeHandler":return this.imageSlideshow.fullScrAPI.hnl}return null},updateSlideShowToolbar:function(){this.fullScreenOp("hasAPI")&&this.imageSlideshow.fullScrBtn&&(this.fullScreenOp("isInFS")?(q.add(this.imageSlideshow.fullScrBtn,"dmss_fullScreenExit"),this.imageSlideshow.fullScrBtn.title=Config.Strings.slideShowTipExitFS):(q.remove(this.imageSlideshow.fullScrBtn,
"dmss_fullScreenExit"),this.imageSlideshow.fullScrBtn.title=Config.Strings.slideShowTipFS))},launchIntoFullscreen:function(a){this.fullScreenOp("hasAPI")&&this.imageSlideshow.fullScrBtn&&(this.updateSlideShowToolbar(),this.fullScreenOp("reqFS",a))},exitFullscreen:function(){this.imageSlideshow.fullScrTimeStamp=0;this.fullScreenOp("hasAPI")&&this.fullScreenOp("isInFS")&&this.imageSlideshow.fullScrBtn&&(this.updateSlideShowToolbar(),this.fullScreenOp("exitFS"))},showSlideShowBtn:function(a){var b;this.slideShowBtn||
(b=new R,b.setLabel(Config.Strings.showSlideShow),b.onClick=k.hitch(this,this.showImageSlideshow),b.domNode.style.position="absolute",this.messageArea.domNode.appendChild(b.domNode),b.onClick=k.hitch(this,"showImageSlideshow"),b.startup(),this.slideShowBtn=b);b=this.slideShowBtn;if(a&&a.currentTarget){a=a.currentTarget;this.slideShowCurrentImg=a.src;b.domNode.style.display="block";a=dojo.getMarginBox(a);var f=dojo.getMarginBox(b.domNode),f=a.l+Math.max(2,a.w/2-f.w/2);b.domNode.style.top=a.t+3+"px";
b.domNode.style.left=f+"px"}},hideSlideShowBtn:function(a){if(this.slideShowBtn&&a&&a.currentTarget){var b=this.slideShowBtn,f=D.position(a.currentTarget,!0),c=a.clientX;a=a.clientY;var g=f.y+f.h,d=f.x,k=f.x+f.w;a>f.y&&a<g&&c>d&&c<k||(b.domNode.style.display="none")}},hideImageSlideshow:function(){this.exitFullscreen();this.imageSlideshow.bgDiv.style.display="none";this.resetImageSlideshow();c.publish("DspMsgSlideShow/end")},resetImageSlideshow:function(){this.slideShowBtn&&this.slideShowBtn.domNode&&
(this.slideShowBtn.domNode.style.display="none");this.imageSlideshow&&this.imageSlideshow.imgInit&&(this.imageSlideshow.spinDiv.style.visibility="hidden",this.imageSlideshow.spinner.stop(),this.imageSlideshow.imgInit=!1,this.imageSlideshow.fullScrTimeStamp=0,this.imageSlideshow.img&&this.imageSlideshow.img.length&&(this.imageSlideshow.img[0].src=Config.SpacerImageURL,this.imageSlideshow.img[1].src=Config.SpacerImageURL,this.imageSlideshow.img[0].style.visibility="hidden",this.imageSlideshow.img[1].style.visibility=
"hidden"),this.imageSlideshow.imgIndx=0)},imageSlideshowLoadHndlr:function(){if(this.imageSlideshow.imgInit){this.imageSlideshow.spinDiv.style.visibility="hidden";this.imageSlideshow.spinner.stop();var a=this.imageSlideshow.img[this.imageSlideshow.imgIndx];a.style.visibility="hidden";a=(this.imageSlideshow.imgIndx+1)%2;this.imageSlideshow.imgIndx=a;var a=this.imageSlideshow.img[a],b=this.imageSlideshow.images[this.imageSlideshow.curIdx],f=dojo.contentBox(a),c=f.w,g=f.h,d=D.getContentBox(this.imageSlideshow.cntDiv),
f=d.w/d.h,k=d.h,d=d.w;0==b.rotate||2==b.rotate?(b=c/g,a.style.height=f>b?k+"px":"auto",a.style.width=f>b?"auto":d+"px"):(b=g/c,a.style.width=f>b?k+"px":"auto",a.style.height=f>b?"auto":d+"px");a.style.visibility="visible"}},imageSlideshowStartLoad:function(a){this.imageSlideshow.spinDiv.style.visibility="visible";this.imageSlideshow.spinner.spin();var b=this.imageSlideshow.img[(this.imageSlideshow.imgIndx+1)%2];b.src=a;this.imageSlideshow.imgInit=!0;return b},showImageSlideshow:function(){if(!this.imageSlideshow){this.imageSlideshow=
{curIdx:0,images:null,fullScreen:!1,fullScrTimeStamp:0};var a=document.createElement("div");this.imageSlideshow.bgDiv=a;q.add(a,"displayMessage_slideShowDiv");this.imageSlideshow.bgDiv.style.display="none";e(document,"keyup",k.hitch(this,function(a){27==a.keyCode?this.imageSlideshow&&800<(new Date).getTime()-this.imageSlideshow.fullScrTimeStamp&&(this.imageSlideshow.fullScrTimeStamp=0,this.hideImageSlideshow()):39==a.keyCode&&"none"!=this.imageSlideshow.bgDiv.style.display?this.setImageSlideshow(1):
37==a.keyCode&&"none"!=this.imageSlideshow.bgDiv.style.display&&this.setImageSlideshow(-1)}));c.subscribe("NotifyExpiredSession",k.hitch(this,"hideImageSlideshow"));var b=document.createElement("div");q.add(b,"displayMessage_slideShowContent");this.imageSlideshow.cntDiv=b;var f=document.createElement("img");f.src=Config.SpacerImageURL;q.add(f,"displayMessage_slideShowImg");b.appendChild(f);e(f,"load",k.hitch(this,this.imageSlideshowLoadHndlr));var g=document.createElement("img");g.src=Config.SpacerImageURL;
q.add(g,"displayMessage_slideShowImg");b.appendChild(g);e(g,"load",k.hitch(this,this.imageSlideshowLoadHndlr));this.imageSlideshow.img=[f,g];this.imageSlideshow.imgIndx=0;f=document.createElement("div");q.add(f,"displayMessage_spinDiv");this.imageSlideshow.spinDiv=f;b.appendChild(f);a.appendChild(b);this.imageSlideshow.spinner=new J("SlideShow",f);b="";document.addEventListener&&this.fullScreenOp("hasAPI")&&(b='\x3cdiv class\x3d"dmss_Icon dmss_fullScreen" title\x3d"'+Config.Strings.slideShowTipFS+
'"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconExpandView"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/div\x3e',f=k.hitch(this,function(){this.imageSlideshow.fullScrTimeStamp=(new Date).getTime();this.updateSlideShowToolbar();setTimeout(k.hitch(this,this.setImageSlideshow,0),15)}),(g=this.fullScreenOp("FSchangeHandler"))&&document.addEventListener(g,f,!1));f=document.createElement("div");q.add(f,"displayMessage_slideShowToolbar");f.innerHTML=['\x3cdiv class\x3d"dmss_Icon dmss_left" title\x3d"'+
Config.Strings.slideShowTipPrev+'"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconLeft"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/div\x3e','\x3cdiv class\x3d"dmssIndex"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dmss_Icon dmss_right" title\x3d"'+Config.Strings.slideShowTipNext+'"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconRight"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/div\x3e','\x3cdiv class\x3d"dmss_Icon dmss_rotate" title\x3d"'+Config.Strings.slideShowTipRotate+'"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconRefresh"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/div\x3e',
b,'\x3cdiv class\x3d"dmss_Icon dmss_download" title\x3d"'+Config.Strings.slideShowTipDownload+'"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconSave"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/div\x3e','\x3cdiv class\x3d"dmss_Icon dmss_close" title\x3d"'+Config.Strings.slideShowTipExit+'"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconClose"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/div\x3e'].join("");a.appendChild(f);this.imageSlideshow.toolbar=f;document.body.appendChild(a);e(t(".dmss_left",
this.imageSlideshow.toolbar)[0],"click",k.hitch(this,function(){this.setImageSlideshow(-1)}));e(t(".dmss_right",this.imageSlideshow.toolbar)[0],"click",k.hitch(this,function(){this.setImageSlideshow(1)}));e(t(".dmss_close",this.imageSlideshow.toolbar)[0],"click",k.hitch(this,function(){this.hideImageSlideshow()}));this.imageSlideshow.fullScrBtn=t(".dmss_fullScreen",this.imageSlideshow.toolbar)[0];this.imageSlideshow.fullScrBtn&&e(this.imageSlideshow.fullScrBtn,"click",k.hitch(this,function(){this.imageSlideshow.reportFS||
(this.imageSlideshow.reportFS=!0,ws.reporting.reportDLAction("Mail-ReadMessage-Slideshow-fullscreen"));this.fullScreenOp("isInFS")?this.exitFullscreen():this.launchIntoFullscreen(this.imageSlideshow.bgDiv)}));e(t(".dmss_rotate",this.imageSlideshow.toolbar)[0],"click",k.hitch(this,function(){this.imageSlideshow.reportRotate||(this.imageSlideshow.reportRotate=!0,ws.reporting.reportDLAction("Mail-ReadMessage-Slideshow-rotate"));var a=this.imageSlideshow.images[this.imageSlideshow.curIdx].rotate;a++;
3<a&&(a=0);this.imageSlideshow.images[this.imageSlideshow.curIdx].rotate=a;setTimeout(k.hitch(this,this.setImageSlideshow,0),5)}));e(t(".dmss_download",this.imageSlideshow.toolbar)[0],"click",k.hitch(this,function(){this.imageSlideshow.reportDownload||(this.imageSlideshow.reportDownload=!0,ws.reporting.reportDLAction("Mail-ReadMessage-Slideshow-download"));this.getAttachment(this.imageSlideshow.images[this.imageSlideshow.curIdx].src)}))}if(null==this.imageSlideshow.images)for(this.imageSlideshow.images=
[],b=this.msgInfo.message.attachments,a=0;a<b.length;a++)"attachment"==b[a].disposition&&"image"==b[a].type&&this.imageSlideshow.images.push({partId:b[a].partId,rotate:0,size:{w:"200px",h:"200px"},src:b[a].downloadUrl});if(this.imageSlideshow&&this.imageSlideshow.images&&this.imageSlideshow.images.length){this.resetImageSlideshow();this.imageSlideshow.bgDiv.style.display="block";c.publish("DspMsgSlideShow/start");this.imageSlideshow.curIdx=0;if(this.slideShowCurrentImg)for(ws.reporting.reportDLAction("Mail-ReadMessage-Slideshow-hoverStart"),
a=0;a<this.imageSlideshow.images.length;a++){if(this.imageSlideshow.images[a].src==this.slideShowCurrentImg){this.slideShowCurrentImg=null;this.imageSlideshow.curIdx=a;break}}else ws.reporting.reportDLAction("Mail-ReadMessage-Slideshow-start");setTimeout(k.hitch(this,this.setImageSlideshow,0),100)}},setImageSlideshow:function(a){if(this.imageSlideshow&&this.imageSlideshow.images&&this.imageSlideshow.images.length){var b=["translate(-50%, -50%) rotate(0deg)","translate(-50%, -50%) rotate(90deg)","translate(-50%, -50%) rotate(180deg)",
"translate(-50%, -50%) rotate(270deg)"];this.imageSlideshow.curIdx+=a;0>this.imageSlideshow.curIdx?this.imageSlideshow.curIdx=this.imageSlideshow.images.length-1:this.imageSlideshow.curIdx>=this.imageSlideshow.images.length&&(this.imageSlideshow.curIdx=0);ws.html.setInnerText(t(".dmssIndex",this.imageSlideshow.toolbar)[0],this.imageSlideshow.curIdx+1+" "+Config.Strings.Of+" "+this.imageSlideshow.images.length);a=this.imageSlideshow.images[this.imageSlideshow.curIdx];if(b=this.getAttachmentByPart(a.partId)){b=
b.downloadUrl;Config.BypassDownloadUrl&&13<dojo.isSafari&&(b=this.model.fixDownloadUrls(b));var f=this.imageSlideshowStartLoad(b),b=["translate(-50%, -50%) rotate(0deg)","translate(-50%, -50%) rotate(90deg)","translate(-50%, -50%) rotate(180deg)","translate(-50%, -50%) rotate(270deg)"];f.style.transform=b[a.rotate];f.style.webkitTransform=b[a.rotate];f.style.mozTransform=b[a.rotate];f.style.msTransform=b[a.rotate]}}},getAttachmentByPart:function(a){for(var b=this.msgInfo.message.attachments,f=0;f<
b.length;f++)if(b[f].partId==a)return b[f];return null},isImageGoodForShow:function(a){var b=q.contains(a,"AOLAttachedImage"),f=q.contains(a,"AOLInlineImage");return a.src&&(b||f)},initializeImages:function(){var a=!1;this.imageSlideshow&&(this.imageSlideshow.images=null,this.imageSlideshow.curIdx=0);t("img",this.bodyCont).forEach(k.hitch(this,function(f){f.style.visibility="visible";Settings.UserHash>=Config.DspMsgImgSlideShowThreshold&&this.isImageGoodForShow(f)&&(e(f,b.enter,k.hitch(this,function(a){this.showSlideShowBtn(a)})),
e(f,b.leave,k.hitch(this,function(a){this.hideSlideShowBtn(a)})),a=!0)}));this.showSlideShowLnk.style.display=a?"":"none";this.slideShowRow.style.display=a?"":"none"},saveSelection:function(){var a=!1,b="",f="",a=E.getAncestorElement("pre"),b=E.getSelectedHtml(),f=E.getSelectedText();a&&b&&(b="\x3cpre\x3e\x3ctt\x3e"+b+"\x3c/tt\x3e\x3c/pre\x3e");this.selectedHtml=b;this.selectedText=f},addToCalendar:function(){if(!this.model.standAloneMailModel){var a=this.selectedText;a||(a=r.trim(ws.html.renderedTextContent(this.bodyCont)));
this.getAddEditWidgetCB(k.hitch(this,function(b){null==b&&(this.calendarModel||(this.calendarModel=new W({modelType:"event"})),this.addEditDialog||(this.addEditDialog=new ha({model:this.calendarModel}),this.addEditDialog.startup(),this.addEditDialog.setModel(this.calendarModel),this.addEditDialog.hide(),document.body.appendChild(this.addEditDialog.domNode)),b=this.addEditDialog);b.onSavedCB=this.calendarDataUpdatedCB;if(this.calendarModel.isModelFetchedOnce)b.show(2,{summary:this.msgInfo.message.headers.subject,
description:a});else{this.calendarModel.getData();var f=w.connect(b,"update",k.hitch(this,function(){w.disconnect(f);b.show(2,{summary:this.msgInfo.message.headers.subject,description:a})}))}ws.reporting.reportDLAction("Mail-ReadMessage-Calendar")}))}},addToTask:function(){if(!this.model.standAloneMailModel){this.taskModel||(this.taskModel=new W({modelType:"todo"}));this.taskView||(this.taskView=new jb({isPopup:this.isPopup,isStandAlone:this.isStandAlone}),this.taskView.onSavedCB=k.hitch(this,function(){this.calendarDataUpdatedCB&&
this.calendarDataUpdatedCB(this.taskModel)}),this.taskView.startup(),this.taskView.setModel(this.taskModel));var a=[-100,6];200>d.getBox().w-D.position(this.addToTaskLink).x&&(a=[-180,6]);this.taskView.open(this.msgInfo.message.headers.subject,this.addToTaskLink,{BL:"TL"},a,"top",6);this.hideTip(this.addToTaskLink);ws.reporting.reportDLAction("Mail-ReadMessage-ToDo")}},_suiteOnKeyPress:function(a){if(this.isShowing()&&Config.EnableKeyboardShortcuts&&!ws.html.isTargetAnInputElement(a)){var b=null;
if(!a.keyChar||!k.isString(a.keyChar)||a.ctrlKey||a.altKey||a.metaKey)switch(ws.html.fixKeyCodeForMac(a)){case p.DELETE:this.isPreviewPane||(b=this.deleteMessage);break;case p.BACKSPACE:a.preventDefault();break;case dojo.keys.UP_ARROW:this.scroll(-1);break;case dojo.keys.DOWN_ARROW:this.scroll(1);break;case dojo.keys.PAGE_UP:this.scroll(-2);break;case dojo.keys.PAGE_DOWN:this.scroll(2);break;case dojo.keys.HOME:this.scroll(-3);break;case dojo.keys.END:this.scroll(3)}else switch(a.keyChar.toLowerCase()){case Config.Strings.KeyMailReply:this.saveSelection();
b=this.reply;break;case Config.Strings.KeyMailReplyAll:this.saveSelection();b=this.replyAll;break;case Config.Strings.KeyMailForward:this.saveSelection();b=this.forward;break;case Config.Strings.KeyMailPopout:!ws.settings.allowPopups()||this.isPopup||this.isStandAlone||this.isPreviewPane||(b=this.popOut);break;case Config.Strings.KeyMailNext:this.enableNextPrev&&!this.isPreviewPane&&(b=this.nextMessage);break;case Config.Strings.KeyMailPrevious:this.enableNextPrev&&!this.isPreviewPane&&(b=this.prevMessage);
break;case Config.Strings.KeyMailPrint:this.isPreviewPane||(b=this.print);break;case Config.Strings.KeyMailClose:b=this.backToList;break;case Config.Strings.KeyMailAddToCalendar:this.isPreviewPane||(this.saveSelection(),b=this.addToCalendar);break;case Config.Strings.KeyMailAddToToDo:this.isPreviewPane||(this.saveSelection(),b=this.addToTask)}a.stopPropagation();b&&setTimeout(k.hitch(this,b),10)}},scroll:function(a){var b=this.messageArea.domNode,f=b.clientHeight,c=0>a?-1:1,g=0;switch(Math.abs(a)){case 1:g=
50*c;break;case 2:g=c*f;break;case 3:g=c*b.scrollHeight}a=b.scrollTop+g;f=b.scrollHeight-b.clientHeight;0>f&&(f=0);0>a?a=0:a>f&&(a=f);b.scrollTop=a},nodeOrParentLinkTag:function(a){for(var b=null;a;)if(a.nodeName&&"a"==a.nodeName.toLowerCase()){b=a;break}else a=a.parentNode;return b},onMailBodyClick:function(a){var b=!0;"undefined"!=typeof a.which&&1!=a.which&&(b=!1);if(a.target&&a.target.nodeName&&b&&(b=this.nodeOrParentLinkTag(a.target))){var f=b.href,g=document.location.href;if(f&&0==f.indexOf(g)){if((b=
f.substring(g.length))&&1<b.length){0==b.indexOf("#")&&(b=b.substring(1));f=t("a",this.bodyCont);g=null;if(f)for(var k=0;k<f.length;k++)if(f[k].name==b){g=f[k];break}g&&d.scrollIntoView(g)}}else if(f=b.getAttribute("href"))if(f=this.getLinkHandler(f))f();else if(this.model.isFolderType(this.msgInfo.message.folder,"BULK"))ws.widget.Dialogs.ok(this.hasImagesBlocked()?Config.Strings.LinksImagesInSpam:Config.Strings.LinksInSpam);else{b.setAttribute("rel","noopener noreferrer");ws.reporting.reportDLAction("Mail-ReadMessage-openlnk",
{msgId:this.msgInfo.message.id});return}a.preventDefault();a.stopPropagation()}c.publish("DisplayMessage/BodyClick");this.isPopup&&c.publish("WSFeedbackHide")},createEnableLinkWidget:function(){var a=[{caption:Config.Strings.dm_LinkEnable,onClick:k.hitch(this,this.restoreLinks)},{caption:Config.Strings.dm_LinkEnable4Sender,onClick:k.hitch(this,this.restoreLinksAddContact)}];Config.TurnOffLinkAndImageBlockingInSettings&&a.push({caption:Config.Strings.dm_LinkOffBlocking,onClick:k.hitch(this,this.restoreLinkUpdateSettings)});
this.enableLinkWidget=ws.widget.createMenu(a);this.connect(this.enableLinkWidget,"onClose","clearOpenLinkMenu");this.positionOpenLinkMenu()},clearOpenMenus:function(){this.enableLinkWidget&&(this.enableLinkWidget.close(),this.clearOpenLinkMenu());this.addrActionMenu&&(this.addrActionMenu.close(),this.clearAddrActionMenu())},clearOpenLinkMenu:function(){if(this.currentLinkNode)try{q.remove(this.currentLinkNode,"dmItemSelected")}catch(n){}},positionOpenLinkMenu:function(){if(this.currentLinkNode){q.add(this.currentLinkNode,
"dmItemSelected");var a=D.position(document.body,!0),b=D.position(this.currentLinkNode,!0);ws.widget.popup({popup:this.enableLinkWidget,x:a.x+b.x,y:a.y+b.y,padding:[0,17],shadow:!1})}},onClickCreateFilter:function(){require(["ws/mail/EditFilter"],k.hitch(this,function(a){var b=this.model.getSenderInfo(this.msgInfo.message);a=new a({mailModel:this.model,filterModel:{from:b.email}});document.body.appendChild(a.domNode);a.startup()}))},markupSearchString:function(a){a=ws.string.escapeXml(a);var b=this.model.getSearchString(),
f=this.model.getSearchIn();if(b&&"alltext"==f&&(b=ws.string.escapeXml(b),-1!=a.toLowerCase().indexOf(b.toLowerCase()))){for(var f=a.toLowerCase(),c=b.length,b=b.toLowerCase(),g=[],d=f.indexOf(b);-1!=d;)g.push(a.substr(0,d)),g.push("\x3cspan class\x3d'searchTerm'\x3e",a.substr(d,c),"\x3c/span\x3e"),a=a.substr(d+c),f=f.substr(d+c),d=f.indexOf(b);g.push(a);a=g.join("")}this.msgMarkedUp=!0;return a},isMessageMarkedUp:function(){return this.msgMarkedUp},wrapToolbar:function(){this.toolbar.skipLayout=!0;
this.layoutWidget.resize()},showTip:function(a){ws.widget.showInstatip(a.target)},hideTip:function(a){ws.widget.hideInstatip(a.target)},idleMonitorStarted:function(){if(this.isPopup&&_ws_isOpenerWS()){var a=function(){opener.topic.publish("IdleMonitor/activityDetected")};this.connect(window,"scroll",a);this.connect(window,"resize",a);this.connect(document,"mousemove",a);this.connect(document,"keyup",a)}},setupAttachThumbs:function(){if(!this.imagesRemoved){for(var a=0,b=this.msgInfo.message.attachments,
f=z.create("div",{className:"AOLMsgAttachmentGroup"}),c=0;c<b.length;c++)if("attachment"==b[c].disposition&&"image"==b[c].type&&b[c].thumbnailUrl){var g=z.create("a",{target:"_blank",href:b[c].downloadUrl},f);z.create("img",{src:b[c].thumbnailUrl,filename:b[c].filename,className:"AOLAttachedImage",partId:b[c].partId},g);a++}0<a&&(b=z.create("div",{className:"AOLMsgAttachmentHeader"},this.bodyCont),z.create("div",{innerHTML:ws.string.substituteParams(Config.Strings.YGP_Attached,a)},b),z.create(f,null,
this.bodyCont))}},reportSafeMessage:function(){this.model.reportSafeMessage(this.msgInfo.message.id).then(k.hitch(this,function(a){this.model.removeDeco(this.msgInfo.message,"BDM");this.model.messageCache.replace(this.msgInfo.message.id,this.msgInfo);(a=this.model.getUidData(this.msgInfo.message.id))&&this.model.removeDeco(a,"BDM");this.model.modelUpdated();this.phishBar&&(this.phishBar.style.display="none");this.layout()}),k.hitch(this,function(a){ws.widget.Dialogs.ok(Config.Strings.dm_ErrorReportSafe)}))},
removeContactMarkSpam:function(){var a=this.model.getSenderInfo(this.msgInfo.message);a&&a.email&&(a=this.addressModel.getRecordByEmail(a.email))&&this.addressModel.deleteAddresses({uids:[a.uid],load:k.hitch(this,function(){this.reportSpam()}),error:function(a){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for removeContactMarkSpam file:DisplayMessageWidget.js",a);ws.widget.Dialogs.ok(Config.Strings.ErrorDeletingContactNotFound)}})}})})},"ws/address/AddContactCard":function(){define("ws/address/AddContactCard",
"dojo/_base/declare dojo/text!ws/address/PeoplePanelAddContactCard.html dojo/text!ws/address/PeoplePanel.css dojo dijit dijit/_Widget dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ws/address/ABUtils ws/address/DistributionListWidget ws/widget/DefaultTextbox ws/widget/Dialogs ws/widget/popup".split(" "),function(v,l,m,d,e,h,t,b,c){return v([h,t,b],{templateString:l,css:{templateString:m},addressModel:null,isPopup:!1,open:function(b){b.popup=this;this.cachedArgs=b;ws.widget.popup(b);this.phoneTypeSelect.sizeMyself()},
close:function(){ws.widget.popup.close(this)},moreDetails:function(){this.isPopup&&_ws_isOpenerWS()?opener.ws.WebSuite.editContact(0,this.getData(),!0):ws.WebSuite.editContact(0,this.getData(),!0);this.close()},isEmptyContact:function(){return this.firstNameInput.getValue()?!1:this.lastNameInput.getValue()?!1:!0},checkRequiredFields:function(){if(this.isEmptyContact())ws.widget.Dialogs.ok(Config.Strings.EmptyContactMessageNoNickName);else if(""==d.trim(this.emailInput.value))this.addContact();else{var b=
c.getAddressList(this.emailInput.value,!1,!0);1>b.length?ws.widget.Dialogs.ok(Config.Strings.ErrorEmailFormat2):this.addContact(b[0])}},addContact:function(b){b=this.getData(b);if(b.firstName||b.lastName||b.email1||b.phone1){var c={postData:{source_contacts:[{first_name:b.firstName,last_name:b.lastName,aol_tag:"General",endpoints:[]}]},load:d.hitch(this,function(b){d.publish("WSFeedbackStart",[Config.Strings.ContactCreated,!0]);this.close()}),error:d.hitch(this,function(b){b&&0<=b.indexOf(Config.AddressBookFullCodeString)&&
(b=Config.Strings.ErrorAddressBookFull);ws.widget.Dialogs.ok(b||Config.Strings.ErrorSavingContactServerError)})};b.email1&&c.postData.source_contacts[0].endpoints.push({ep:"smtp:"+b.email1});b.phone1&&c.postData.source_contacts[0].endpoints.push({ep:"tel:"+b.phone1,type:b.phone1Type.toLowerCase()});this.addressModel.createContact(c)}},getData:function(b){var c="",r="";this.firstNameInput.getValue()&&(c=d.trim(this.firstNameInput.getValue()));this.lastNameInput.getValue()&&(r=d.trim(this.lastNameInput.getValue()));
return{firstName:c,lastName:r,email1:b||this.emailInput.value,phone1:this.phoneInput.value,phone1Type:this.phoneTypeSelect.currentValue}},setData:function(b,c,d,e,h){null!=b&&this.firstNameInput.setValue(b);null!=c&&this.lastNameInput.setValue(c);null!=d&&(this.emailInput.value=d);null!=e&&(this.phoneInput.value=e);null!=h&&this.phoneTypeSelect.setOption(h)},setPointer:function(b,c){null!=b?(this.domNode.style.overflow="visible",ws.widget.setPointerLoc(this.domNode,c)):(this.domNode.style.overflow=
"auto",ws.widget.hidePointer(this.domNode))},reset:function(){this.firstNameInput.setValue();this.lastNameInput.setValue();this.emailInput.value="";this.phoneInput.value="";this.phoneTypeSelect.setOption(0)}})})},"ws/mail/AddTaskCard":function(){define("ws/mail/AddTaskCard","dojo/_base/declare dojo/text!ws/mail/AddTaskCard.html dojo/text!ws/mail/AddTaskCard.css dojo dijit dijit/_Widget dijit/_TemplatedMixin ws/date ws/widget/popup ws/calendar/CalendarViewModel".split(" "),function(v,l,m,d,e,h,t){return v([h,
t],{templateString:l,css:{templateString:m},isStandAlone:!1,isPopup:!1,startup:function(){},setModel:function(b){this.model=b},open:function(b,c,r,p,e,h){this.clearTaskInput();d.removeClass(this.addTaskInputNode,"default");d.removeClass(this.addTaskImage,"wsSmallAddDisabled");d.addClass(this.addTaskImage,"wsSmallAddButton");this.addTaskInputNode.value=b||"";this.around=c;this.orient=r;this.padding=p;this.pointerSide=e;this.nudge=h;ws.widget.popup({popup:this,around:c,orient:r,padding:p});ws.widget.pointer({node:this.domNode,
side:e,target:c,nudge:h})},close:function(){ws.widget.popup.close(this)},clearTaskInput:function(){d.addClass(this.addTaskInputNode,"default");this.addTaskInputNode.value=Config.Strings.EnterTask;d.removeClass(this.addTaskImage,"wsSmallAddButton");d.addClass(this.addTaskImage,"wsSmallAddDisabled");this.addTaskInputNode.blur();this.currentTaskUID=null},onClickAddFromInput:function(){d.hasClass(this.addTaskImage,"wsSmallAddButton")&&(this.close(),this._updateTask(this.addTaskInputNode.value))},onAddTaskKeyPress:function(b){b.keyCode==
d.keys.ENTER?(this.close(),this._updateTask(this.addTaskInputNode.value)):b.keyCode==d.keys.ESCAPE&&this.clearTaskInput()},_updateTask:function(b){b=ws.string.sanitize(b);if(""!=b){var c=this.model.getDefaultTaskArgs();c.summary=b;this.model.createTodo(c).then(d.hitch(this,function(){ws.WebSuite.calendarDataUpdated(this.model);d.publish("WSFeedbackStart",[Config.Strings.ToDoCreated,!0]);if(this.onSavedCB)this.onSavedCB()}))}},onFocus:function(){d.hasClass(this.addTaskInputNode,"default")&&(this.addTaskInputNode.value=
"",d.removeClass(this.addTaskInputNode,"default"),d.removeClass(this.addTaskImage,"wsSmallAddDisabled"),d.addClass(this.addTaskImage,"wsSmallAddButton"),this.addTaskInputNode.focus())},onBlur:function(){""==d.trim(this.addTaskInputNode.value)&&(this.addTaskInputNode.value=Config.Strings.EnterTask,d.addClass(this.addTaskInputNode,"default"),d.removeClass(this.addTaskImage,"wsSmallAddButton"),d.addClass(this.addTaskImage,"wsSmallAddDisabled"))}})})},"ws/calendar/AddEventDialog":function(){define("ws/calendar/AddEventDialog",
"dojo/_base/declare dojo/text!ws/calendar/AddEventDialog.html dojo/text!ws/calendar/AddEventDialog.css dojo/_base/lang ws/widget/WSModalPane dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/layout/BorderContainer dijit/layout/StackContainer ws/calendar/calutil ws/calendar/CalendarSelect ws/date ws/widget/DefaultTextbox ws/widget/DefaultTextarea ws/widget/Dialogs ws/widget/PopupDatePicker ws/widget/PopupTimePicker ws/widget/WSSelect".split(" "),function(v,l,m,d,e,h,t){return v([e,h,t],{templateString:l,
css:{templateString:m},destroyOnClose:!1,hasPrevLocationValue:!1,daysOfWeek:"SU MO TU WE TH FR SA".split(" "),textValues:["summary","startDate","startTime","endDate","endTime"],daySpanValues:"day0 day1 day2 day3 day4 day5 day6".split(" "),startup:function(){this.dateFormat=Config.Strings.DateYear;this.timeFormat=Config.Strings.CalTimeFormatRange1;this.timeFormatShort=Config.Strings.CalTimeFormatRange2;this.eventInfo=this.model=this.dateInputField=null;this.selectedDays={};this.customSelectUnit=null;
this.sortedDays=[];this.editEvent=!1;this.targetDate=this.showIndexCB=null;this.recurType="0";this.frequency=1;this.inherited(arguments);this.connect(this.startDateInput,"onclick",dojo.hitch(this,"showPicker",this.startDateInput));this.connect(this.endRepeatDateInput,"onclick",dojo.hitch(this,"showPicker",this.endRepeatDateInput));this.connect(this.remindAtEndInput,"onclick",dojo.hitch(this,"showPicker",this.remindAtEndInput));this.connect(this.startTimeInput,"onclick",dojo.hitch(this,"showTimePicker",
this.startTimeInput));this.connect(this.endTimeInput,"onclick",dojo.hitch(this,"showTimePicker",this.endTimeInput));this.setupPickDaySpans();Config.ShowReminderEvent||(this.remindRow.style.display="none",this.remindSummaryRow.style.display="none");Config.EnableCalendarMapLink||(this.mapLink.style.display="none");this.connect(this.eventDatePopupPicker.datePicker,"selectDateConnect","fillInDateField");this.connect(this.eventTimePopupPicker.timePicker,"selectTimeConnect","fillInTimeField");this.connect(this.repeatMenu,
"valueChanged","handleRepeat");this.connect(this.reminderMenu,"valueChanged","handleReminder");this.connect(this.repeatEveryMenu,"valueChanged","handleCustomRepeat");this.connect(this.endDateMenu,"valueChanged","handleEndDate");this.connect(this.customRemindMenu,"valueChanged","handleCustomRemind");this.modelUpdatedHandler=dojo.connect(this.model,"modelUpdated",this,"update");this.subscribe("Suite/onKeyOnPress","_suiteOnKeyPress")},uninitialize:function(){this.modelUpdatedHandler&&dojo.disconnect(this.modelUpdatedHandler)},
update:function(){this.calendarMenu.buildList();this.calendarMenu.selectCalendar();this.saveButton.setEnabled(!0)},setupPickDaySpans:function(){for(var b=0;b<this.daySpanValues.length;b++)this[this.daySpanValues[b]+"Span"].innerHTML=b+ws.date.firstDayOfWeek<ws.date.abbrevDays.length?ws.date.abbrevDays[b+ws.date.firstDayOfWeek]:ws.date.abbrevDays[b+ws.date.firstDayOfWeek-ws.date.abbrevDays.length],this[this.daySpanValues[b]+"Span"].title=b+ws.date.firstDayOfWeek<ws.date.days.length?ws.date.days[b+
ws.date.firstDayOfWeek]:ws.date.days[b+ws.date.firstDayOfWeek-ws.date.days.length],this[this.daySpanValues[b]+"Span"].value=b,this[this.daySpanValues[b]+"Span"].onmouseover=dojo.hitch(this,"onMouseOverSpan",this[this.daySpanValues[b]+"Span"]),this[this.daySpanValues[b]+"Span"].onmouseout=dojo.hitch(this,"onMouseOutSpan",this[this.daySpanValues[b]+"Span"]),this[this.daySpanValues[b]+"Span"].onclick=dojo.hitch(this,"onClickSpan",this[this.daySpanValues[b]+"Span"])},handleRepeat:function(){if(null==
this.eventInfo)this.hideRepeat();else{switch(this.repeatMenu.currentValue){case "doesNotRepeat":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.recurType="0";this.hideRepeat();break;case "everyDay":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.recurType="1";this.recurFreq="DAILY";this.hideRepeat();break;case "everyWeek":this.repeatEverySummarySpan.innerHTML=
"";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.recurType="2";this.recurFreq="WEEKLY";this.hideRepeat();break;case "everyMonth":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.recurType="5";this.recurFreq="MONTHLY";this.hideRepeat();break;case "everyYear":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.recurType="6";this.recurFreq=
"YEARLY";this.hideRepeat();break;case "customRepeat":this.dayIntervalSelect.style.display="",this.monthIntervalSelect.style.display="none",this.repeatEveryInput.value="1",this.customSelectUnit="repeatEveryWeek",this.onTextSpan.style.display="",this.repeatEveryMenu.setOption(1,!0),this.endDateMenu.setOption(0,!0),this.customMonthDateButton.checked=!0,this.recurType="2",this.repeatDialog.style.display="",this.repeatEveryMenu.sizeMyself(),this.endDateMenu.sizeMyself()}this.checkSize()}},handleReminder:function(){if(null==
this.eventInfo)this.hideRemind();else{this.remindInput.style.display="";switch(this.reminderMenu.currentValue){case "noReminder":this.remindSummarySpan.innerHTML="";this.remindSummaryRow.style.display="none";this.reminderEnabled=!1;"reminderLeadTime"in this.eventInfo&&delete this.eventInfo.reminderLeadTime;this.hideRemind();break;case "remindAt":this.remindInput.style.display="none";this.remindInput.parentNode.setAttribute("width","14");dojo.replaceClass(this.remindInput,"remindAt","everyInput");
this.customRemindMenu.setOption(0,!0);this.remindDialog.style.display="";break;case "timeOfEvent":case "min15Before":case "min30Before":case "hour1Before":this.remindSummarySpan.innerHTML="";this.remindSummaryRow.style.display="none";this.reminderEnabled=!0;this.reminderLeadTime=this.getLeadTimeInMinutes(this.reminderMenu.currentValue);this.hideRemind();break;case "customReminder":this.remindInput.parentNode.setAttribute("width","28"),dojo.replaceClass(this.remindInput,"everyInput","remindAt"),this.customRemindMenu.setOption(0,
!0),this.remindInput.value="15",this.remindDialog.style.display=""}this.customRemindMenu.sizeMyself();this.checkSize()}},handleCustomRepeat:function(){"none"!=this.repeatCustomSummary.style.display&&(this.repeatEverySummarySpan.innerHTML="",this.repeatCustomSummary.style.display="none");switch(this.repeatEveryMenu.currentValue){case "repeatEveryDay":this.dayIntervalSelect.style.display="none";this.monthIntervalSelect.style.display="none";this.onTextSpan.style.display="none";this.recurType="1";this.recurFreq=
"DAILY";break;case "repeatEveryWeek":this.dayIntervalSelect.style.display="";this.monthIntervalSelect.style.display="none";this.onTextSpan.style.display="";var b=Config.Strings.CalDateParseFormat,b=ws.date.ParseDateFromFormat(this.startDateInput.value,b);if(null!=b){var c=b.getDay()-ws.date.firstDayOfWeek;0>c&&(c+=7);this.selectedDays[this[this.daySpanValues[c]+"Span"].value]=!0;dojo.addClass(this[this.daySpanValues[c]+"Span"],"pickDaySpanOnHover")}this.recurType="2";this.recurFreq="WEEKLY";break;
case "repeatEveryMonth":c=[Config.Strings.Sunday,Config.Strings.Monday,Config.Strings.Tuesday,Config.Strings.Wednesday,Config.Strings.Thursday,Config.Strings.Friday,Config.Strings.Saturday];b=Config.Strings.CalDateParseFormat;b=ws.date.ParseDateFromFormat(this.startDateInput.value,b);if(null!=b){this.customMonthDate.innerHTML=ws.string.substituteParams(Config.Strings.onTheDate,b.getDate());var d="",d=8>b.getDate()?Config.Strings.First:7<b.getDate()&&15>b.getDate()?Config.Strings.Second:14<b.getDate()&&
22>b.getDate()?Config.Strings.Third:21<b.getDate()&&29>b.getDate()?Config.Strings.Fourth:Config.Strings.Last;this.customMonthDay.innerHTML=ws.string.substituteParams(Config.Strings.onTheDay,d,c[b.getDay()]);this.dayIntervalSelect.style.display="none";this.monthIntervalSelect.style.display="";this.onTextSpan.style.display="none";this.recurType="5";this.recurFreq="MONTHLY"}break;case "repeatEveryYear":this.dayIntervalSelect.style.display="none",this.monthIntervalSelect.style.display="none",this.onTextSpan.style.display=
"none",this.recurType="6",this.recurFreq="YEARLY"}this.customSelectUnit=this.repeatEveryMenu.currentValue;this.checkSize()},handleCustomRemind:function(){switch(this.customRemindMenu.currentValue){case "onThisDate":this.remindAtEndInput.style.display="";this.remindAtEndInput.value=ws.date.formatDateTime(new Date,this.dateFormat);break;case "dayOfEvent":case "oneDayBefore":case "twoDaysBefore":case "oneWeekBefore":case "remindMinutes":case "remindHours":case "remindDays":case "remindWeeks":this.remindAtEndInput.style.display=
"none"}},handleEndDate:function(){switch(this.endDateMenu.currentValue){case "noEndDate":this.endRepeatDateInput.style.display="none";break;case "repeatUntil":var b=ws.date.add(new Date,ws.date.dateParts.DAY,7),b=ws.date.formatDateTime(b,this.dateFormat);this.endRepeatDateInput.value=b;this.endRepeatDateInput.style.display=""}this.customRemindMenu.sizeMyself()},onMouseOverSpan:function(b){dojo.addClass(b,"pickDaySpanOnHover")},onMouseOutSpan:function(b){this.selectedDays[b.value]||dojo.removeClass(b,
"pickDaySpanOnHover")},onClickSpan:function(b){b.value in this.selectedDays?(delete this.selectedDays[b.value],dojo.removeClass(b,"pickDaySpanOnHover")):(this.selectedDays[b.value]=!0,dojo.addClass(b,"pickDaySpanOnHover"))},addLocation:function(){this.addLocationInputArea.className="wsInput addLocationInputShowNew";this.addLocationInputArea.value=Config.Strings.AddLocationHere;this.checkSize()},locationTextType:function(){dojo.hasClass(this.addLocationInputArea,"addLocationInputShow")||(this.addLocationInputArea.value=
"",this.addLocationInputArea.className="wsInput addLocationInputShow")},showMapLink:function(){ws.calendar.calutil.showMapLink(this.addLocationInputArea.value,!1)},setModel:function(b){this.model&&this.modelUpdatedHandler&&dojo.disconnect(this.modelUpdatedHandler);this.model=b;this.modelUpdatedHandler=dojo.connect(this.model,"modelUpdated",this,"update");this.calendarMenu.setModel(b);this.saveButton.setEnabled(this.model.isModelFetchedOnce)},saveAndClose:function(){var b=null,b=null!=this.eventInfo&&
null!=this.eventInfo.startTime||null==this.model?this.validateForm():"Missing event or start time";null===b?this.eventInfo.uid&&this.eventInfo.recurrence?(this.addDialogWidget.style.display="none",ws.calendar.calutil.showConfirmRecurDialog("edit",dojo.hitch(this,function(b,d){b?(this.saveComponent(d),this.resetSearch()):(this.addDialogWidget.style.display="",this.cancelSave())}))):(this.saveComponent(),this.resetSearch()):(this.addDialogWidget.style.display="none",ws.widget.Dialogs.ok(b,dojo.hitch(this,
function(){this.addDialogWidget.style.display=""})))},resetSearch:function(){this.model&&this.model.getSearchString()&&this.model.refreshSearchResult()},cancelSave:function(){},saveComponent:function(b){this.model.saveComponent(this.eventInfo,b,this.origEvent).then(dojo.hitch(this,function(){this.eventInfo.uid?dojo.publish("WSFeedbackStart",[Config.Strings.EventUpdated,!0]):dojo.publish("WSFeedbackStart",[Config.Strings.EventCreated,!0]);this.setDate(this.targetDate);this.onSavedCB&&(this.onSavedCB(),
this.onSavedCB=null);this.selectCalendar(this.eventInfo.folderId)}));this.hide()},selectCalendar:function(b){var c=this.model.getCalendarById(b);c&&!c.isActive&&(c.isActive=!0,this.model.saveCalendar(b,c).then(d.hitch(this,function(){this.model.getEventData()})))},setDate:function(b){},validateForm:function(){var b=null,c=b=null,d=ws.string.sanitize(this.summaryInput.value);if(""==d||d==Config.Strings.AddEventName||dojo.hasClass(this.summaryInput,"summaryInputNew"))return Config.Strings.AddTitleToEvent;
var p=Config.Strings.CalDateParseFormat,b=ws.date.ParseDateFromFormat(this.startDateInput.value,p),c=ws.date.ParseDateFromFormat(this.startDateInput.value,p);if(null==b||null==c)return Config.Strings.InvalidDateOnCreate;if(!this.allDayBox.checked){p=ws.date.ParseHourMinTextField(this.startTimeInput.value,this.timeFormat,this.timeFormatShort);if(null==p)return b=Config.Strings.Calendar_AddEvent_InvalidStart;b.setHours(p.hr,p.min,0,0);var e=ws.date.ParseHourMinTextField(this.endTimeInput.value,this.timeFormat,
this.timeFormatShort);if(null==e)return b=Config.Strings.Calendar_AddEvent_InvalidEnd;b.getDate()==c.getDate()&&(e.hr<p.hr||e.hr==p.hr&&e.min<p.min)&&(c=ws.date.add(c,ws.date.dateParts.HOUR,24));c.setHours(e.hr,e.min,0,0)}if(b>c)return b=Config.Strings.Calendar_AddEvent_InvalidStartAfterEnd;c.getTime()>=b.getTime()+864E5&&(c=ws.date.add(c,ws.date.dateParts.HOUR,-24));if(this.recurType&&"0"!=this.recurType){this.eventInfo.recurrence||(this.eventInfo.recurrence={});this.eventInfo.recurrence.frequency=
this.recurFreq;if("customRepeat"==this.repeatMenu.currentValue&&(p=!1,""!=this.repeatEveryInput.value&&"NaN"!=Number(this.repeatEveryInput.value).toString()?(this.eventInfo.recurrence.interval=Math.floor(+this.repeatEveryInput.value),1>this.eventInfo.recurrence.interval&&(this.eventInfo.recurrence.interval=1),1E4<this.eventInfo.recurrence.interval&&(p=!0)):p=!0,p))return b=Config.Strings.Calendar_AddEvent_InvalidNumberCustomRepeat;if("repeatEveryWeek"==this.customSelectUnit)this.sortSelectedDays(),
this.sortedDays.length&&(this.eventInfo.recurrence.byDay=this.getByDay(this.sortedDays,!0));else if("repeatEveryMonth"==this.customSelectUnit)if(this.customMonthDayButton.checked)p=b.getDate()%7+1,this.eventInfo.recurrence.byDay=[p+this.daysOfWeek[b.getDay()]];else{if(!this.customMonthDateButton.checked)return b=Config.Strings.Calendar_AddEvent_InvalidCustomMonth}else"2"==this.recurType&&b.getDay();if("customRepeat"==this.repeatMenu.currentValue&&"repeatUntil"==this.endDateMenu.currentValue)if(e=
null,p=Config.Strings.CalDateParseFormat,e=this.endRepeatDateInput.value,e=ws.date.ParseDateFromFormat(e,p),null!=e){if(ws.date.ParseDateFromFormat(this.startDateInput.value,p)>e)return b=Config.Strings.Calendar_AddEvent_InvalidStartAfterEnd;e.setHours(23,59,59);this.eventInfo.recurrence.until=ws.date.formatISO8601(e)}else return b=ws.string.substituteParams(Config.Strings.ErrorDateNotValidFormat,Config.Strings.EventRepeatEndDate,Config.Strings.CalDateFormat);else this.eventInfo.recurEnd&&delete this.eventInfo.recurEnd}else this.eventInfo.recurrence&&
delete this.eventInfo.recurrence;if("noReminder"!=this.reminderMenu.currentValue){this.reminderEnabled=!0;p=0;if("customReminder"==this.reminderMenu.currentValue||"remindAt"==this.reminderMenu.currentValue){if(p="remindAt"==this.reminderMenu.currentValue?this.calculateLeadTimeInMinutes(this.customRemindMenu.currentValue,"12:00am",b):this.calculateLeadTimeInMinutes(this.customRemindMenu.currentValue,this.remindInput.value,b),"string"==typeof p)return p}else p=this.getLeadTimeInMinutes(this.reminderMenu.currentValue);
e=60*p;e=b.getTime()/1E3-e;if(0<e){var h=new Date,e=((new Date(1E3*e)).getTime()-h.getTime())/1E3;this.allDayBox.checked&&(e-=3600);if(1>e)return b=Config.Strings.InvalidReminderDateInPastOnCreate}this.eventInfo.reminders={count:1,reminder:[{sendEmail:!0,offset:"-PT"+p+"M"}]}}else this.eventInfo.reminders={count:0};this.targetDate=b;p=ws.string.sanitize(this.addNotesInput.getValue());this.eventInfo.description=p;""==this.addLocationInputArea.value||dojo.hasClass(this.addLocationInputArea,"addLocationInputShowNew")?
this.hasPrevLocationValue?this.eventInfo.location="":delete this.eventInfo.location:this.eventInfo.location=ws.string.sanitize(this.addLocationInputArea.value);this.eventInfo.summary=d;this.eventInfo.startTime=ws.date.formatISO8601(b);this.eventInfo.endTime=ws.date.formatISO8601(c);this.eventInfo.allDay=this.allDayBox.checked;"string"==typeof this.calendarMenu.getValue()&&(this.eventInfo.folderId=this.calendarMenu.getValue());return null},getByDay:function(b,c){for(var d=[],e=0,h=0;h<b.length;h++)e=
c?7>b[h]+ws.date.firstDayOfWeek?b[h]+ws.date.firstDayOfWeek:b[h]+ws.date.firstDayOfWeek-7:b[h],d.push(this.daysOfWeek[e]);return d},decodeSelectedDays:function(){var b=[],c=[],d=this.eventInfo.recurrence.byDay;if(this.eventInfo.recurrence&&this.eventInfo.recurrence.byDay)for(var e=0;e<d.length;e++){var h=this.daysOfWeek.indexOf(d[e])-ws.date.firstDayOfWeek;0>h&&(h+=7);b.push(d[e]);c.push(h)}return{days:b,daysValues:c}},getCustomMonthly:function(b,c){var d=null,d=[Config.Strings.Sunday,Config.Strings.Monday,
Config.Strings.Tuesday,Config.Strings.Wednesday,Config.Strings.Thursday,Config.Strings.Friday,Config.Strings.Saturday];if(b){this.customMonthDayButton.checked=!0;var e=+b[0].charAt(0),h=b[0].substr(1,2),h=this.daysOfWeek.indexOf(h),e=1==e?Config.Strings.First:2==e?Config.Strings.Second:3==e?Config.Strings.Third:4==e?Config.Strings.Fourth:Config.Strings.Last,d=1==c?ws.string.substituteParams(Config.Strings.onTheDayOfEveryMonth,e,d[h],Config.Strings.month):ws.string.substituteParams(Config.Strings.onTheDayOfEveryFreqMonth,
e,d[h],c,Config.Strings.Months)}else this.customMonthDateButton.checked=!0,d=this.model.parseTardisDate(this.eventInfo.startTime),d=1==c?ws.string.substituteParams(Config.Strings.onTheDateOfEveryMonth,d.getDate(),Config.Strings.month):ws.string.substituteParams(Config.Strings.onTheDateOfEveryFreqMonth,d.getDate(),c,Config.Strings.Months);return d},buildReminderMenu:function(b){var c=[];b?(c.push({display:Config.Strings.NoReminder,value:"noReminder",selected:!0}),c.push({display:Config.Strings.RemindMeAt2,
value:"remindAt"})):(c.push({display:Config.Strings.NoReminder,value:"noReminder",selected:!0}),c.push({display:Config.Strings.ReminderAtDateAndTimeAbove,value:"timeOfEvent"}),c.push({display:"15 "+Config.Strings.RemindMinsBefore,value:"min15Before"}),c.push({display:"30 "+Config.Strings.RemindMinsBefore,value:"min30Before"}),c.push({display:"1 "+Config.Strings.HourBefore,value:"hour1Before"}),c.push({display:Config.Strings.CustomReminder,value:"customReminder"}));this.reminderMenu.setOptions(c)},
buildCustomReminderMenu:function(b){var c=[];b?(c.push({display:Config.Strings.DayOfEvent,value:"dayOfEvent",selected:!0}),c.push({display:Config.Strings.OneDayBefore,value:"oneDayBefore"}),c.push({display:Config.Strings.TwoDaysBefore,value:"twoDaysBefore"}),c.push({display:Config.Strings.OneWeekBefore,value:"oneWeekBefore"}),c.push({display:Config.Strings.OnThisDate,value:"onThisDate"})):(c.push({display:Config.Strings.Minutes,value:"remindMinutes",selected:!0}),c.push({display:Config.Strings.Hours,
value:"remindHours"}),c.push({display:Config.Strings.Days,value:"remindDays"}),c.push({display:Config.Strings.Weeks,value:"remindWeeks"}));this.customRemindMenu.setOptions(c)},clearForm:function(){for(var b=0;b<this.textValues.length;b++)this[this.textValues[b]+"Input"].value="";this.allDayBox.setChecked(!0);this.startTimeInput.style.display="none";this.endTimeInput.style.display="none";this.toSpan.style.display="none"},defaultPopulateForm:function(){var b=new Date;this.editEvent=!1;dojo.replaceClass(this.summaryInput,
"summaryInputNew","summaryInput");b=ws.calendar.calutil.GetNext30MinuteIncrement(b);this.startDateInput.value=ws.date.formatDateTime(b,this.dateFormat);this.startTimeInput.value=ws.date.formatDateTime(b,this.timeFormat);b=ws.date.add(b,ws.date.dateParts.MINUTE,30);this.endDateInput.value=ws.date.formatDateTime(b,this.dateFormat);this.endTimeInput.value=ws.date.formatDateTime(b,this.timeFormat);this.allDayBox.setChecked(!0);this.buildReminderMenu(!0);this.buildCustomReminderMenu(!0);this.startTimeInput.style.display=
"none";this.endTimeInput.style.display="none";this.toSpan.style.display="none";this.repeatMenu.setOption(0,!0);this.reminderMenu.setOption(0,!0);this.calendarMenu.setOption(0,!0);this.repeatEveryMenu.setOption(1);this.customRemindMenu.setOption(0,!0);this.endDateMenu.setOption(0,!0);b.setHours(18,0);this.remindInput.value=ws.date.formatDateTime(b,this.timeFormat);this.reminderInputPrevValue="1";this.addNotesInput.setValue();this.addLocationInputArea.value="";this.addLocation()},populateForm:function(b){this.editEvent=
!0;dojo.replaceClass(this.summaryInput,"summaryInput","summaryInputNew");this.eventInfo.folderId?this.calendarMenu.setValue(this.eventInfo.folderId):this.calendarMenu.setByIndex(0);var c=this.eventInfo.summary;null!=b&&4==b&&c==Config.Strings.AddEventName?dojo.replaceClass(this.summaryInput,"summaryInputNew","summaryInput"):c=ws.calendar.calutil.DecodeHTML(c);var d=this.model.parseTardisDate(this.eventInfo.startTime);b=this.model.parseTardisDate(this.eventInfo.endTime);this.summaryInput.value=c;this.startDateInput.value=
ws.date.formatDateTime(d,this.dateFormat);this.startTimeInput.value=ws.date.formatDateTime(d,this.timeFormat);this.endDateInput.value=ws.date.formatDateTime(b,this.dateFormat);this.endTimeInput.value=ws.date.formatDateTime(b,this.timeFormat);this.allDayBox.setChecked(this.eventInfo.allDay);this.checkBoxChange();if(this.eventInfo.recurrence){var e=c=null;b=this.eventInfo.recurrence;var h=+b.interval;this.recurId=ws.date.formatISO8601(d);if(0<h)e=1==h?!0:!1;else return;switch(b.frequency){case "DAILY":e&&
!b.until?(this.repeatEverySummarySpan.innerHTML="",this.repeatMenu.setOption(1,!0)):(this.repeatMenu.setOption(5,!0),this.repeatDialog.style.display="",this.repeatEveryInput.value=h,this.repeatEveryMenu.setOption(0),this.handleCustomRepeat(),c=Config.Strings.Every+" "+h+" "+Config.Strings.Days);break;case "WEEKLY":d=this.decodeSelectedDays();if(d.days.length){c=e?Config.Strings.EveryWeekOn+" ":Config.Strings.Every+" "+h+" "+Config.Strings.WeeksOn;if(1<d.days.length){for(e=0;e<d.days.length-1;e++)var t=
ws.date.days[this.daysOfWeek.indexOf(d.days[e])],c=e<d.days.length-2?c+(t+", "):c+t;c+=" "+Config.Strings.And+" "+ws.date.days[this.daysOfWeek.indexOf(d.days[e])]}else c+=ws.date.days[this.daysOfWeek.indexOf(d.days[0])];this.repeatMenu.setOption(5);this.repeatDialog.style.display="";this.repeatEveryInput.value=h;this.repeatEveryMenu.setOption(1);this.handleCustomRepeat();for(e=0;e<d.daysValues.length;e++)this.selectedDays[d.daysValues[e]]=!0;this.setupDaySpans()}else this.repeatMenu.setOption(2);
break;case "MONTHLY":this.repeatMenu.setOption(5,!0);this.repeatDialog.style.display="";this.repeatEveryInput.value=h;this.repeatEveryMenu.setOption(2,!0);this.handleCustomRepeat();c=this.getCustomMonthly(b.byDay,h);break;case "YEARLY":this.repeatMenu.setOption(5,!0),this.repeatDialog.style.display="",this.repeatEveryInput.value=h,this.repeatEveryMenu.setOption(3,!0),this.handleCustomRepeat(),c=e?Config.Strings.EveryYear:Config.Strings.Every+" "+h+" "+Config.Strings.Years}b&&b.until?(this.endDateMenu.setOption(1,
!0),b=8<=b.until.length?b.until.substring(0,8):b.until,b=this.model.parseTardisDate(b),this.endRepeatDateInput.value=ws.date.formatDateTime(b,Config.Strings.CalDateFormat),this.endRepeatDateInput.style.display=""):this.endDateMenu.setOption(0,!0);c&&(this.repeatCustomSummary.style.display="",this.repeatEverySummarySpan.innerHTML=c)}else this.repeatMenu.setOption(0,!0);this.buildReminderMenu(this.eventInfo.allDay);this.buildCustomReminderMenu(this.eventInfo.allDay);c=this.model.parseTardisLeadTime(this.eventInfo);
(b=this.eventInfo.reminders&&0<this.eventInfo.reminders.count)&&this.eventInfo.allDay?(this.reminderMenu.setOption(1,!0),this._populateCustomReminder(c,!0,this.eventInfo.startTime)):b?(b=this.getReminderLeadTime(c),"number"==typeof b?this.reminderMenu.setOption(b,!0):(this.reminderMenu.setOption(5,!0),this._populateCustomReminder(c))):(this.reminderMenu.setOption(0,!0),c=new Date,c.setHours(18,0),this.remindInput.value=ws.date.formatDateTime(c,this.timeFormat),this.reminderInputPrevValue="1");this.eventInfo.description?
this.addNotesInput.setValue(ws.calendar.calutil.DecodeHTML(this.eventInfo.description)):this.addNotesInput.setValue();this.eventInfo.location&&null!=this.eventInfo.location&&""!=this.eventInfo.location?(this.addLocationInputArea.className="wsInput addLocationInputShow",this.addLocationInputArea.value=ws.calendar.calutil.DecodeHTML(this.eventInfo.location),this.hasPrevLocationValue=!0):(this.addLocationInputArea.value="",this.addLocation())},_populateCustomReminder:function(b,c,d){if(c){c=new Date;
var e=0,h=0;if(1440>=b)d=1,0==b?(c.setHours(0,0),d=0):1440==b?c.setHours(0,0):(e=Math.ceil(b/60),h=b%60,c.setHours(0==e?0:24-e,0==h?0:60-h)),this.remindInput.value=ws.date.formatDateTime(c,this.timeFormat),this.customRemindMenu.setOption(d,!0);else if(2880>=b)2880==b?c.setHours(0,0):(e=Math.ceil((b-1440)/60),h=(b-1440)%60,c.setHours(24-e,0==h?0:60-h)),this.remindInput.value=ws.date.formatDateTime(c,this.timeFormat),this.customRemindMenu.setOption(2,!0);else{var r=Math.ceil(b/1440);b%=1440*(r-1);e=
Math.ceil(b/60);h=b%60;c.setHours(24-e,0==h?0:60-h);c.setFullYear(d.getFullYear(),d.getMonth(),d.getDate()-r);this.remindInput.value=ws.date.formatDateTime(c,this.timeFormat);this.customRemindMenu.setOption(4,!0);this.remindAtEndInput.value=ws.date.formatDateTime(c,this.dateFormat)}this.reminderInputPrevValue="1"}else 0==b%10080?(this.remindInput.value=b/10080,this.customRemindMenu.setOption(3,!0)):0==b%1440?(this.remindInput.value=b/1440,this.customRemindMenu.setOption(2,!0)):0==b%60?(this.remindInput.value=
b/60,this.customRemindMenu.setOption(1,!0)):(this.remindInput.value=b,this.customRemindMenu.setOption(0,!0)),c=new Date,c.setHours(18,0),this.reminderInputPrevValue=ws.date.formatDateTime(c,this.timeFormat)},toggleTitle:function(b){"Add"==b?(this.dlgTitleEdit.style.display="none",this.dlgTitleAdd.style.display="",this.saveButton.setLabel(Config.Strings.AddEventBtn)):(this.dlgTitleEdit.style.display="",this.dlgTitleAdd.style.display="none",this.saveButton.setLabel(Config.Strings.Save))},show:function(b,
c){this.hide();this.eventInfo=null;this.recurType="0";this.frequency=1;this.toggleTitle("Edit");this.calendarMenu.allowCalendarEdit=!0;this.eventDatePopupPicker.clearSelectedDate();if(c){var d=this.model.getCalendarById(c.folderId);d&&(this.calendarMenu.allowCalendarEdit=!(d.isRemote||d.url))}this.calendarMenu.buildList(c?c.folderId:null);if(1==b||4==b)if(c)this.origEvent=c,this.eventInfo=ws.lang.shallowCopy(c),null==this.eventInfo.uid&&this.toggleTitle("Add"),this.populateForm(b),this.inherited(arguments);
else return;else 2==b?(this.model.isSuccess||this.model.getData(),this.defaultPopulateForm(),this.eventInfo=this.model.getDefaultArgs(),null!=c.description&&""!=c.description&&this.addNotesInput.setValue(c.description),null!=c.location&&""!=c.location&&(this.addLocationInputArea.className="wsInput addLocationInputShow",this.addLocationInputArea.value=c.location,this.hasPrevLocationValue=!0),c.startTime&&(this.startDateInput.value=ws.date.formatDateTime(c.startTime,this.dateFormat),this.startTimeInput.value=
ws.date.formatDateTime(c.startTime,this.timeFormat)),this.toggleTitle("Add"),this.inherited(arguments),null!=c.summary&&""!=c.summary?(dojo.replaceClass(this.summaryInput,"summaryInput","summaryInputNew"),this.summaryInput.value=c.summary):ws.lang.setTimeout(this,function(){this.summaryInput.value=Config.Strings.AddEventName;ws.html.selectInputText(this.summaryInput)},50)):(this.toggleTitle("Add"),this.eventInfo=this.model.getDefaultComponentArgs(),this.populateForm(),this.inherited(arguments),ws.lang.setTimeout(this,
function(){this.summaryInput.value=Config.Strings.AddEventName;ws.html.selectInputText(this.summaryInput)},0));this.repeatMenu.sizeMyself();this.repeatEveryMenu.sizeMyself();this.endDateMenu.sizeMyself();this.reminderMenu.sizeMyself();this.customRemindMenu.sizeMyself()},hide:function(){this.hideRepeat();this.customSelectUnit=null;this.sortedDays=[];this.hideRemind();this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.remindSummarySpan.innerHTML="";this.remindSummaryRow.style.display=
"none";this.addNotesInput.setValue();this.addLocation();this.inherited(arguments)},checkBoxChange:function(b){if(this.allDayBox.checked){if(this.startTimeInput.style.display="none",this.endTimeInput.style.display="none",this.customRemindBeforeSpan.style.display="none",dojo.replaceClass(this.remindInput,"remindAt","everyInput"),this.remindInput.parentNode.setAttribute("width","14"),this.remindInput.onclick=dojo.hitch(this,"showTimePicker",this.remindInput),this.toSpan.style.display="none",b){this.buildReminderMenu(!0);
this.buildCustomReminderMenu(!0);var c=this.reminderInputPrevValue?this.reminderInputPrevValue:"6:00pm"}}else this.startTimeInput.style.display="",this.endTimeInput.style.display="",this.customRemindBeforeSpan.style.display="",dojo.replaceClass(this.remindInput,"everyInput","remindAt"),this.remindInput.parentNode.setAttribute("width","28"),this.remindInput.onclick=function(){},this.toSpan.style.display="",b&&(this.buildReminderMenu(!1),this.buildCustomReminderMenu(!1),c=this.reminderInputPrevValue?
this.reminderInputPrevValue:"1");b&&(this.reminderMenu.setOption(0,!0),this.reminderInputPrevValue=this.remindInput.value,this.remindInput.value=c)},showPicker:function(b){this.eventDatePopupPicker.isShowing()||(ws.widget.popup({popup:this.eventDatePopupPicker,around:b,orient:{BL:"TL"}}),this.dateInputField=b)},showTimePicker:function(b){if(!this.eventTimePopupPicker.isShowing()){ws.widget.popup({popup:this.eventTimePopupPicker,around:b,orient:{BL:"TL"}});this.timeInputField=b;var c=new Date;b=ws.date.ParseHourMinTextField(b.value,
this.timeFormat,this.timeFormatShort);null!=b?(c.setHours(b.hr,b.min,0,0),this.eventTimePopupPicker.initializeTime(c)):this.eventTimePopupPicker.initializeTime()}},fillInDateField:function(b){this.dateInputField.value=ws.date.formatDateTime(new Date(b),this.dateFormat);this.dateInputField==this.startDateInput&&"repeatEveryMonth"==this.repeatEveryMenu.currentValue&&this.handleCustomRepeat();this.dateInputField==this.startDateInput?(ws.date.ParseDateFromFormat(this.endDateInput.value,Config.Strings.CalDateParseFormat)<
b&&(this.endDateInput.value=this.dateInputField.value),this.endDateInput.value=this.startDateInput.value):this.dateInputField==this.endDateInput&&(ws.date.ParseDateFromFormat(this.startDateInput.value,Config.Strings.CalDateParseFormat)>b&&(this.startDateInput.value=this.dateInputField.value),this.startDateInput.value=this.endDateInput.value)},fillInTimeField:function(b){this.timeInputField.value=b},monthButtonChange:function(){this.recurType=this.customMonthDateButton.checked?"5":"4"},setupDaySpans:function(){for(var b in this.selectedDays)switch(b){case "0":dojo.addClass(this.day0Span,
"pickDaySpanOnHover");break;case "1":dojo.addClass(this.day1Span,"pickDaySpanOnHover");break;case "2":dojo.addClass(this.day2Span,"pickDaySpanOnHover");break;case "3":dojo.addClass(this.day3Span,"pickDaySpanOnHover");break;case "4":dojo.addClass(this.day4Span,"pickDaySpanOnHover");break;case "5":dojo.addClass(this.day5Span,"pickDaySpanOnHover");break;case "6":dojo.addClass(this.day6Span,"pickDaySpanOnHover")}},sortSelectedDays:function(){for(var b in this.selectedDays)this.sortedDays.push(+b);this.sortedDays.sort(function(b,
d){return b-d})},hideRepeat:function(){this.selectedDays={};for(var b=0;b<this.daySpanValues.length;b++)dojo.removeClass(this[this.daySpanValues[b]+"Span"],"pickDaySpanOnHover");this.repeatDialog.style.display="none"},hideRemind:function(){this.remindDialog.style.display="none"},getLeadTimeInMinutes:function(b){var c=0;switch(b){case "timeOfEvent":c=0;break;case "min15Before":c=15;break;case "min30Before":c=30;break;case "hour1Before":c=60;break;case "day1Before":c=1440;break;default:c=0}return c},
calculateLeadTimeInMinutes:function(b,c,d){var e=0;switch(b){case "remindMinutes":c=Math.round(new Number(c));if("NaN"==c)return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;e=c;break;case "remindHours":c=Math.round(new Number(c));if("NaN"==c)return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;e=c*this.getLeadTimeInMinutes("hour1Before");break;case "remindDays":c=Math.round(new Number(c));if("NaN"==c)return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;e=c*
this.getLeadTimeInMinutes("day1Before");break;case "remindWeeks":c=Math.round(new Number(c));if("NaN"==c)return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;e=c*this.getLeadTimeInMinutes("day1Before")*7;break;case "dayOfEvent":e=0;break;case "oneDayBefore":e=this._getLeadTime(ws.date.ParseHourMinTextField(c,this.timeFormat,this.timeFormatShort),1);break;case "twoDaysBefore":e=this._getLeadTime(ws.date.ParseHourMinTextField(c,this.timeFormat,this.timeFormatShort),2);break;case "oneWeekBefore":e=
this._getLeadTime(ws.date.ParseHourMinTextField(c,this.timeFormat,this.timeFormatShort),7);break;case "onThisDate":b=ws.date.ParseDateFromFormat(this.remindAtEndInput.value,Config.Strings.CalDateParseFormat);e=this._getLeadTime(ws.date.ParseHourMinTextField(c,this.timeFormat,this.timeFormatShort),b,d);break;default:e=0}return e},_getLeadTime:function(b,c,d){if(null==b)return Config.Strings.Calendar_AddEvent_InvalidTimeCustomRemind;if(d&&"object"==typeof c)return d=new Date(d.getFullYear(),d.getMonth(),
d.getDate(),0,0,0,0),b=new Date(c.getFullYear(),c.getMonth(),c.getDate(),b.hr,b.min,0,0),b=d.getTime()-b.getTime(),0<b?Math.round(b/1E3/60):Config.Strings.Calendar_AddEvent_ReminderAfterEvent;var e=new Date;d=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0);b=new Date(e.getFullYear(),e.getMonth(),e.getDate()-c,b.hr,b.min,0,0);b=d.getTime()-b.getTime();return Math.round(b/1E3/60)},getReminderLeadTime:function(b){var c=null;switch(b){case 0:c=1;break;case 15:c=2;break;case 30:c=3;break;case 60:c=
4;break;default:c=ws.string.substituteParams(Config.Strings.RemindBefore,b,Config.Strings.Minutes)}return c},summaryTextClick:function(){dojo.hasClass(this.summaryInput,"summaryInputNew")&&(this.summaryInput.value="",dojo.replaceClass(this.summaryInput,"summaryInput","summaryInputNew"))},summaryKeyPress:function(){dojo.hasClass(this.summaryInput,"summaryInputNew")&&dojo.replaceClass(this.summaryInput,"summaryInput","summaryInputNew")},summaryTextBlur:function(){""==this.summaryInput.value&&(dojo.addClass(this.summaryInput,
"summaryInputNew"),this.summaryInput.value=Config.Strings.AddEventName)},_suiteOnKeyPress:function(b){this.isShowing()&&(Config.EnableKeyboardShortcuts&&b.ctrlKey?ws.html.fixKeyCodeForMac(b)==dojo.keys.ENTER&&this.saveAndClose():b.keyChar&&dojo.isString(b.keyChar)&&b.keyChar.toLowerCase()==Config.Strings.KeyCancelAddContact&&b.altKey&&this.hide())}})})},"ws/calendar/CalendarSelect":function(){define("ws/calendar/CalendarSelect",["dojo/_base/declare","dojo/text!ws/calendar/CalendarSelect.css","ws/widget/DropDownLink",
"ws/calendar/calutil","ws/lang"],function(v,l,m){return v([m],{css:{templateString:l},constructor:function(){this.model=null;this.menuDef=[];this.currentValue=null;this.valueChanged=this.calendarSelected;this.setOption=this.setByIndex},model:null,menuDef:null,currentValue:null,listWritableCalendars:!0,allowCalendarEdit:!0,postCreate:function(){dojo.addClass(this.domNode,"wsIcon")},onClick:function(){1!=this.model.calendars.length&&(this.anchorPosition=dojo.query(".text",this.containerNode)[0],this.inherited(arguments))},
setModel:function(d){this.model=d;this.menuDef=[];this.currentValue=null},selectCalendar:function(d){if(d)for(var e=this.model.calendars,h,t=0;t<e.length;t++){if(h=e[t],h.id==d){this.calendarMenuClick(t);break}}else this.calendarMenuClick(0)},buildList:function(d){if(null!=this.model){this.menuDef=[];this.currentValue=null;var e,h,t,b,c,r=this.model.calendars;if(0!=r.length){r||this.menuDef.push({caption:"",enabled:!1,calid:""});for(var p=0,l=0;p<r.length;p++)if(e=r[p],this.listWritableCalendars&&
!e.isReadOnly&&(t=!ws.lang.undefinedOrNull(e.url)&&0<e.url.length,!this.allowCalendarEdit||!(t||e.isRemote&&d)))if(this.allowCalendarEdit||e.id==d)b=e.name,c=ws.string.escapeXml(b),h=ws.calendar.calutil.convertToAolColor(e.color),b="wsCalCB_"+h.substring(1)+" checked",h="wsCalCB_"+h.substring(1)+"_c",b='\x3cdiv class\x3d"calendarItem"\x3e\x3cdiv class\x3d"wsCalCB '+b+'"\x3e\x3c/div\x3e\x3cdiv class\x3d"text '+h+'"\x3e\x3cspan\x3e'+c+"\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e",this.menuDef.push({caption:b,
onClick:dojo.hitch(this,"calendarMenuClick",l++),enabled:!0,calid:e.id,calType:e.types[0],subscribeUrl:null,isIcalSubcal:t,color:e.color});1<r.length&&(this.setMenuDefinition(this.menuDef),this.getMenu());d&&this.selectCalendar(d)}}},calendarMenuClick:function(d){if(0!=this.menuDef.length){if(d>this.menuDef.length-1||0==this.menuDef.length)d=0;this.setLabel(this.menuDef[d].caption);dojo.addClass(this.containerNode.firstChild,"calendarLabel");var e=dojo.query(".text",this.domNode)[0].firstChild;this.currentValue=
this.menuDef[d].calid;e.style.color=ws.calendar.calutil.convertToYahooColor(this.menuDef[d].color);this.calendarSelected(this.menuDef[d])}},getValue:function(){return this.currentValue},setValue:function(d){for(var e=0;e<this.menuDef.length;e++)if(this.menuDef[e].calid==d){this.calendarMenuClick(e);break}},calendarSelected:function(d){},setByIndex:function(d){this.calendarMenuClick(d)}})})},"linkify/linkify-full":function(){define(["dojo","dijit","dojox"],function(v,l,m){!function(){var d="function"==
typeof Symbol&&"symbol"==typeof Symbol.iterator?function(d){return typeof d}:function(d){return d&&"function"==typeof Symbol&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d};!function(e){function h(a,b){var f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},c=Object.create(a.prototype),g;for(g in f)c[g]=f[g];return c.constructor=b,b.prototype=c,b}function t(a){a=a||{};this.defaultProtocol=a.hasOwnProperty("defaultProtocol")?a.defaultProtocol:q.defaultProtocol;this.events=
a.hasOwnProperty("events")?a.events:q.events;this.format=a.hasOwnProperty("format")?a.format:q.format;this.formatHref=a.hasOwnProperty("formatHref")?a.formatHref:q.formatHref;this.nl2br=a.hasOwnProperty("nl2br")?a.nl2br:q.nl2br;this.tagName=a.hasOwnProperty("tagName")?a.tagName:q.tagName;this.target=a.hasOwnProperty("target")?a.target:q.target;this.validate=a.hasOwnProperty("validate")?a.validate:q.validate;this.ignoreTags=[];this.attributes=a.attributes||a.linkAttributes||q.attributes;this.className=
a.hasOwnProperty("className")?a.className:a.linkClass||q.className;a=a.hasOwnProperty("ignoreTags")?a.ignoreTags:q.ignoreTags;for(var b=0;b<a.length;b++)this.ignoreTags.push(a[b].toUpperCase())}function b(a){return a}function c(){return function(a){this.j=[];this.T=a||null}}function r(a,b,f,c){for(var d=0,k=a.length,u=[],e=void 0;d<k&&(e=b.next(a[d]));)b=e,d++;if(d>=k)return[];for(;d<k-1;)e=new g(c),u.push(e),b.on(a[d],e),b=e,d++;return e=new g(f),u.push(e),b.on(a[k-1],e),u}function p(){return function(a){a&&
(this.v=a)}}function l(a){a=a?{v:a}:{};return h(k,p(),a)}function m(a){return a instanceof w||a instanceof J}var q={defaultProtocol:"http",events:null,format:b,formatHref:b,nl2br:!1,tagName:"a",target:function(a,b){return"url"===b?"_blank":null},validate:!0,ignoreTags:[],attributes:null,className:"linkified"};t.prototype={resolve:function(a){var b=a.toHref(this.defaultProtocol);return{formatted:this.get("format",a.toString(),a),formattedHref:this.get("formatHref",b,a),tagName:this.get("tagName",b,
a),className:this.get("className",b,a),target:this.get("target",b,a),events:this.getObject("events",b,a),attributes:this.getObject("attributes",b,a)}},check:function(a){return this.get("validate",a.toString(),a)},get:function(a,b,f){var c=void 0,g=this[a];if(!g)return g;switch("undefined"==typeof g?"undefined":d(g)){case "function":return g(b,f.type);case "object":return c=g.hasOwnProperty(f.type)?g[f.type]:q[a],"function"==typeof c?c(b,f.type):c}return g},getObject:function(a,b,f){a=this[a];return"function"==
typeof a?a(b,f.type):a}};var D=Object.freeze({defaults:q,Options:t,contains:function(a,b){for(var f=0;f<a.length;f++)if(a[f]===b)return!0;return!1}}),a=c();a.prototype={defaultTransition:!1,on:function(a,b){if(a instanceof Array){for(var f=0;f<a.length;f++)this.j.push([a[f],b]);return this}return this.j.push([a,b]),this},next:function(a){for(var b=0;b<this.j.length;b++){var f=this.j[b],c=f[1];if(this.test(a,f[0]))return c}return this.defaultTransition},accepts:function(){return!!this.T},test:function(a,
b){return a===b},emit:function(){return this.T}};var g=h(a,c(),{test:function(a,b){return a===b||b instanceof RegExp&&b.test(a)}}),u=h(a,c(),{jump:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,f=this.next(new a(""));return f===this.defaultTransition?(f=new this.constructor(b),this.on(a,f)):b&&(f.T=b),f},test:function(a,b){return a instanceof b}}),k=p();k.prototype={toString:function(){return this.v+""}};var w=l(),f=l("@"),x=l(":"),K=l("."),fa=l(),E=l(),na=l("\n"),I=
l(),v=l("+"),R=l("#"),U=l(),V=l("mailto:"),ga=l("?"),L=l("/"),W=l("_"),ha=l(),J=l(),n=l(),O=l("{"),M=l("["),P=l("\x3c"),X=l("("),Q=l("}"),ia=l("]"),Y=l("\x3e"),ja=l(")"),Aa=l("\x26"),kb=Object.freeze({Base:k,DOMAIN:w,AT:f,COLON:x,DOT:K,PUNCTUATION:fa,LOCALHOST:E,NL:na,NUM:I,PLUS:v,POUND:R,QUERY:ga,PROTOCOL:U,MAILTO:V,SLASH:L,UNDERSCORE:W,SYM:ha,TLD:J,WS:n,OPENBRACE:O,OPENBRACKET:M,OPENANGLEBRACKET:P,OPENPAREN:X,CLOSEBRACE:Q,CLOSEBRACKET:ia,CLOSEANGLEBRACKET:Y,CLOSEPAREN:ja,AMPERSAND:Aa}),Ta="aaa aarp abarth abb abbott abbvie abc able abogado abudhabi ac academy accenture accountant accountants aco active actor ad adac ads adult ae aeg aero aetna af afamilycompany afl africa ag agakhan agency ai aig aigo airbus airforce airtel akdn al alfaromeo alibaba alipay allfinanz allstate ally alsace alstom am americanexpress americanfamily amex amfam amica amsterdam analytics android anquan anz ao aol apartments app apple aq aquarelle ar arab aramco archi army arpa art arte as asda asia associates at athleta attorney au auction audi audible audio auspost author auto autos avianca aw aws ax axa az azure ba baby baidu banamex bananarepublic band bank bar barcelona barclaycard barclays barefoot bargains baseball basketball bauhaus bayern bb bbc bbt bbva bcg bcn bd be beats beauty beer bentley berlin best bestbuy bet bf bg bh bharti bi bible bid bike bing bingo bio biz bj black blackfriday blanco blockbuster blog bloomberg blue bm bms bmw bn bnl bnpparibas bo boats boehringer bofa bom bond boo book booking boots bosch bostik boston bot boutique box br bradesco bridgestone broadway broker brother brussels bs bt budapest bugatti build builders business buy buzz bv bw by bz bzh ca cab cafe cal call calvinklein cam camera camp cancerresearch canon capetown capital capitalone car caravan cards care career careers cars cartier casa case caseih cash casino cat catering catholic cba cbn cbre cbs cc cd ceb center ceo cern cf cfa cfd cg ch chanel channel chase chat cheap chintai chloe christmas chrome chrysler church ci cipriani circle cisco citadel citi citic city cityeats ck cl claims cleaning click clinic clinique clothing cloud club clubmed cm cn co coach codes coffee college cologne com comcast commbank community company compare computer comsec condos construction consulting contact contractors cooking cookingchannel cool coop corsica country coupon coupons courses cr credit creditcard creditunion cricket crown crs cruise cruises csc cu cuisinella cv cw cx cy cymru cyou cz dabur dad dance data date dating datsun day dclk dds de deal dealer deals degree delivery dell deloitte delta democrat dental dentist desi design dev dhl diamonds diet digital direct directory discount discover dish diy dj dk dm dnp do docs doctor dodge dog doha domains dot download drive dtv dubai duck dunlop duns dupont durban dvag dvr dz earth eat ec eco edeka edu education ee eg email emerck energy engineer engineering enterprises epost epson equipment er ericsson erni es esq estate esurance et etisalat eu eurovision eus events everbank exchange expert exposed express extraspace fage fail fairwinds faith family fan fans farm farmers fashion fast fedex feedback ferrari ferrero fi fiat fidelity fido film final finance financial fire firestone firmdale fish fishing fit fitness fj fk flickr flights flir florist flowers fly fm fo foo food foodnetwork football ford forex forsale forum foundation fox fr free fresenius frl frogans frontdoor frontier ftr fujitsu fujixerox fun fund furniture futbol fyi ga gal gallery gallo gallup game games gap garden gb gbiz gd gdn ge gea gent genting george gf gg ggee gh gi gift gifts gives giving gl glade glass gle global globo gm gmail gmbh gmo gmx gn godaddy gold goldpoint golf goo goodhands goodyear goog google gop got gov gp gq gr grainger graphics gratis green gripe grocery group gs gt gu guardian gucci guge guide guitars guru gw gy hair hamburg hangout haus hbo hdfc hdfcbank health healthcare help helsinki here hermes hgtv hiphop hisamitsu hitachi hiv hk hkt hm hn hockey holdings holiday homedepot homegoods homes homesense honda honeywell horse hospital host hosting hot hoteles hotels hotmail house how hr hsbc ht htc hu hughes hyatt hyundai ibm icbc ice icu id ie ieee ifm ikano il im imamat imdb immo immobilien in industries infiniti info ing ink institute insurance insure int intel international intuit investments io ipiranga iq ir irish is iselect ismaili ist istanbul it itau itv iveco iwc jaguar java jcb jcp je jeep jetzt jewelry jio jlc jll jm jmp jnj jo jobs joburg jot joy jp jpmorgan jprs juegos juniper kaufen kddi ke kerryhotels kerrylogistics kerryproperties kfh kg kh ki kia kim kinder kindle kitchen kiwi km kn koeln komatsu kosher kp kpmg kpn kr krd kred kuokgroup kw ky kyoto kz la lacaixa ladbrokes lamborghini lamer lancaster lancia lancome land landrover lanxess lasalle lat latino latrobe law lawyer lb lc lds lease leclerc lefrak legal lego lexus lgbt li liaison lidl life lifeinsurance lifestyle lighting like lilly limited limo lincoln linde link lipsy live living lixil lk loan loans locker locus loft lol london lotte lotto love lpl lplfinancial lr ls lt ltd ltda lu lundbeck lupin luxe luxury lv ly ma macys madrid maif maison makeup man management mango map market marketing markets marriott marshalls maserati mattel mba mc mckinsey md me med media meet melbourne meme memorial men menu meo merckmsd metlife mg mh miami microsoft mil mini mint mit mitsubishi mk ml mlb mls mm mma mn mo mobi mobile mobily moda moe moi mom monash money monster mopar mormon mortgage moscow moto motorcycles mov movie movistar mp mq mr ms msd mt mtn mtr mu museum mutual mv mw mx my mz na nab nadex nagoya name nationwide natura navy nba nc ne nec net netbank netflix network neustar new newholland news next nextdirect nexus nf nfl ng ngo nhk ni nico nike nikon ninja nissan nissay nl no nokia northwesternmutual norton now nowruz nowtv np nr nra nrw ntt nu nyc nz obi observer off office okinawa olayan olayangroup oldnavy ollo om omega one ong onl online onyourside ooo open oracle orange org organic origins osaka otsuka ott ovh pa page panasonic panerai paris pars partners parts party passagens pay pccw pe pet pf pfizer pg ph pharmacy phd philips phone photo photography photos physio piaget pics pictet pictures pid pin ping pink pioneer pizza pk pl place play playstation plumbing plus pm pn pnc pohl poker politie porn post pr pramerica praxi press prime pro prod productions prof progressive promo properties property protection pru prudential ps pt pub pw pwc py qa qpon quebec quest qvc racing radio raid re read realestate realtor realty recipes red redstone redumbrella rehab reise reisen reit reliance ren rent rentals repair report republican rest restaurant review reviews rexroth rich richardli ricoh rightathome ril rio rip rmit ro rocher rocks rodeo rogers room rs rsvp ru rugby ruhr run rw rwe ryukyu sa saarland safe safety sakura sale salon samsclub samsung sandvik sandvikcoromant sanofi sap sapo sarl sas save saxo sb sbi sbs sc sca scb schaeffler schmidt scholarships school schule schwarz science scjohnson scor scot sd se search seat secure security seek select sener services ses seven sew sex sexy sfr sg sh shangrila sharp shaw shell shia shiksha shoes shop shopping shouji show showtime shriram si silk sina singles site sj sk ski skin sky skype sl sling sm smart smile sn sncf so soccer social softbank software sohu solar solutions song sony soy space spiegel spot spreadbetting sr srl srt st stada staples star starhub statebank statefarm statoil stc stcgroup stockholm storage store stream studio study style su sucks supplies supply support surf surgery suzuki sv swatch swiftcover swiss sx sy sydney symantec systems sz tab taipei talk taobao target tatamotors tatar tattoo tax taxi tc tci td tdk team tech technology tel telecity telefonica temasek tennis teva tf tg th thd theater theatre tiaa tickets tienda tiffany tips tires tirol tj tjmaxx tjx tk tkmaxx tl tm tmall tn to today tokyo tools top toray toshiba total tours town toyota toys tr trade trading training travel travelchannel travelers travelersinsurance trust trv tt tube tui tunes tushu tv tvs tw tz ua ubank ubs uconnect ug uk unicom university uno uol ups us uy uz va vacations vana vanguard vc ve vegas ventures verisign versicherung vet vg vi viajes video vig viking villas vin vip virgin visa vision vista vistaprint viva vivo vlaanderen vn vodka volkswagen volvo vote voting voto voyage vu vuelos wales walmart walter wang wanggou warman watch watches weather weatherchannel webcam weber website wed wedding weibo weir wf whoswho wien wiki williamhill win windows wine winners wme wolterskluwer woodside work works world wow ws wtc wtf xbox xerox xfinity xihuan xin xn--11b4c3d xn--1ck2e1b xn--1qqw23a xn--2scrj9c xn--30rr7y xn--3bst00m xn--3ds443g xn--3e0b707e xn--3hcrj9c xn--3oq18vl8pn36a xn--3pxu8k xn--42c2d9a xn--45br5cyl xn--45brj9c xn--45q11c xn--4gbrim xn--54b7fta0cc xn--55qw42g xn--55qx5d xn--5su34j936bgsg xn--5tzm5g xn--6frz82g xn--6qq986b3xl xn--80adxhks xn--80ao21a xn--80aqecdr1a xn--80asehdb xn--80aswg xn--8y0a063a xn--90a3ac xn--90ae xn--90ais xn--9dbq2a xn--9et52u xn--9krt00a xn--b4w605ferd xn--bck1b9a5dre4c xn--c1avg xn--c2br7g xn--cck2b3b xn--cg4bki xn--clchc0ea0b2g2a9gcd xn--czr694b xn--czrs0t xn--czru2d xn--d1acj3b xn--d1alf xn--e1a4c xn--eckvdtc9d xn--efvy88h xn--estv75g xn--fct429k xn--fhbei xn--fiq228c5hs xn--fiq64b xn--fiqs8s xn--fiqz9s xn--fjq720a xn--flw351e xn--fpcrj9c3d xn--fzc2c9e2c xn--fzys8d69uvgm xn--g2xx48c xn--gckr3f0f xn--gecrj9c xn--gk3at1e xn--h2breg3eve xn--h2brj9c xn--h2brj9c8c xn--hxt814e xn--i1b6b1a6a2e xn--imr513n xn--io0a7i xn--j1aef xn--j1amh xn--j6w193g xn--jlq61u9w7b xn--jvr189m xn--kcrx77d1x4a xn--kprw13d xn--kpry57d xn--kpu716f xn--kput3i xn--l1acc xn--lgbbat1ad8j xn--mgb9awbf xn--mgba3a3ejt xn--mgba3a4f16a xn--mgba7c0bbn0a xn--mgbaakc7dvf xn--mgbaam7a8h xn--mgbab2bd xn--mgbai9azgqp6j xn--mgbayh7gpa xn--mgbb9fbpob xn--mgbbh1a xn--mgbbh1a71e xn--mgbc0a9azcg xn--mgbca7dzdo xn--mgberp4a5d4ar xn--mgbgu82a xn--mgbi4ecexp xn--mgbpl2fh xn--mgbt3dhd xn--mgbtx2b xn--mgbx4cd0ab xn--mix891f xn--mk1bu44c xn--mxtq1m xn--ngbc5azd xn--ngbe9e0a xn--ngbrx xn--node xn--nqv7f xn--nqv7fs00ema xn--nyqy26a xn--o3cw4h xn--ogbpf8fl xn--p1acf xn--p1ai xn--pbt977c xn--pgbs0dh xn--pssy2u xn--q9jyb4c xn--qcka1pmc xn--qxam xn--rhqv96g xn--rovu88b xn--rvc1e0am3e xn--s9brj9c xn--ses554g xn--t60b56a xn--tckwe xn--tiq49xqyj xn--unup4y xn--vermgensberater-ctb xn--vermgensberatung-pwb xn--vhquv xn--vuq861b xn--w4r85el8fhu5dnra xn--w4rs40l xn--wgbh1c xn--wgbl6a xn--xhq521b xn--xkc2al3hye2a xn--xkc2dl3a5ee0h xn--y9a3aq xn--yfro4i67o xn--ygbi2ammx xn--zfr164b xperia xxx xyz yachts yahoo yamaxun yandex ye yodobashi yoga yokohama you youtube yt yun za zappos zara zero zip zippo zm zone zuerich zw".split(" "),
Ia="0123456789".split(""),Ba="0123456789abcdefghijklmnopqrstuvwxyz".split(""),Ua=" \f\r\t\x0B\u00a0\u1680\u180e".split(""),H=[],A=function(a){return new g(a)},N=A(),Ja=A(I),ka=A(w),oa=A(),Ka=A(n);N.on("@",A(f)).on(".",A(K)).on("+",A(v)).on("#",A(R)).on("?",A(ga)).on("/",A(L)).on("_",A(W)).on(":",A(x)).on("{",A(O)).on("[",A(M)).on("\x3c",A(P)).on("(",A(X)).on("}",A(Q)).on("]",A(ia)).on("\x3e",A(Y)).on(")",A(ja)).on("\x26",A(Aa)).on([",",";","!",'"',"'"],A(fa));N.on("\n",A(na)).on(Ua,Ka);Ka.on(Ua,Ka);
for(var La=0;La<Ta.length;La++){var lb=r(Ta[La],N,J,w);H.push.apply(H,lb)}var Va=r("file",N,w,w),Wa=r("ftp",N,w,w),Xa=r("http",N,w,w),Ya=r("mailto",N,w,w);H.push.apply(H,Va);H.push.apply(H,Wa);H.push.apply(H,Xa);H.push.apply(H,Ya);var mb=Va.pop(),nb=Wa.pop(),ob=Xa.pop(),pb=Ya.pop(),Ca=A(w),Da=A(U),qb=A(V);nb.on("s",Ca).on(":",Da);ob.on("s",Ca).on(":",Da);H.push(Ca);mb.on(":",Da);Ca.on(":",Da);pb.on(":",qb);var rb=r("localhost",N,E,w);H.push.apply(H,rb);N.on(Ia,Ja);Ja.on("-",oa).on(Ia,Ja).on(Ba,ka);
ka.on("-",oa).on(Ba,ka);for(var Ma=0;Ma<H.length;Ma++)H[Ma].on("-",oa).on(Ba,ka);oa.on("-",oa).on(Ia,ka).on(Ba,ka);N.defaultTransition=A(ha);var Za=function(a){for(var b=a.replace(/[A-Z]/g,function(a){return a.toLowerCase()}),f=a.length,c=[],g=0;g<f;){for(var d=N,k=null,u=0,e=null,x=-1;g<f&&(k=d.next(b[g]));)d=k,d.accepts()?(x=0,e=d):0<=x&&x++,u++,g++;0>x||(g-=x,u-=x,d=e.emit(),c.push(new d(a.substr(g-u,u))))}return c},sb=Object.freeze({State:g,TOKENS:kb,run:Za,start:N}),Z=p();Z.prototype={type:"token",
isLink:!1,toString:function(){for(var a=[],b=0;b<this.v.length;b++)a.push(this.v[b].toString());return a.join("")},toHref:function(){return this.toString()},toObject:function(){return{type:this.type,value:this.toString(),href:this.toHref(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"http")}}};var $a=h(Z,p(),{type:"email",isLink:!0}),Na=h(Z,p(),{type:"email",isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),Oa=h(Z,p(),{type:"text"}),ab=h(Z,p(),{type:"nl"}),S=h(Z,p(),{type:"url",
isLink:!0,toHref:function(){for(var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"http",b=!1,f=!1,c=this.v,g=[],d=0;c[d]instanceof U;)b=!0,g.push(c[d].toString().toLowerCase()),d++;for(;c[d]instanceof L;)f=!0,g.push(c[d].toString()),d++;for(;m(c[d]);)g.push(c[d].toString().toLowerCase()),d++;for(;d<c.length;d++)g.push(c[d].toString());return g=g.join(""),b||f||(g=a+"://"+g),g},hasProtocol:function(){return this.v[0]instanceof U}}),tb=Object.freeze({Base:Z,MAILTOEMAIL:$a,EMAIL:Na,NL:ab,
TEXT:Oa,URL:S}),y=function(a){return new u(a)},Ea=y(),bb=y(),cb=y(),Pa=y(),db=y(),T=y(),Fa=y(),pa=y(S),eb=y(),fb=y(S),C=y(S),qa=y(),ra=y(),sa=y(),ta=y(),ua=y(),aa=y(S),ba=y(S),ca=y(S),da=y(S),va=y(),wa=y(),xa=y(),ya=y(),la=y(),Qa=y(),Ga=y(Na),gb=y(),ub=y(Na),ea=y($a),Ra=y(),ma=y(),Ha=y(),hb=y(),vb=y(ab);Ea.on(na,vb).on(U,bb).on(V,cb).on(L,Pa);bb.on(L,Pa);Pa.on(L,db);Ea.on(J,T).on(w,T).on(E,pa).on(I,T);db.on(J,C).on(w,C).on(I,C).on(E,C);T.on(K,Fa);la.on(K,Qa);Fa.on(J,pa).on(w,T).on(I,T).on(E,T);Qa.on(J,
Ga).on(w,la).on(I,la).on(E,la);pa.on(K,Fa);Ga.on(K,Qa);pa.on(x,eb).on(L,C);eb.on(I,fb);fb.on(L,C);Ga.on(x,gb);gb.on(I,ub);var F=[w,f,E,I,v,R,U,L,J,W,ha,Aa],G=[x,K,ga,fa,Q,ia,Y,ja,O,M,P,X];C.on(O,ra).on(M,sa).on(P,ta).on(X,ua);qa.on(O,ra).on(M,sa).on(P,ta).on(X,ua);ra.on(Q,C);sa.on(ia,C);ta.on(Y,C);ua.on(ja,C);aa.on(Q,C);ba.on(ia,C);ca.on(Y,C);da.on(ja,C);va.on(Q,C);wa.on(ia,C);xa.on(Y,C);ya.on(ja,C);ra.on(F,aa);sa.on(F,ba);ta.on(F,ca);ua.on(F,da);ra.on(G,va);sa.on(G,wa);ta.on(G,xa);ua.on(G,ya);aa.on(F,
aa);ba.on(F,ba);ca.on(F,ca);da.on(F,da);aa.on(G,aa);ba.on(G,ba);ca.on(G,ca);da.on(G,da);va.on(F,aa);wa.on(F,ba);xa.on(F,ca);ya.on(F,da);va.on(G,va);wa.on(G,wa);xa.on(G,xa);ya.on(G,ya);C.on(F,C);qa.on(F,C);C.on(G,qa);qa.on(G,qa);cb.on(J,ea).on(w,ea).on(I,ea).on(E,ea);ea.on(F,ea).on(G,Ra);Ra.on(F,ea).on(G,Ra);var za=[w,I,v,R,ga,W,ha,Aa,J];T.on(za,ma).on(f,Ha);pa.on(za,ma).on(f,Ha);Fa.on(za,ma);ma.on(za,ma).on(f,Ha).on(K,hb);hb.on(za,ma);Ha.on(J,la).on(w,la).on(E,Ga);var ib=function(a){for(var b=a.length,
f=0,c=[],g=[];f<b;){for(var d=Ea,k=null,u=null,e=0,x=null,h=-1;f<b&&!(k=d.next(a[f]));)g.push(a[f++]);for(;f<b&&(u=k||d.next(a[f]));)k=null,d=u,d.accepts()?(h=0,x=d):0<=h&&h++,f++,e++;if(0>h)for(e=f-e;e<f;e++)g.push(a[e]);else 0<g.length&&(c.push(new Oa(g)),g=[]),f-=h,e-=h,d=x.emit(),c.push(new d(a.slice(f-e,f)))}return 0<g.length&&c.push(new Oa(g)),c},wb=Object.freeze({State:u,TOKENS:tb,run:ib,start:Ea});Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});
var Sa=function(a){return ib(Za(a))};e.find=function(a){for(var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,f=Sa(a),c=[],g=0;g<f.length;g++){var d=f[g];!d.isLink||b&&d.type!==b||c.push(d.toObject())}return c};e.inherits=h;e.options=D;e.parser=wb;e.scanner=sb;e.test=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,f=Sa(a);return 1===f.length&&f[0].isLink&&(!b||f[0].type===b)};e.tokenize=Sa}(self.linkify=self.linkify||{})}();"use strict";!function(d,e){var h=
function(d){function b(a){this.a=a}function c(a,b){this.b=a;this.c=b;this.input=this.d=null;this.i=this.h=this.g=this.f=this.e=-1;this.j()}function e(a,b){this.k=null;this.startLine=1;this.startColumn=0;this.options=b||{};this.tokenizer=new c(this,a)}var h={m:"\u00a0"},t=/^#[xX]([A-Fa-f0-9]+)$/,l=/^#([0-9]+)$/,q=/^([A-Za-z0-9]+)$/;b.prototype.parse=function(a){if(a){var b=a.match(t);return b?"\x26#x"+b[1]+";":(b=a.match(l))?"\x26#"+b[1]+";":(b=a.match(q),b?this.a[b[1]]||"\x26"+b[1]+";":void 0)}};
var m=/[\t\n\f ]/,a=/[A-Za-z]/,g=/\r\n?/g;c.prototype={j:function(){this.d="beforeData";this.input="";this.e=0;this.f=1;this.g=0;this.i=this.h=-1;this.b.j()},tokenize:function(a){this.j();this.tokenizePart(a);this.tokenizeEOF()},tokenizePart:function(a){for(this.input+=a.replace(g,"\n");this.e<this.input.length;)this.n[this.d].call(this)},tokenizeEOF:function(){this.o()},o:function(){"data"===this.d&&(this.b.p(),this.d="beforeData")},q:function(){return this.input.charAt(this.e)},r:function(){var a=
this.q();return this.e++,"\n"===a?(this.f++,this.g=0):this.g++,a},s:function(){var a=this.input.indexOf(";",this.e);if(-1!==a){var b=this.input.slice(this.e,a);if(a=this.c.parse(b)){for(b=b.length;b;)this.r(),b--;return this.r(),a}}},t:function(){this.h=this.f;this.i=this.g;this.b.tagOpen&&this.b.tagOpen()},n:{beforeData:function(){"\x3c"===this.q()?(this.d="tagOpen",this.t(),this.r()):(this.d="data",this.b.u())},data:function(){var a=this.q();"\x3c"===a?(this.b.p(),this.d="tagOpen",this.t(),this.r()):
"\x26"===a?(this.r(),this.b.v(this.s()||"\x26")):(this.r(),this.b.v(a))},tagOpen:function(){var b=this.r();"!"===b?this.d="markupDeclaration":"/"===b?this.d="endTagOpen":a.test(b)&&(this.d="tagName",this.b.w(),this.b.x(b.toLowerCase()))},markupDeclaration:function(){"-"===this.r()&&"-"===this.input.charAt(this.e)&&(this.r(),this.d="commentStart",this.b.y())},commentStart:function(){var a=this.r();"-"===a?this.d="commentStartDash":"\x3e"===a?(this.b.z(),this.d="beforeData"):(this.b.A(a),this.d="comment")},
commentStartDash:function(){var a=this.r();"-"===a?this.d="commentEnd":"\x3e"===a?(this.b.z(),this.d="beforeData"):(this.b.A("-"),this.d="comment")},comment:function(){var a=this.r();"-"===a?this.d="commentEndDash":this.b.A(a)},commentEndDash:function(){var a=this.r();"-"===a?this.d="commentEnd":(this.b.A("-"+a),this.d="comment")},commentEnd:function(){var a=this.r();"\x3e"===a?(this.b.z(),this.d="beforeData"):(this.b.A("--"+a),this.d="comment")},tagName:function(){var a=this.r();m.test(a)?this.d=
"beforeAttributeName":"/"===a?this.d="selfClosingStartTag":"\x3e"===a?(this.b.B(),this.d="beforeData"):this.b.x(a)},beforeAttributeName:function(){var a=this.q();return m.test(a)?void this.r():void("/"===a?(this.d="selfClosingStartTag",this.r()):"\x3e"===a?(this.r(),this.b.B(),this.d="beforeData"):(this.d="attributeName",this.b.C(),this.r(),this.b.D(a)))},attributeName:function(){var a=this.q();m.test(a)?(this.d="afterAttributeName",this.r()):"/"===a?(this.b.F(!1),this.b.G(),this.r(),this.d="selfClosingStartTag"):
"\x3d"===a?(this.d="beforeAttributeValue",this.r()):"\x3e"===a?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.r(),this.b.D(a))},afterAttributeName:function(){var a=this.q();return m.test(a)?void this.r():void("/"===a?(this.b.F(!1),this.b.G(),this.r(),this.d="selfClosingStartTag"):"\x3d"===a?(this.r(),this.d="beforeAttributeValue"):"\x3e"===a?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.b.F(!1),this.b.G(),this.r(),this.d="attributeName",this.b.C(),
this.b.D(a)))},beforeAttributeValue:function(){var a=this.q();m.test(a)?this.r():'"'===a?(this.d="attributeValueDoubleQuoted",this.b.F(!0),this.r()):"'"===a?(this.d="attributeValueSingleQuoted",this.b.F(!0),this.r()):"\x3e"===a?(this.b.F(!1),this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.d="attributeValueUnquoted",this.b.F(!1),this.r(),this.b.H(a))},attributeValueDoubleQuoted:function(){var a=this.r();'"'===a?(this.b.G(),this.d="afterAttributeValueQuoted"):"\x26"===a?this.b.H(this.s('"')||
"\x26"):this.b.H(a)},attributeValueSingleQuoted:function(){var a=this.r();"'"===a?(this.b.G(),this.d="afterAttributeValueQuoted"):"\x26"===a?this.b.H(this.s("'")||"\x26"):this.b.H(a)},attributeValueUnquoted:function(){var a=this.q();m.test(a)?(this.b.G(),this.r(),this.d="beforeAttributeName"):"\x26"===a?(this.r(),this.b.H(this.s("\x3e")||"\x26")):"\x3e"===a?(this.b.G(),this.r(),this.b.B(),this.d="beforeData"):(this.r(),this.b.H(a))},afterAttributeValueQuoted:function(){var a=this.q();m.test(a)?(this.r(),
this.d="beforeAttributeName"):"/"===a?(this.r(),this.d="selfClosingStartTag"):"\x3e"===a?(this.r(),this.b.B(),this.d="beforeData"):this.d="beforeAttributeName"},selfClosingStartTag:function(){"\x3e"===this.q()?(this.r(),this.b.I(),this.b.B(),this.d="beforeData"):this.d="beforeAttributeName"},endTagOpen:function(){var b=this.r();a.test(b)&&(this.d="tagName",this.b.J(),this.b.x(b.toLowerCase()))}}};e.prototype={tokenize:function(a){return this.K=[],this.tokenizer.tokenize(a),this.K},tokenizePart:function(a){return this.K=
[],this.tokenizer.tokenizePart(a),this.K},tokenizeEOF:function(){return this.K=[],this.tokenizer.tokenizeEOF(),this.K[0]},j:function(){this.k=null;this.startLine=1;this.startColumn=0},L:function(){this.options.M&&(this.k.M={start:{f:this.startLine,g:this.startColumn},N:{f:this.tokenizer.f,g:this.tokenizer.g}});this.startLine=this.tokenizer.f;this.startColumn=this.tokenizer.g},u:function(){this.k={type:"Chars",chars:""};this.K.push(this.k)},v:function(a){this.k.chars+=a},p:function(){this.L()},y:function(){this.k=
{type:"Comment",chars:""};this.K.push(this.k)},A:function(a){this.k.chars+=a},z:function(){this.L()},w:function(){this.k={type:"StartTag",tagName:"",attributes:[],l:!1};this.K.push(this.k)},J:function(){this.k={type:"EndTag",tagName:""};this.K.push(this.k)},B:function(){this.L()},I:function(){this.k.l=!0},x:function(a){this.k.tagName+=a},C:function(){this._currentAttribute=["","",null];this.k.attributes.push(this._currentAttribute)},D:function(a){this._currentAttribute[0]+=a},F:function(a){this._currentAttribute[2]=
a},H:function(a){this._currentAttribute[1]=this._currentAttribute[1]||"";this._currentAttribute[1]+=a},G:function(){}};var u={HTML5NamedCharRefs:h,EntityParser:b,EventedTokenizer:c,Tokenizer:e,tokenize:function(a,c){return(new e(new b(h),c)).tokenize(a)}},k=d.options,w=k.Options;return function(a){var b,f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=u.tokenize(a),g=[],e=[],f=new w(f);for(b=0;b<c.length;b++){var h=c[b];if("StartTag"!==h.type)if("Chars"===h.type){for(var r=f,h=d.tokenize(h.chars),
p=[],t=0;t<h.length;t++){var l=h[t];if("nl"===l.type&&r.nl2br)p.push({type:"StartTag",tagName:"br",attributes:[],l:!0});else if(l.isLink&&r.check(l)){var q=r.resolve(l),l=q.formatted,m=q.tagName,B=q.className,z=q.target,D=q.attributes,q=[["href",q.formattedHref]];B&&q.push(["class",B]);z&&q.push(["target",z]);for(var n in D)q.push([n,D[n]]);p.push({type:"StartTag",tagName:m,attributes:q,l:!1});p.push({type:"Chars",chars:l});p.push({type:"EndTag",tagName:m})}else p.push({type:"Chars",chars:l.toString()})}g.push.apply(g,
p)}else g.push(h);else if(g.push(h),h=h.tagName.toUpperCase(),"A"===h||k.contains(f.ignoreTags,h)){r=g.length;p=c;t=++b;l=g;for(m=1;t<p.length&&0<m;)B=p[t],"StartTag"===B.type&&B.tagName.toUpperCase()===h?m++:"EndTag"===B.type&&B.tagName.toUpperCase()===h&&m--,l.push(B),t++;b+=g.length-r-1}}for(b=0;b<g.length;b++)switch(c=g[b],c.type){case "StartTag":f="\x3c"+c.tagName;if(0<c.attributes.length){c=c.attributes;n=[];for(r=0;r<c.length;r++)h=c[r],n.push(h[0]+'\x3d"'+h[1].replace(/"/g,"\x26quot;")+'"');
f+=" "+n.join(" ")}f+="\x3e";e.push(f);break;case "EndTag":e.push("\x3c/"+c.tagName+"\x3e");break;case "Chars":e.push(c.chars);break;case "Comment":e.push("\x3c!--"+c.chars+"--\x3e")}return e.join("")}}(e);window.linkifyHtml=h}(window,linkify)})},"dojox/main":function(){define(["dojo/_base/kernel"],function(v){return v.dojox})},"ws/mail/ComposeMessageWidget":function(){define("ws/mail/ComposeMessageWidget","dojo/_base/declare dojo/text!ws/mail/ComposeMessageWidget.html dojo/text!ws/mail/ComposeMessageWidget.css dojo dijit dijit/_Widget dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ws/Spinner ws/widget/Button ws/address/AddressModel ws/mail/MailModel dojo/on dojo/dom-geometry ws/pictures/PictureEditor dijit/layout/BorderContainer ws/address/ComposeAddressField ws/address/PeoplePicker ws/widget/DefaultTextbox ws/browser ws/html ws/io ws/reporting ws/settings ws/string ws/UserContext ws/widget/Dialogs ws/widget/Pane ws/widget/util ws/widget/WSSelect ws/widget/WSToolbar".split(" "),
function(v,l,m,d,e,h,t,b,c,r,p,z,B,q,D){return v([h,t,b],{templateString:l,css:{templateString:m},_earlyTemplatedStartup:!0,showNewWindowLink:!0,showCancelXButton:!0,model:null,picturesModel:null,backToString:"setFolder",backToStringOverride:"",inTransition:!1,beaconSuffix:"",isStandAlone:!1,isPopup:!1,isInlineReply:!1,formattingBarShowing:!0,parentScrollNode:null,isToaster:!1,callBackTimeout:100,kidTeenAccount:"Y"==ws.UserContext.ParentalControls||"K"==ws.UserContext.ParentalControls,fromAddr:"",
emptyFileInput:null,attachUploadDispId:0,attachUploadDispRefObjs:{},attachUploadDispNodes:{},attachUploadFilenameMap:{},attachListDirty:!1,friendlyFromName:ws.string.escapeXml(Settings.FromDisplayName),identity:null,autoSaveDraftSubInterval:null,autoSaveIntervalCounter:0,autoSaveCharCount:0,fileAttachSizeEncodeRatio:.7285714174371669,inlineToolBar:"",constructor:function(a){a.isInlineReply&&(this.templateString=this.templateString.replace("dijit/layout/BorderContainer","ws/widget/Pane"),this.templateString=
this.templateString.replace('data-dojo-attach-point\x3d"layoutWidget',""),this.inlineToolBar="true",this.formattingBarShowing=!1);this.inherited(arguments)},startup:function(){this.editor=new D({isInlineReply:this.isInlineReply,id:this.id+"_body",region:"center",model:this.model},this.editorDiv);this.editor.startup();this.isPopup&&_ws_isOpenerWS()?this.idleSubscribe=opener.dojo.subscribe:this.idleSubscribe=d.subscribe;this.addressModel=new p;this.connect(this.editor,"enableRichText","enableRichText");
this.connect(this.editor,"checkForFormattingBarOff","checkForFormattingBarOff");Config.DragDropPictureAttach&&(this.connect(this.editor,"WSEditor_ondragover","imageFileDragEnter"),this.connect(this.editor,"WSEditor_ondragenter","imageFileDragOver"));this.connect(this.editor,"addedInlineImage",d.hitch(this,"addedInlineImage"));this.connect(this.editor,"removedInlineImage",d.hitch(this,"removedInlineImage"));this.connect(this.editor,"onPerfectSpelling","onPerfectSpelling");this.connect(this.editor,
"onImperfectSpelling","onImperfectSpelling");this.connect(this.editor,"onEndSpellCheck","onEndSpellCheck");this.connect(this.editor,"autoSaveMessage","autoSaveMessage");this.connect(this.editor,"sendMessage","sendMessage");this.connect(this.editor,"cancel","cancel");this.connect(this.editor,"updateToolbar","updateToolbar");this.model instanceof z&&this.connect(this.model,"infoUpdated","infoUpdated");Config.EnableSaveAsDraft||d.query(".saveDraftButton",this.domNode).style("display","none");Config.EnableSpellCheck||
d.query(".spellCheckButton",this.domNode).style("display","none");this.showNewWindowLink&&ws.settings.allowPopups()&&!this.isPopup||this.isToaster||d.query(".newWindowLink",this.domNode).style("display","none");this.showCancelXButton||d.query(".cancelButton",this.domNode).style("display","none");this.isPopup&&(this.minimizeLink.domNode.style.display="none",this.restoreLink.domNode.style.display="none",d.addClass(this.domNode,"composeMessagePopup"));this.connect(this.toField,"showCc","showCc");this.connect(this.toField,
"showBcc","showBcc");this.connect(this.toField,"onResizedSelf","layoutSoon");this.connect(this.ccField,"onResizedSelf","layoutSoon");this.connect(this.bccField,"onResizedSelf","layoutSoon");this.connect(this.editor.toolbarPane,"onclick","layoutSoon");this.toField.field.id="toInputField";this.connect(d.global,"onresize","layoutSoon");this.connect(this.toField,"onBlur",d.hitch(this,"onBlurAddrFld",this.toField,"To"));this.connect(this.ccField,"onBlur",d.hitch(this,"onBlurAddrFld",this.ccField,"Cc"));
this.connect(this.bccField,"onBlur",d.hitch(this,"onBlurAddrFld",this.bccField,"Bcc"));this.connect(this.toField,"onFocus",d.hitch(this,"onFocusAddrFld",this.toField,"To"));this.connect(this.ccField,"onFocus",d.hitch(this,"onFocusAddrFld",this.ccField,"Cc"));this.connect(this.bccField,"onFocus",d.hitch(this,"onFocusAddrFld",this.bccField,"Bcc"));if(Config.DragDropPictureAttach){var a=this.headerWidget;a&&(B(a,"dragenter",d.hitch(this,this.attachFileDragEnter)),B(a,"dragover",d.hitch(this,this.attachFileDragOver)));
if(a=this.editor.domNode)B(a,"dragenter",d.hitch(this,this.imageFileDragEnter)),B(a,"dragover",d.hitch(this,this.imageFileDragOver))}this.editor.picturesModel=this.picturesModel;this.isStandAlone||(this.beforeUnloadHandlerKey=ws.browser.addOnBeforeUnload(this,"onBeforeUnload"));this.sendAttachAsLinks=!1;this.subscribe("Suite/onKeyOnPress","onKeyPress");this.subscribe("friendlyNameUpdated","updateDisplayName");this.subscribe("wsresize","wsAppResize");this.subscribe("stationery/select","selectStationery");
this.subscribe("stationery/clear","clearStationery");Config.ShowSaveBtnInCompse&&d.query(".saveDraftButton",this.domNode).forEach(function(a){a.style.display=""});var a=d.isMac?Config.Strings.CtrlReturnKey:Config.Strings.CtrlEnterKey,b=Config.Strings.ComposeSendButton+" \x3cspan\x3e("+a+")\x3c/span\x3e",c=Config.Strings.ComposeSendButton+" ("+a+")";d.query(".sendButton",this.domNode).forEach(function(a){e.byNode(a).setTip(b);d.attr(a,"title",c)});a=d.isMac?Config.OptKey:Config.AltKey;b=Config.Strings.CheckSpelling+
" \x3cspan\x3e("+a+" \x3d)\x3c/span\x3e";c=Config.Strings.CheckSpelling+" ("+a+" \x3d)";d.query(".spellCheckButton",this.domNode).forEach(function(a){e.byNode(a).setTip(b);d.attr(a,"title",c)});d.attr(this.toField,"title",Config.Strings.SelectToRecipients+" ("+a+" [)");d.attr(this.ccField,"title",Config.Strings.SelectCcRecipients+" ("+a+" ])");d.attr(this.bccField,"title",Config.Strings.SelectBccRecipients+" ("+a+" \\)");(this.isPopup||this.isStandAlone)&&d.addClass(this.domNode,"popupWin");this.model&&
this.model.idleMonitor?this.idleMonitorStarted():this.idleSubscribe("IdleMonitor/started",this,"idleMonitorStarted")},destroy:function(){this.autoSaveDraftSubInterval&&(window.clearInterval(this.autoSaveDraftSubInterval),this.autoSaveDraftSubInterval=null);this.beforeUnloadHandlerKey&&(ws.browser.removeOnBeforeUnload(this.beforeUnloadHandlerKey),this.beforeUnloadHandlerKey=null);this.parentScrollNode&&(this.parentScrollNode.style.marginBottom="0px",this.savedParentScrollHeight&&(this.parentScrollNode.style.height=
this.savedParentScrollHeight+"px",this.savedParentScrollHeight=null),this.parentScrollNode=null);this.inherited(arguments)},setAddressFieldValue:function(a,b){b?a.setValue(b.replace("@unknown.domain",""),null,!0):a.setValue("")},selectStationery:function(a,b,c,d){this.editor.insertStationery({url:b,name:a.label,swatchUrl:d,id:a.id})},clearStationery:function(){this.editor.insertStationery({url:"",name:"",swatchUrl:""})},openInsertPictureDialog:function(){this.editor&&this.editor.embedImageFileInput&&
(this.editor.embedImageFileInput.click(),ws.reporting.reportDLAction("Mail-Compose-InsertPic"))},openAttachFileDialog:function(){this.emptyFileInput&&(this.emptyFileInput.click(),ws.reporting.reportDLAction("Mail-Compose-InsertAttachment"))},enableRichText:function(){var a=this.draftMessage&&this.draftMessage.message;a&&this.model.composeSettingsChanged();if(a||this.isResponse||this.isDirty())this.checkForAttachments(d.hitch(this,function(){var a={to:this.toField.getValue(),cc:this.ccField.getValue(),
bcc:this.bccField.getValue(),subject:this.subjectInput.value,originalMessage:this.originalMessage,draftMessage:this.draftMessage,composeType:this.composeType,sourceAttachments:this.sourceAttachments,isDirty:this.isDirty()},b=this.editor.getContent();a.body=b.replace(/\r\n/g,"\x3cbr\x3e").replace(/\n/g,"\x3cbr\x3e").replace(/\r/g,"\x3cbr\x3e");a.bodyIsCurrentMsg=!0;this._enableRichText(a,null)}));else{var a={},b=this.editor.getContent();null!=b&&(a={to:this.toField.getValue(),subject:this.subjectInput.value,
body:b.replace(/\r\n/g,"\x3cbr\x3e").replace(/\n/g,"\x3cbr\x3e").replace(/\r/g,"\x3cbr\x3e"),bodyIsCurrentMsg:!0});this._enableRichText(a,null)}},_enableRichText:function(a,b){var c=a||{};c.skipComposeBeacon=!0;ws.settings.save({UseRichEditor:!0},{load:d.hitch(this,function(){Settings.UseRichEditor=!0;this.reset(c,b)}),error:function(a){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for settings.save-_enableRichText",a,"ComposeMessageWidget.js");ws.widget.Dialogs.ok(Config.Strings.Settings_SaveError)}})},
handleAttachDialogCancel:function(){},handleAttachDialogDone:function(){},undo:function(){},onHide:function(){this.editor.clean();this.autoSaveDraftSubInterval&&(clearInterval(this.autoSaveDraftSubInterval),this.autoSaveDraftSubInterval=null)},setModel:function(a){this.model=a},setPicturesModel:function(a){this.picturesModel=a;this.editor.setPicturesModel(a)},layoutSoon:function(){ws.lang.defer(this,"layout",0,this.id+"Layout")},layout:function(){this.layoutWidget&&this.layoutWidget.resize()},onKeyPressInputField:function(a){65<=
a.keyCode&&90>=a.keyCode&&(a.keyChar=String.fromCharCode(a.keyCode));this.handleKey(a)},onKeyPress:function(a){this.isShowing()&&this.handleKey(a)},handleKey:function(a){if(Config.EnableKeyboardShortcuts&&!this.isSaveInProgress()){var b=!1;a=ws.html.fixKeyForMac(a);if(a.altKey&&a.keyChar)switch(a.keyChar.toLowerCase()){case Config.Strings.KeyComposeClose:a.preventDefault(),a.stopPropagation(),ws.lang.setTimeout(this,"cancel",150),b=!0}else if(a.ctrlKey)switch(ws.html.fixKeyCodeForMac(a)){case d.keys.ENTER:this.sendMessage(),
b=!0}else if(a.altKey)if(219==a.keyCode)ws.lang.setTimeout(this.toField,"togglePeoplePicker",100),b=!0;else if(221==a.keyCode)this.showCc(),ws.lang.setTimeout(this.ccField,"togglePeoplePicker",100),b=!0;else if(220==a.keyCode)this.showBcc(),ws.lang.setTimeout(this.bccField,"togglePeoplePicker",100),b=!0;else if(187==a.keyCode||61==a.keyCode&&d.isMoz||107==a.keyCode&&5<=d.isMoz)this.spellCheck(),b=!0;b&&d.stopEvent(a)}},addEmail:function(a,b){this.onFocusAddressField||(this.onFocusAddressField=this.toField);
var c=this.onFocusAddressField;b&&("to"==b?c=this.toField:"cc"==b?(c=this.ccField,this.showCc()):"bcc"==b&&(c=this.bccField,this.showBcc()));var d=c.getValue(a),d=d.replace(/^\s+/,""),d=(d=d.replace(/\s+$/,""))?";"==d.charAt(d.length-1)||","==d.charAt(d.length-1)?d+(" "+a+","):d+(", "+a+","):a+",";c.focus();c.setValue(d)},setToaster:function(){this.isToaster&&(this.editor.composeView=1,this.toolbar.domNode.style.display="none",this.toastTitleBar.domNode.style.display="block",this.toastToolbar.domNode.style.display=
"block",d.addClass(this.domNode,"toastComposeDomNode"),d.addClass(this.domNode,"btnLabelsOn2"),this.connect(this.domNode,"onkeypress",function(a){a&&a.stopPropagation()}))},setInlineReply:function(){if(this.isInlineReply){this.editor.composeView=2;this.toolbar.domNode.style.display="none";this.toastTitleBar.domNode.style.display="none";this.toastToolbar.domNode.style.display="block";d.addClass(this.domNode,"toastComposeDomNode");d.addClass(this.domNode,"btnLabelsOn2");this.toField.numOfLines=2;this.toField.postMixInProperties();
this.ccField.numOfLines=2;this.ccField.postMixInProperties();this.bccField.numOfLines=2;this.bccField.postMixInProperties();this.fromLine.style.display="none";window.DM&&window.DM.displayWidget&&window.DM.displayWidget.isPopup||(this.expandViewButton.domNode.style.display="block",this.expandViewButton.setTip(Config.Strings["ExpandTip"+Settings.ComposeMode]));var a=this.domNode;a.addEventListener&&(a.addEventListener("focus",d.hitch(this,this.cmpWidgetFocus),!0),a.addEventListener("blur",d.hitch(this,
this.cmpWidgetBlur),!0));this.connect(this.editor,"preRichContentGet","preRichContentGet");this.connect(this.editor,"postRichContentGet","postRichContentGet");this.connect(this.editor,"adviceRichContentSet","adviceRichContentSet");d.isIE&&this.connect(this.editor,"adviceIEContentChange","adviceIEContentChange");this.editor.enableContentSizing();this.headerCollapse(!0);(a=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)&&(new a(d.hitch(this,this.checkForInlineCompseVis))).observe(this.editor.editDiv(),
{childList:!0,subtree:!0});this.parentScrollNode&&(this.scrollingNodeConnected||(this.scrollingNodeConnected=!0,this.connect(this.parentScrollNode,"onscroll",d.hitch(this,function(){this.checkForInlineCompseVis()}))),window.setTimeout(d.hitch(this,function(){this.domNode.scrollIntoView(!1)}),200));ws.reporting.reportDLAction("Mail-Compose-InlineReplyInitiated")}},wsAppResize:function(){this.editor.onResized();this.checkForInlineCompseVis()},checkForInlineCompseVis:function(){if(this.parentScrollNode&&
this.editor.richMode){var a=this.domNode.getBoundingClientRect(),b=this.editor.editNodeForMode().getBoundingClientRect().top+40,c=a.bottom,a=a.right-a.left,k=0,h=0,f=document.getElementById("ws_application"),x=document.getElementById("ws_appScroll");f&&x?(k=x.getBoundingClientRect(),h=f.getBoundingClientRect().bottom-k.bottom,k=k.bottom):window.DM&&window.DM.displayWidget&&window.DM.displayWidget.domNode&&(k=window.DM.displayWidget.domNode.getBoundingClientRect().bottom);f="absolute"===this.parentScrollNode.style.position&&
e.byNode(this.parentScrollNode.parentNode).resize;k&&b<k&&k<c&&d.hasClass(this.domNode,"inlineComposeNodeSelected")?(this.isPinnedTB=!0,this.bottomTB.style.width=a+"px",this.bottomTB.style.bottom=h+"px",this.bottomTB.style.paddingRight=ws.html.getScrollbarWidth()+"px",d.addClass(this.bottomTB,"pinnedTB"),d.addClass(this.domNode,"cmpPinnedTB"),this.bottomTBSpace.style.display="inline-block",this.bottomTBSpace.style.height="0px",f?(this.savedParentScrollHeight||(this.savedParentScrollHeight=this.parentScrollNode.offsetHeight),
this.parentScrollNode.style.height=this.savedParentScrollHeight-48+"px"):this.parentScrollNode.style.marginBottom="52px"):(this.isPinnedTB=!1,this.bottomTB.style.width="auto",this.bottomTB.style.bottom="auto",this.bottomTB.style.paddingRight="0px",d.removeClass(this.bottomTB,"pinnedTB"),d.removeClass(this.domNode,"cmpPinnedTB"),this.bottomTBSpace.style.display="none",this.bottomTBSpace.style.height="0px",this.parentScrollNode.style.marginBottom="0px",f?this.savedParentScrollHeight&&(this.parentScrollNode.style.height=
this.savedParentScrollHeight+"px",this.savedParentScrollHeight=null):this.parentScrollNode.style.marginBottom="undefinedpx")}},reset:function(a,b){this.csid=null;this.setToaster();this.setInlineReply();this.msgIsSent=!1;!Config.EnableStationery||this.isPopup||window.DM&&window.DM.displayWidget||this.stationeryEnabled||(this.editor.createStationeryBtn(),this.stationeryEnabled=!0);d.isIE&&d.publish("toolbarLayoutUpdate");this.domNode.style.display="block";Config.DragDropPictureAttach&&this._fileDropEnd();
a=a||{};var c="";this.model.sendAddresses&&this.model.sendAddresses.length&&(c=this.model.sendAddresses[0][1]);ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr=a.from||ws.WebSuite.cmpseMsgWidPersist.lastSelFromAddr||c;this.setupFromAddress();if(a.to&&0==a.to.indexOf("mailto:")&&(c=a.to.substr(7,a.to.length),c=c.split("?"),c.length&&(a.to=c[0],c[1])))for(var c=c[1].split("\x26"),g=0;c&&g<c.length;g++){var e=c[g].split("\x3d");e&&e[0]&&e[1]&&("cc"==e[0].toLowerCase()&&(a.cc=decodeURIComponent(e[1])),
"bcc"==e[0].toLowerCase()&&(a.bcc=decodeURIComponent(e[1])),"subject"==e[0].toLowerCase()&&(a.subject=decodeURIComponent(e[1])),"body"==e[0].toLowerCase()&&(a.body=ws.string.escapeXml(decodeURIComponent(e[1]))))}!this.isStandAlone||a.composeType||a.cid||(a.subject&&(a.subject=ws.string.sanitize(a.subject)),a.body&&(a.body=ws.string.sanitize(a.body)));this.showHideField("Cc",!!a.cc);this.showHideField("Bcc",!!a.bcc);this.setAddressFieldValue(this.toField,a.to);this.setAddressFieldValue(this.ccField,
a.cc);this.setAddressFieldValue(this.bccField,a.bcc);this.subjectInput.value=a.subject||"";this.updateToastTitle();this.draftMessage=ws.lang.shallowCopy(a.draftMessage||{},!0);this.originalMessage=ws.lang.shallowCopy(a.originalMessage||{},!0);this.draftMessage&&this.draftMessage.message&&(this.csid=this.draftMessage.message.csid);this.composeType=a.composeType||"";this.initAttachments(a.sourceAttachments,!0);this.missingAttachmentWarningShown=!1;this.editor.isStationeryMode=!!a.isStationeryMode;this.editor.stationeryState=
a.stationeryState;this.resetStationery();this.showFeedback();this.sendAttachAsLinks=this.spellCheckFailure=this.sendAfterSpellCheck=this.inTransition=!1;this.lastSavedMsgUID=this.inSaveOrSend=null;this.editor.endSpellCheck();this.forceReadSavedMsg=this.autoSaveMsgInProgress=!1;this.toggleButtonState(!0);this.layoutSoon();var f=this.beaconSuffix;!this.isPopup&&a.beaconSuffix&&(f=a.beaconSuffix);c=a.dontAddSignature;this.model.standAloneMailModel&&(c=!0);this.initBody(a.body,a.quote,c,a.isPopOut,a.bodyIsCurrentMsg,
d.hitch(this,function(){b&&b();a.skipComposeBeacon||this.isToaster||ws.reporting.report("Compose Message - "+f,"Mail");this.editor.isStationeryMode?this.editor.fixEditorForStationery():this.editor.resetStationeryState();this.editor.reset(null,a.body);this.focusField();this.editor.convertPicturesInMail();this.editor.editControl&&this.editor.editControl.installEventHandlers(!0);this.editorFocusConnected||(this.connect(this.editor,"onFocusHandler",d.hitch(this,"onEditorFocus")),this.editorFocusConnected=
!0);a.isDirty?this.setDirty():this.resetDirty();this.attachListDirty=!1}));a.backToString&&this.model&&(c=this.model.getFolderByName(this.model.currentFolder),c=this.model.getFolderDisplayName(c),this.backToButtonString="setFolder"==a.backToString&&c?ws.string.substituteParams(Config.Strings.BackToFolder,ws.string.summary(c,17)):a.backToString);c=Config.AutoSaveToDraftsInterval;null!=c&&-1!=c&&(this.autoSaveMsgInProgress=!1,this.autoSaveIntervalCounter=0,this.autoSaveDraftSubInterval&&clearInterval(this.autoSaveDraftSubInterval),
this.autoSaveDraftSubInterval=setInterval(d.hitch(this,"autoSaveMessage",!0),1E3*Config.AutoSaveToDraftsSubInterval),this.lastSaved=null)},resetStationery:function(){ws.WebSuite.SidePanel&&(ws.WebSuite.SidePanel.resetStationery(),ws.WebSuite.SidePanel.handleMainStackSelect());this.editor.resetStationeryState();this.editor.fixEditorForStationery()},infoUpdated:function(){this.model.standAloneMailModel&&(this.model.sendAddresses&&this.model.sendAddresses.length&&(ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr=
this.model.sendAddresses[0][1]),this.setupFromAddress(),this.model.getSignature()&&(this.setBodyContent(this.editor.getContent()),this.resetDirty()))},getSigHTML:function(a){return"\x3cdiv style\x3d'clear:both'\x3e"+a+"\x3c/div\x3e"},setBodyContent:function(a,b,c,e,h,f){var g=this.editor.useRichMode(),k=d.isMac?"helvetica,arial":"arial,helvetica";a&&g&&(a="\x3cdiv style\x3d'font-family:"+k+";font-size:10pt;color:black'\x3e"+a+"\x3c/div\x3e");a=a||"";var u=0==this.composeType.indexOf("reply")||"forward"==
this.composeType;this.isResponse=u;var r=this.model.getSignature(),p=r&&!c;p&&g&&(r=this.getSigHTML(r));var t=this.editor.getBlankLine();c=this.draftMessage&&this.draftMessage.message;b&&g&&(b="\x3cdiv style\x3d'font-family:"+k+";font-size:10pt;color:black'\x3e"+b+"\x3c/div\x3e");b=b?t+b:"";k=p?r:"";e||h||(u&&p?a=b+t+t+k+t+t+a:u?a=b+t+t+t+a:p?(b&&(b=b+t+t),a=b+a+t+t+k):b&&(a=b));b=!1;c&&!g&&(b=!0);this.editor.setContent(a,f,e,b,null,!!c)},initBody:function(a,b,c,d,e,f){this.setBodyContent(a,b,c,d,
e,f);Settings.ShowCcField&&this.showCc();Settings.ShowBccField&&this.showBcc();this.focusField()},updateToolbar:function(a,b,c){c||b&&this.focusField()},focusField:function(){window.focus();this.toField.getValue()?this.subjectInput.value?this.editor.focus():this.subjectInput.focus():this.toField.focus()},saveFriendlyName:function(){"none"!=this.fromAddressEditBoxDiv.style.display&&(this.model.saveDisplayName(ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr,this.fromAddressEditBox.getValue()),this.fromAddressEditBoxDiv.style.display=
"none",this.setupFromAddress(),ws.reporting.reportDLAction("Mail-Compose-PrettyName"))},cancelFriendlyEdit:function(){"none"!=this.fromAddressEditBoxDiv.style.display&&(this.fromAddressEditBoxDiv.style.display="none",this.setupFromAddress())},updateDisplayName:function(){this.setupFromAddress()},processEditBoxKeyPress:function(a){switch(a.keyCode){case d.keys.ENTER:this.saveFriendlyName();break;case d.keys.ESCAPE:this.cancelFriendlyEdit()}},fromAddressEdit:function(){Config.FriendlyNameInCompose&&
(this.fromAddressSpan.style.display="none",this.fromAddressSpan.innerHTML="",this.fromAddressEditBoxDiv.style.display="",this.fromAddressEditBox.setValue(Settings.FromDisplayName),this.fromAddressEditBox.textbox.focus(),ws.html.selectInputText(this.fromAddressEditBox.textbox),this.fromAddressEditBox.textbox.style.color="#000")},setupFromAddress:function(){for(var a=this.model.sendAddresses,b=[],c=0,d=0;d<a.length;d++){ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr&&-1!=ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr.indexOf(a[d][1])&&
(c=d);var e=ws.string.escapeXml(a[d][1]),e="";Config.FriendlyNameInCompose&&(e="\x3cspan class\x3d'fromA'\x3e"+ws.string.escapeXml(Settings.FromDisplayName)+"\x3c/span\x3e");e=e+"\x3cspan class\x3d'fromB'\x3e"+ws.string.escapeXml(a[d][1])+"\x3c/span\x3e";b.push({display:e,value:a[d][1],selected:!1})}b.length&&(b[c].selected=!0);this.fromSelect.setOptions(b);Config.FriendlyNameInCompose?(this.fromAddressSpan.style.display="",a=Settings.FromDisplayName,a||(a=Config.Strings.AddName),this.fromAddressSpan.innerHTML=
ws.string.escapeXml(a)):(this.fromAddressSpan.style.display="none",this.fromAddressSpan.innerHTML="");this.fromSelect.currentValue&&(this.fromSelect.currentValueNode.innerHTML=ws.string.escapeXml(this.fromSelect.currentValue));this.fromSelect.sizeMyself();this.connect(this.fromSelect,"valueChanged","handleChange")},handleChange:function(){var a=this.fromSelect.currentValue;if(this.fromSelect.currentIndex){var b="other";-1!=a.toLowerCase().indexOf("@aol.com")?b="aol":-1!=a.toLowerCase().indexOf("@aim.com")&&
(b="aim");ws.reporting.reportDLAction("Mail-Compose-ChangeDefaultFrom-"+b)}ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr=a;ws.WebSuite.cmpseMsgWidPersist.lastSelFromAddr=a;a=Settings.FromDisplayName;a||(a=Config.Strings.AddName);this.fromAddressSpan.innerHTML=ws.string.escapeXml(a);this.fromSelect.currentValueNode.innerHTML=ws.string.escapeXml(ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr);this.fromSelect.sizeMyself()},confirmClose:function(a,b,c){this.abortSend();d.isIE&&(d.doc.body.focus(),
this.focusInput.focus());this.inTransition?ws.widget.Dialogs.show(Config.Strings.MessageNotSent+"\x3cbr\x3e"+Config.Strings.MsgNotSentNavigateAway,[Config.Strings.Yes,Config.Strings.No],d.hitch(this,function(b){0==b&&a?ws.lang.setTimeout(a,this.callBackTimeout):(this.editor.focus(),c&&c())})):this.isDirty()?Config.EnableSaveAsDraft?ws.widget.Dialogs.show("\x3cb\x3e"+Config.Strings.DirtyMessageSent+"\x3c/b\x3e\x3cbr\x3e"+Config.Strings.DirtyMessage5+"\x3cbr\x3e\x3cbr\x3e",[Config.Strings.SaveAsDraft,
Config.Strings.KeepWriting,Config.Strings.Discard],d.hitch(this,function(b){0==b?this.isPopup&&a?(d.subscribe("WSDoneSyncingAfterSave",d.hitch(this,function(){ws.lang.setTimeout(a,this.callBackTimeout)})),this.saveMessage(null,!0,a)):a&&this.saveMessage(null,!0,a):2==b?a&&ws.lang.setTimeout(a,this.callBackTimeout):(this.editor.focus(),c&&c())}),{width:390}):!this.isStandAlone&&this.showNewWindowLink&&ws.settings.allowPopups()?ws.widget.Dialogs.show(Config.Strings.DirtyMessageSent+"\x3cbr\x3e\x3cbr\x3e"+
Config.Strings.DirtyMessage2,[Config.Strings.Yes,Config.Strings.KeepWriting,Config.Strings.No],d.hitch(this,function(b){0==b?this.popOut():2==b&&a?ws.lang.setTimeout(a,this.callBackTimeout):(this.editor.focus(),c&&c())})):ws.widget.Dialogs.okCancel(Config.Strings.DirtyMessageSent+"\x3cbr\x3e\x3cbr\x3e"+Config.Strings.DirtyMessage3,d.hitch(this,function(b){b&&a?ws.lang.setTimeout(a,this.callBackTimeout):(this.editor.focus(),c&&c())})):a&&ws.lang.setTimeout(a,this.callBackTimeout)},onSessionExpired:function(a){this.isDirty()?
ws.widget.Dialogs.yesNo(Config.Strings.AuthTimeoutMain+"\x3cbr\x3e\x3cbr\x3e"+Config.Strings.DirtyMessage2,d.hitch(this,function(b){b?(this.resetDirty(),this.popOut(!0,a,!0)):(this.resetDirty(),a&&a())})):a&&a()},onBeforeUnload:function(){return this.isShowing()&&this.isDirty()?Config.EnableSaveAsDraft?Config.Strings.DirtyMessageSaveOrSent:Config.Strings.DirtyMessageSent:null},isDirty:function(){return this.getCurrentStateHash().contentVal!=this.initialStateHash||this.editor.isAuxDirty()||this.attachListDirty},
isSubIntervalDirty:function(){return Math.abs(this.getCurrentStateHash().bodyLength-this.autoSaveCharCount)>=Config.AutoSaveToDraftsCharDelta},setDirty:function(){this.autoSaveCharCount=-Config.AutoSaveToDraftsCharDelta;this.initialStateHash=this.getCurrentStateHash().contentVal+"x"},resetDirty:function(){this.editor.setAuxDirty(!1);var a=this.getCurrentStateHash();this.initialStateHash=a.contentVal;this.autoSaveCharCount=a.bodyLength;this.autoSaveIntervalCounter=0},getCurrentStateHash:function(){var a=
!1;if(d.isWebKit||d.isFF)a=!0;var a=this.editor.getPlainContent(a),b=a.length;return{contentVal:this.toField.getValue()+this.ccField.getValue()+this.bccField.getValue()+this.subjectInput.value+a+this.getAttachmentsHash(),bodyLength:b}},getAttachmentsHash:function(){var a="",b=null;if(this.sourceAttachments)for(var c=0;c<this.sourceAttachments.length;c++)(b=this.addRefObj(this.sourceAttachments[c]))&&(a+=b.key);if(this.filledFileItems)for(c=0;c<this.filledFileItems.length;c++)(b=this.addRefObj(this.filledFileItems[c]))&&
(a+=b.key);return a},getConcatenatedAddressDisplayForm:function(a){for(var b="",c=0;c<a.length;c++)b+=a[c].email,c<a.length-1&&(b+="; ");return b},openDraft:function(a,b){this.model.getMessage(b,a,!1).then(d.hitch(this,function(a){var b=a.message.headers,c=this.getConcatenatedAddressDisplayForm(b.to),f=this.getConcatenatedAddressDisplayForm(b.cc),g=this.getConcatenatedAddressDisplayForm(b.bcc);this.reset({dontAddSignature:!0,draftMessage:a,composeType:"draft",to:c,cc:f,bcc:g,subject:b.subject,body:a.simpleBody.html,
backToString:this.backToString,from:b.from[0].email},d.hitch(this,function(){this.editor.handleFeaturesDraft();this.resetDirty()}))}),function(){})},syncAftersave:function(a){this.forceReadSavedMsg=!1;this.composeType="draft";this.draftMessage=a;this.originalMessage={};this.initAttachments(null,!1);this.editor.updateImageUrlsAfterSave(a);this.editor.cleanUpFormAfterSave();this.editor.handleFeaturesDraft();this.resetDirty();d.publish("WSDoneSyncingAfterSave")},deleteDraft:function(){this.draftMessage&&
this.draftMessage.message?this.confirmClose(d.hitch(this,function(){this.model.deleteMessages([this.draftMessage.message.id]).then(d.hitch(this,function(){this.cancel()}),d.hitch(this,function(a){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteMessages-deleteDraft",a,"ComposeMessageWidget.js");ws.widget.Dialogs.ok(Config.Strings.ErrorDeletingDraft);this.cancel()}));this.resetDirty()}),"draftDeleted"):this.cancel()},deleteAutoSaveDraft:function(){this.model.deleteMessages([this.draftMessage.message.id]).then(function(){},
function(){});this.resetDirty()},toggleButtonState:function(a){if(!this.composeDelay||this.isInlineReply)d.query(".sendButton",this.domNode).forEach(function(b){e.byNode(b).setEnabled(a)}),d.query(".spellCheckButton",this.domNode).forEach(function(b){e.byNode(b).setEnabled(a)}),d.query(".saveDraftButton",this.domNode).forEach(function(b){e.byNode(b).setEnabled(a)}),d.query(".attachFile",this.domNode).forEach(function(b){e.byNode(b).setEnabled(a)}),d.query(".inlineImage",this.domNode).forEach(function(b){e.byNode(b).setEnabled(a)}),
d.query(".toggleFormat",this.domNode).forEach(function(b){e.byNode(b).setEnabled(a)}),d.query(".deleteDraftButton",this.domNode).forEach(function(b){e.byNode(b).setEnabled(a)}),d.query(".newWindowLink",this.domNode).forEach(function(b){e.byNode(b).setEnabled(a)}),d.query(".expandViewButton",this.domNode).forEach(function(b){e.byNode(b).setEnabled(a)}),d.query(".cancelButton",this.domNode).forEach(function(b){e.byNode(b).setEnabled(a)})},sendMessage:function(){this.msgIsSent||this._sendMessage()||
setTimeout(d.hitch(this,function(){this.toggleButtonState(!0)}),2E3)},_sendMessage:function(){this.fixAddressesField();if(this.checkEmailFields())return!1;this.toggleButtonState(!1);if(this.showBccParenWarning()||this.showMissingAttachmentWarning())return!1;if(!this.sendAfterSpellCheck&&Settings.SpellCheckBeforeSend&&Config.EnableSpellCheck)return this.editor.endSpellCheck(),this.sendAfterSpellCheck=!0,this.editor.spellCheck(!0),!1;this.spellCheckFailure=!1;this.editor.endSpellCheck();if(this.editor.processBeforeSend())return!1;
if(this.editor.isReadyForSend())return this.continueSending(!1);d.publish("WSFeedbackStart",[Config.Strings.ImageEmbed_UploadThenSend,!1,d.hitch(this,"abortSend"),null,Config.Strings.ImageEmbed_StopSend]);this.editor.callWhenReadyForSaveOrSend(d.hitch(this,"continueSending",!0));return!0},abortSend:function(){this.editor.cancelCallWhenReadyForSaveOrSend();this.toggleButtonState(!0)},continueSending:function(a){a&&d.publish("WSFeedbackEnd",[Config.Strings.ImageEmbed_UploadThenSend]);d.publish("WSFeedbackStart",
[Config.Strings.SendingProgress]);this.inTransition=!0;a=d.hitch(this,function(a){var b=Config.Strings.ErrorSending;a&&a.code&&(b=this.lookupSaveError(a.code));ws.widget.Dialogs.ok(b);d.publish("WSFeedbackEnd",[Config.Strings.SendingProgress]);this.toggleButtonState(!0);this.inTransition=!1;this.inSaveOrSend=null;this.editor.cleanUp()});this.saveOrSendMessage({action:"sendMessage",load:d.hitch(this,function(){var a=d.hitch(this,function(){this.toggleButtonState(!0);this.inTransition=!1;this.inSaveOrSend=
null;this.editor.cleanUp()}),b=["Mail-Sent"];if(this.stationeryEnabled){var c=this.editor.stationeryState;c&&c.id&&c.name&&(ws.reporting.reportDLAction("Mail-Stationery-MailSent-"+c.id),this.editor.resetStationeryState())}this.autoSaveDraftSubInterval&&(clearInterval(this.autoSaveDraftSubInterval),this.autoSaveDraftSubInterval=null);this.editor.messageHasEmbeddedImages()&&b.push("ImageEmbedded");a();this.resetDirty();this.isInlineReply&&ws.reporting.reportDLAction("Mail-Compose-InlineReplySent");
this.msgIsSent=!0;this.sendSuccessCB&&this.sendSuccessCB(this,b);d.publish("WSFeedbackEnd",[Config.Strings.SendingProgress]);this.composeCompleteCleanup&&this.composeCompleteCleanup(this)}),error:a});return!0},lookupSaveError:function(a){return Config.Strings.ErrorSaving+" ("+a+")"},checkForNewlyAdded:function(){var a=null,b=this.addressListToArray(this.toField),c=this.addressListToArray(this.ccField),d=this.addressListToArray(this.bccField),b=b.concat(c,d);this.addressModel||(this.addressModel=new p);
for(c=0;c<b.length&&((a=this.addressModel.getRecordByEmail(b[c]))||(a=this.addressModel.getRecordByScreenName(b[c])),a);c++);a||ws.lang.setTimeout(this,function(){this.addressModel.core.loadData()},5E3)},addressListToArray:function(a){b=[];if(a.getValue()){var b=a.getValue().split(/[\s,;]/);for(a=0;a<b.length;a++)d.trim(b[a])||b.splice(a--,1)}return b},handleMissingTmpImages:function(a){a.missingImages&&this.editor.refetchMissingImages(a.missingImages);a.errorMsg&&ws.widget.Dialogs.ok(a.errorMsg)},
draftHasAttachmentsOrInlines:function(){if(this.draftMessage){var a=!this.draftMessage.message&&this.originalMessage.message?this.originalMessage:this.draftMessage;return a.hasAttachments||a.hasInlines||a.hasImages||a.inlineImgIds&&0<a.inlineImgIds.length}return!1},getFormDataFiles:function(){var a=this.filledFileItems||[];if(this.editor){var b=this.editor.getFilledInlineImgItems();b&&(a=a.concat(b))}return a},saveMessage:function(a,b,c){this.fixAddressesField();if(this.checkEmailFields(!0))return!1;
this.toggleButtonState(!1);b||ws.reporting.reportDLAction("Mail-Compose-Save");d.publish("WSFeedbackStart",[Config.Strings.SavingProgress]);this.showFeedback();this.editor.endSpellCheck();a=d.hitch(this,function(a){var b=Config.Strings.ErrorSaving;a&&a.code&&(b=this.lookupSaveError(a.code));ws.widget.Dialogs.ok(b);this.toggleButtonState(!0);c&&c();this.inSaveOrSend=null});this.saveOrSendMessage({action:"saveMessage",load:d.hitch(this,function(a){var b=!1;a.message.spame&&"Y"!=a.message.spame&&(b=
!0,ws.widget.Dialogs.ok(Config.Strings.ErrorSaving));this.editor&&(this.syncAftersave(a),this.editor.focus());d.publish("WSFeedbackEnd",[Config.Strings.SavingProgress]);b||d.publish("WSFeedbackStart",[Config.Strings.MessageSaved,!0]);this.toggleButtonState(!0);b||this.editor&&this.resetDirty();this.toolbar&&this.toolbar.layout();c&&c();this.inSaveOrSend=null}),error:a})},isSaveInProgress:function(){return this.autoSaveMsgInProgress||null!=this.inSaveOrSend},autoSaveMessage:function(a,b,c){if(!this.isSaveInProgress()&&
!this.editor.isSpellCheckRunning()){b&&(c=!0);if(!c)if(this.autoSaveIntervalCounter+=Config.AutoSaveToDraftsSubInterval,this.autoSaveIntervalCounter>=Config.AutoSaveToDraftsInterval){if(this.autoSaveIntervalCounter=0,!this.isDirty())return}else if(!this.isSubIntervalDirty())return;this._autoSaveMessage(a,b)}},saveDirtyMsg:function(a){this.isDirty()?this._autoSaveMessage(!0,!1,a):a&&a()},_autoSaveMessage:function(a,b,c){var g=this.toField.getValue(),e=this.ccField.getValue(),f=this.bccField.getValue();
if(Settings.AccountMigratedToOath&&-1!=Config.MaxRecipient&&this.maxRecipientsExceeded(g,e,f))d.publish("WSFeedbackStart",[Config.Strings.MaxRecipientError,!0]);else{this.toggleButtonState(!1);this.autoSaveMsgInProgress=!0;this.showFeedback(Config.Strings.SavingProgress,!0);var h=d.hitch(this,function(c){this.autoSaveMsgInProgress=!1;if(!a){var f=Config.Strings.ErrorSaving;""!=c.code&&(f=this.lookupSaveError(c.code));ws.widget.Dialogs.ok(f)}b&&this.editor.cleanUpFormAfterSave();null!=this.lastSavedMsgUID&&
this.deleteAutoSaveDraft();this.toggleButtonState(!0);this.showFeedback()});this.saveOrSendMessage({action:"saveMessage",isAutoSave:!0,isInlineAutoSave:b,load:d.hitch(this,function(a){var b=this.autoSaveMsgInProgress=!1;if(a.message.spame&&"Y"!=a.message.spame)b=!0,h(a.error,!1,a.errCode);else{this.editor&&this.syncAftersave(a);if(!b){a=new Date;var f=Config.Strings.MessageSaved;null!=a&&(f=ws.string.substituteParams(Config.Strings.AutoSavedDrafts,ws.date.formatTime(a,"h:mma")));this.showFeedback(f);
this.lastSaved=a}this.toggleButtonState(!0);b||this.resetDirty();c&&c()}}),error:h})}},handlePendingSaveOrSend:function(a){a?null!=this.pendingSaveOrSendArgs&&this.saveOrSendMessage(this.pendingSaveOrSendArgs):this.pendingSaveOrSendArgs&&(this.inSaveOrSend=this.pendingSaveOrSendArgs=null,this.toggleButtonState(!0))},saveOrSendMessage:function(a){a.isAutoSave||(this.inSaveOrSend=a.action,this.pendingSaveOrSendArgs=null,this.editor.prepareForSaveOrSend("sendMessage"==this.inSaveOrSend));for(var b=0,
b=0;b<this.filledFileItems.length;b++)this.filledFileItems[b].unsavedAttach=!1;this.attachListDirty=!1;var b="reply"==this.composeType||"reply-all"==this.composeType,c="forward"==this.composeType,e=this.originalMessage&&this.originalMessage.message?this.originalMessage.message.id:"";"draft"==this.composeType&&this.draftMessage&&this.draftMessage.message&&this.draftMessage.message.inReplyTo&&(e||(e=this.draftMessage.message.inReplyTo.messageReference.id),this.draftMessage.message.inReplyTo.replied&&
(b=!0),this.draftMessage.message.inReplyTo.forwarded&&(c=!0));var h=null;13<d.isSafari||a.isAutoSave&&a.isInlineAutoSave?h=this.editor.replaceImgSrcsWithCID():this.editor.richMode&&(h=this.editor.getRichContent());var f=this.draftMessage&&this.draftMessage.message?this.draftMessage.message.id:"";""==f&&e&&(f=e);var x={action:a.action,from:this.fromSelect.currentValue,to:this.toField.getValue(),cc:this.ccField.getValue(),bcc:this.bccField.getValue(),subject:this.subjectInput.value,body:h,plainBody:this.editor.getPlainContent(),
richEdit:this.editor.richMode,sourceAttachments:this.sourceAttachments,draftMsgId:f,inReplyTo:e,isReply:b,isForward:c};this.draftMessage&&this.draftMessage.message&&(x.csid=this.draftMessage.message.csid);b=this.getFormDataFiles();b.length&&(x.formDataRequest={files:b},x.timeout=Config.rpcReqTimeoutLong);ws.Jws.saveMessage(x).then(d.hitch(this,function(b){this.model.updateAfterSave(x);b.isForward=!1;"forward"==this.composeType&&(b.isForward=!0,b.forwardUid=this.originalMessage.message.id||this.lastSavedMsgUID||
this.draftMessage.message.id);a.load(b)}),function(b){a.error&&a.error(b)})},spellCheck:function(){this.editor.spellChecking?ws.reporting.reportDLAction("Mail-Compose-SpellcheckUncheck"):d.publish("WSFeedbackStart",[Config.Strings.SpellCheckProgress]);this.editor.toggleSpellCheck()},spellCheckButtonSetHighlight:function(a){d.query(".spellCheckButton",this.domNode).forEach(function(b){(b=e.byNode(b))&&b.setHighlight(a)})},onEndSpellCheck:function(){this.spellCheckButtonSetHighlight(!1);this.isInlineReply&&
this.domNode.scrollIntoView(!1);this.editor&&this.editor.focus();this.sendAfterSpellCheck&&this.spellCheckFailure&&(d.doc.documentElement.focus(),ws.widget.Dialogs.okCancel(Config.Strings.SendConfirmationPrompt,d.hitch(this,function(a){a&&this.sendMessage();this.sendAfterSpellCheck=!1})))},onPerfectSpelling:function(){ws.reporting.reportDLAction("Mail-Compose-SpellCheck");this.spellCheckFailure=!1;d.publish("WSFeedbackEnd",[Config.Strings.SpellCheckProgress]);this.sendAfterSpellCheck&&this.sendMessage()},
onImperfectSpelling:function(){ws.reporting.reportDLAction("Mail-Compose-SpellCheck");this.spellCheckFailure=!0;d.publish("WSFeedbackEnd",[Config.Strings.SpellCheckProgress]);this.spellCheckButtonSetHighlight(!0);this.sendAfterSpellCheck&&ws.widget.Dialogs.show(Config.Strings.SpellingErrorsFound,[Config.Strings.SendNow,Config.Strings.ReviewErrors],d.hitch(this,function(a){0==a&&(this.spellCheckFailure=!1,this.sendMessage())}),!0)},toggleFormatBar:function(a){var b=null;if(this.editor)if(a&&!this.editor.richMode)this.enableRichText(),
this.formattingBarShowing=!0;else{a||(b=this.editor.richMode&&!1!==this.formattingBarShowing?!0:!1);a=this.editor.toggleFormatToolBar(b);(b=this.getVisibleToolbarButton("toggleFormat"))&&e.byNode(b).setTip(a?Config.Strings.HideRTEToolbar:Config.Strings.ShowRTEToolbar);if(a=this.getVisibleToolbarButton("inlineImage"))a.style.display=this.editor.richMode?"":"none";this.toastToolbar.layout();this.layout();this.editor.focus()}},getVisibleToolbarButton:function(a){a=d.query("."+a,this.domNode);for(var b=
0;b<a.length;b++){var c;a:{if(c=a[b])c=c.parentNode;for(var e=3;e&&c;){if("none"===c.style.display){c=!0;break a}c=c.parentNode;e--}c=!1}if(!c)return a[b]}return null},cancel:function(a){this.isInlineReply&&this.resetStationery();this.cancelCB&&this.cancelCB(null,!1,!1,this);a&&(a.toastTitleBtnHandled=!0)},onClickNewWindow:function(){this.popOut()},onClickOpenExpanded:function(){this.endSpelling(d.hitch(this,this.openFullPane))},openFullPane:function(){if(this.isInlineReply&&1===Settings.ComposeMode)this.popOut();
else{var a=this.isInlineReply?null:0,b=this.model.getFolderByType("DRAFT");ws.WebSuite.exitSettings();if(this.isDirty())this.saveDirtyMsg(d.hitch(this,function(){var c=this.draftMessage?this.draftMessage.message.id:null,f=d.hitch(this,function(f){0===a?ws.WebSuite.destroyToastCompose():this.cancelCB&&this.cancelCB(!0);f&&c&&f.openDraft(b.name,c)});ws.WebSuite.openDraftInFullPane(f,a)}));else{var c=this.originalMessage,e=this.composeType,h=null;this.draftMessage&&this.draftMessage.message&&(e="draft",
h=this.draftMessage.message.id);var f=d.hitch(this,function(f){0===a?ws.WebSuite.destroyToastCompose():this.cancelCB&&this.cancelCB(!0);if(f&&e)switch(e){case "draft":h&&f.openDraft(b.name,h);break;case "reply-all":e="replyAll";case "reply":case "forward":if(f[e]&&c)f[e](c)}});ws.WebSuite.openDraftInFullPane(f,a)}}},updateToastTitle:function(){this.isToaster&&(this.toastTitle.domNode.innerHTML=ws.string.escapeXml(this.subjectInput.value)||Config.Strings.ToastTitle)},toastComposeMinimize:function(){d.addClass(ws.WebSuite.toastCompose,
"toastComposeMinimize");this.isToastComposeMinimized=!0;ws.WebSuite.updateToastComposePosition(!0);this.layout();this.saveDirtyMsg()},toastComposeRestore:function(){this.isToastComposeMinimized&&(d.removeClass(ws.WebSuite.toastCompose,"toastComposeMinimize"),this.isToastComposeMinimized=!1,ws.WebSuite.updateToastComposePosition(!0),this.layout())},endSpelling:function(a){this.editor.spellChecking?(this.editor.endSpellCheck(),a&&setTimeout(a,10)):a&&a()},onClickOpenFullPane:function(a){this.endSpelling(d.hitch(this,
this.openFullPane));a&&(a.toastTitleBtnHandled=!0)},onClickMinView:function(a){this.endSpelling(d.hitch(this,this.toastComposeMinimize));a&&(a.toastTitleBtnHandled=!0)},onClickRestoreView:function(a){this.toastComposeRestore();a&&(a.toastTitleBtnHandled=!0)},onClickToastTitleBar:function(a){a.toastTitleBtnHandled||this.toastComposeRestore()},popOut:function(a,b,c){this.checkForAttachments(d.hitch(this,"_popOut",c),a,b)},_popOut:function(a){window.composeContext={model:this.model,picturesModel:this.picturesModel,
callback:d.hitch(this,"popOutComplete"),jwsData:{wssid:ws.Jws.jwsData.wssid,mboxId:ws.Jws.jwsData.mboxId}};ws.io.openWindow(Config.BaseMailPagesURL+"ComposeMessage?ws_popup\x3dtrue\x26ws_suite\x3dtrue","","status\x3dyes,resizable\x3dyes,left\x3d5,top\x3d5,width\x3d885,height\x3d606",a)},popOutComplete:function(a){var b={to:this.toField.getValue(),cc:this.ccField.getValue(),bcc:this.bccField.getValue(),subject:this.subjectInput.value,body:d.isWebKit&&this.editor.isEmpty()?"":this.editor.getContent(),
originalMessage:this.originalMessage,draftMessage:this.draftMessage,composeType:this.composeType,dontAddSignature:!0,isDirty:this.isDirty(),sourceAttachments:this.sourceAttachments,isPopOut:!0,isStationeryMode:this.editor.isStationeryMode,stationeryState:this.editor.stationeryState};this.editor.notifyUploadCompletions(a.editor);a.reset(b,d.hitch(this,function(){this.resetDirty();this.cancelCB&&this.cancelCB()}))},checkForAttachments:function(a,b,c){if(0<this.filledFileItems.length)ws.widget.Dialogs[b?
"ok":"okCancel"](Config.Strings.PopOutWithAttachedFilesWarning,d.hitch(this,function(d){(b||d)&&a();c&&c()}));else a(),c&&c()},initAttachments:function(a,b){this.fileInputCounter=0;var c;this.maxMessageSize=parseInt(Config.MaxMessageSize);this.attachUploadDispId=0;this.attachUploadDispRefObjs={};this.attachUploadDispNodes={};this.attachUploadFilenameMap={};if(a)this.sourceAttachments=ws.lang.shallowCopy(a,!0);else{this.sourceAttachments=[];var g=[];this.draftMessage&&this.draftMessage.message&&(g=
this.draftMessage.message.attachments);this.originalMessage&&this.originalMessage.message&&(g=this.originalMessage.message.attachments);this.hideImages&&this.originalMessage&&this.originalMessage.message&&(c=this.model.getUidData(this.originalMessage.message.id))&&(g=c.attachments);if(g&&("forward"==this.composeType||"draft"==this.composeType))for(c=0;c<g.length;c++)"attachment"==g[c].disposition&&this.sourceAttachments.push(g[c])}this.filledFileItem||(this.filledFileItems=[]);if(this.filledFileItems.length){g=
[];for(c=0;c<this.filledFileItems.length;c++)this.filledFileItems[c].unsavedAttach&&g.push(this.filledFileItems[c]);this.filledFileItems=g}(c=document.getElementById(this.id+"_filledInput"))||(c=d.create("div",{id:this.id+"_filledInput",style:{display:"none"}},d.body()));b&&(c.innerHTML="",this.emptyFileInput=null);this.createEmptyFileInput();for(c=this.attachmentDisplay;c&&null!=c.lastChild;)c.removeChild(c.lastChild);this.updateAttachmentRow()},createEmptyFileInput:function(){var a=document.getElementById(this.id+
"_filledInput");this.emptyFileInput&&a&&a.appendChild(this.emptyFileInput);this.getVisibleToolbarButton("inlineImage")&&(a="file"+this.fileInputCounter++,this.emptyFileInput=d.create("input",{type:"file",name:a,multiple:"multiple",style:{display:"none"}},d.body()),this.connect(this.emptyFileInput,"onchange","onSelectFile"),this.fileInputCounter++)},fileDropPreventDefault:function(a){a&&(a.event&&a.event.preventDefault?a.event.preventDefault():a.preventDefault&&a.preventDefault(),a.event&&a.event.stopPropagation?
a.event.stopPropagation():a.stopPropagation&&a.stopPropagation())},fileDropStart:function(){if(!this.isSaveInProgress()){this.dragInProgress=!0;var a;this.headerWidgetContent&&this.headerWidgetContent&&(this.headerWidgetContent.style.visibility="hidden",this.attachDropTarget||(this.attachDropTarget=d.create("div",{className:"attachDropTarget"},this.domNode),B(this.attachDropTarget,"dragenter",d.hitch(this,this.attachFileDragEnter)),B(this.attachDropTarget,"dragover",d.hitch(this,this.attachFileDragOver)),
B(this.attachDropTarget,"dragleave",d.hitch(this,this.attachFileDragLeave)),B(this.attachDropTarget,"drop",d.hitch(this,this.attachFileDragDrop)),ws.html.setInnerText(this.attachDropTarget,Config.Strings.DropTargetAttach)),this.attachDropTarget.style.display="block",a=d.marginBox(this.headerWidget.domNode),d.marginBox(this.attachDropTarget,a),d.style(this.attachDropTarget,{"line-height":a.h+"px"}));this.editor.richMode&&(a=this.editor&&this.editor.getViewWidget())&&a.domNode&&(a.domNode.style.visibility=
"hidden",this.imgDropTarget||(this.imgDropTarget=d.create("div",{className:"imgDropTarget"},this.domNode),B(this.imgDropTarget,"dragenter",d.hitch(this,this.imageFileDragEnter)),B(this.imgDropTarget,"dragover",d.hitch(this,this.imageFileDragOver)),B(this.imgDropTarget,"dragleave",d.hitch(this,this.imageFileDragLeave)),B(this.imgDropTarget,"drop",d.hitch(this,this.imageFileDragDrop)),ws.html.setInnerText(this.imgDropTarget,Config.Strings.DropTargetImage)),this.imgDropTarget.style.display="block",a=
d.marginBox(this.editor.domNode),d.marginBox(this.imgDropTarget,a),d.style(this.imgDropTarget,{"line-height":a.h+"px"}))}},_fileDropEnd:function(){this.headerWidgetContent&&this.headerWidgetContent&&(this.headerWidgetContent.style.visibility="inherit");this.attachDropTarget&&(this.attachDropTarget.style.display="none");var a=this.editor&&this.editor.getViewWidget();a&&a.domNode&&(a.domNode.style.visibility="inherit");this.imgDropTarget&&(this.imgDropTarget.style.display="none");this.editor.focus()},
fileDropEnd:function(){this.pendingDropEnd&&clearTimeout(this.pendingDropEnd);this.pendingDropEnd=setTimeout(d.hitch(this,function(){this.dragInProgress||this._fileDropEnd()}),20);this.dragInProgress=!1},attachFileDragEnter:function(a){ws.html.dragEvtContainsFiles(a)&&(this.fileDropStart(),this.fileDropPreventDefault())},attachFileDragOver:function(a){ws.html.dragEvtContainsFiles(a)&&(this.fileDropStart(),this.fileDropPreventDefault())},attachFileDragLeave:function(a){ws.html.dragEvtContainsFiles(a)&&
(this.fileDropEnd(),this.fileDropPreventDefault())},attachFileAdd:function(a,b){if(!this.attachSizeCheck(a)){ws.reporting.reportDLAction("Mail-Compose-Drag\x26DropAttachment");for(var c=a.files,d=0;d<c.length;d++)c[d].unsavedAttach=!0,this.filledFileItems.push(c[d]);this.updateAttachmentRow();b&&this.autoSaveMessage(!1,!1,!0)}},attachFileDragDrop:function(a){ws.html.dragEvtContainsFiles(a)&&(this.fileDropEnd(),this.fileDropPreventDefault(),a&&a.dataTransfer&&a.dataTransfer.files&&a.dataTransfer.files.length&&
this.attachFileAdd(a.dataTransfer,!0))},imageFileDragEnter:function(a){ws.html.dragEvtContainsFiles(a)&&this.editor.richMode&&(this.fileDropStart(),this.fileDropPreventDefault())},imageFileDragOver:function(a){ws.html.dragEvtContainsFiles(a)&&this.editor.richMode&&(this.fileDropStart(),this.fileDropPreventDefault())},imageFileDragLeave:function(a){ws.html.dragEvtContainsFiles(a)&&this.editor.richMode&&(this.fileDropEnd(),this.fileDropPreventDefault())},imageFileDragDrop:function(a){if(ws.html.dragEvtContainsFiles(a)&&
this.editor.richMode&&(this.fileDropEnd(),this.fileDropPreventDefault(),a&&a.dataTransfer&&a.dataTransfer.files&&a.dataTransfer.files.length&&this.editor.checkForNonImgFileType)){for(var b={files:[]},c={files:[]},e=0;e<a.dataTransfer.files.length;e++)this.editor.checkForNonImgFileType(a.dataTransfer.files[e])?c.files.push(a.dataTransfer.files[e]):b.files.push(a.dataTransfer.files[e]);c.files.length&&this.attachFileAdd(c,b.files.length?!1:!0);b.files.length&&(this.editor.focus(),setTimeout(d.hitch(this,
function(){this.editor.addInlineImages(b)}),100))}},attachSizeCheck:function(a){return this.attachFileExceedsLimit(a)?(a=ws.string.substituteParams(Config.Strings.AttachSizeExceeds,this.maxMessageSize/1048576),ws.widget.Dialogs.ok(a),!0):!1},onSelectFile:function(){var a=this.emptyFileInput;if(a&&a.files&&a.files.length)if(this.attachSizeCheck(a))d._destroyElement(a),this.createEmptyFileInput();else if(""!=a.value){a.style.top="-10000px";a.style.left="-10000px";for(var b=0;b<a.files.length;b++)a.files[b].unsavedAttach=
!0,this.filledFileItems.push(a.files[b]);this.createEmptyFileInput();this.updateAttachmentRow();1<a.files.length&&this.autoSaveMessage(!1,!1,!0);this.editor.focus()}},attachFileExceedsLimit:function(a){var b=0,c,d;for(c=0;c<this.sourceAttachments.length;c++)this.sourceAttachments[c].size&&(b+=this.sourceAttachments[c].size*this.fileAttachSizeEncodeRatio);for(c=0;c<this.filledFileItems.length;c++)d=this.getClientFileSize(this.filledFileItems[c]),null!=d&&(b+=d);if(a&&a.files&&a.files.length)for(c=
0;c<a.files.length;c++)d=this.getClientFileSize(a.files[c]),null!=d&&(b+=d);return b>this.maxMessageSize?!0:!1},findRefObjKey:function(a){var b=null,c;for(c in this.attachUploadDispRefObjs)if(a===this.attachUploadDispRefObjs[c]){b=c;break}return b},addRefObj:function(a){var b=this.findRefObjKey(a),c=!1;b||(b="dispId"+this.attachUploadDispId++,this.attachUploadDispRefObjs[b]=a,c=!0);return{key:b,isNew:c}},addedInlineImage:function(){this.forceReadSavedMsg=!0},removedInlineImage:function(){this.forceReadSavedMsg=
this.draftMessage&&this.draftMessage.attachments?this.draftMessage.hasInlines:!0},getClientFileSize:function(a){var b=0;a&&"undefined"!=typeof a.size&&(b=a.size);return b},getFileName:function(a){var b="";a&&"undefined"!=typeof a.name&&(b=a.name);return b},getSizeLabeled:function(a){var b=a+" B";1024<Number(a)&&(b=(a/1024).toFixed(0)+" KB");1048576<Number(a)&&(b=(a/1048576).toFixed(1)+" MB");return b},updateAttachmentRow:function(){var a={},b,c;this.draftMessage&&this.draftMessage.message&&0<this.draftMessage.message.attachments.length&&
(this.forceReadSavedMsg=!0);var e=d.hitch(this,function(a,b,c,f){var d=a,e="";a=ws.string.escapeXml(a);if(30<=a.length){var g=a.lastIndexOf(".");-1!=g&&(e=a.substring(g+1));a=a.substring(0,27)+"..."+e}"number"==typeof b&&(a+=" ("+this.getSizeLabeled(b)+")");a=new r({label:a,title:d,showArrow:!0,fixSize:!0,className:"unselectable btn attachmentBtn"});a.startup();this.attachmentDisplay.appendChild(a.domNode);a.arrowNode.innerHTML='\x3csvg class\x3d"btnArrowSvg"\x3e\x3cuse xlink:href\x3d"#iconClose"\x3e\x3c/use\x3e\x3c/svg\x3e';
this.connect(a.arrowNode,"onclick",c);this.attachUploadDispNodes[f]=a.domNode});for(c=0;c<this.sourceAttachments.length;c++)b=this.addRefObj(this.sourceAttachments[c]),a[b.key]=this.attachUploadDispRefObjs[b.key],b.isNew&&e(this.sourceAttachments[c].filename,this.sourceAttachments[c].size?Math.round(this.sourceAttachments[c].size*this.fileAttachSizeEncodeRatio):null,d.hitch(this,"deleteSourceAttachment",b.key),b.key,!1);for(c=0;c<this.filledFileItems.length;c++)if(b=this.addRefObj(this.filledFileItems[c]),
a[b.key]=this.attachUploadDispRefObjs[b.key],b.isNew){var h=this.getClientFileSize(this.filledFileItems[c]),f=this.getFileName(this.filledFileItems[c]);e(f,h,d.hitch(this,"deleteFileAttachment",b.key),b.key,!1)}this.attachUploadDispRefObjs=a;var a=0,x;for(x in this.attachUploadDispNodes)this.attachUploadDispRefObjs[x]?a++:(this.attachmentDisplay.removeChild(this.attachUploadDispNodes[x]),delete this.attachUploadDispNodes[x]);ws.html.setShowing(this.attachmentRow,0<a);this.layoutSoon()},deleteSourceAttachment:function(a){if(!this.isSaveInProgress()){for(var b=
0;b<this.sourceAttachments.length;b++)this.sourceAttachments[b]===this.attachUploadDispRefObjs[a]&&(this.sourceAttachments.splice(b,1),this.updateAttachmentRow());this.editor.focus()}},deleteFileAttachment:function(a){if(!this.isSaveInProgress()){for(var b=0;b<this.filledFileItems.length;b++)this.filledFileItems[b]===this.attachUploadDispRefObjs[a]&&(this.filledFileItems.splice(b,1),this.updateAttachmentRow());this.editor.focus()}},checkForFormattingBarOff:function(){this.toggleFormatBar(null)},fetchAndRespond:function(a,
b,c){this.model.getMessage(b,a).then(d.hitch(this,function(a){this[c](a)}))},disableBtnsForCompose:function(){this.toggleButtonState(!1);this.composeDelay=!0;setTimeout(d.hitch(this,function(){this.composeDelay=!1;this.toggleButtonState(!0)}),3E3)},reply:function(a){this.disableBtnsForCompose();var b;b=a.containsHchat?a.message.headers.to[0].email.replace(/@unknown\.domain/i,""):a.message.headers.replyTo&&0<a.message.headers.replyTo.length?a.message.headers.replyTo[0].email:a.message.headers.from[0].email;
this.composeResponse(a,"reply","Re:",b);if(d.isFF)try{this.editor.textarea.setSelectionRange(0,0)}catch(u){}},containsSenderAddress:function(a,b){if(a&&0<a.length&&b&&0<b.length)for(var c=0;c<b.length;c++)for(var d=b[c][1].toLowerCase(),e=0;e<a.length;e++)if(-1!=a[e].email.toLowerCase().indexOf(d))return!0;return!1},replyAll:function(a){this.disableBtnsForCompose();var b=!1,c=a.message.folder,e=a.message.headers;if(this.model.isFolderType(c,"INBOX")||this.model.isFolderType(c,"NEWMAIL")||this.model.isFolderType(c,
"OLDMAIL")||this.model.isFolderType(c,"USER")||this.model.isFolderType(c,"SAVED"))var b=this.containsSenderAddress(e.to,this.model.sendAddresses),c=this.containsSenderAddress(e.cc,this.model.sendAddresses),h=this.containsSenderAddress(e.from,this.model.sendAddresses),b=!b&&!c&&!h&&!a.isLikelyForward;var f;if(a.containsHchat)f=e.to[0].email.replace(/@unknown\.domain/i,"");else var r=this.model.createRecipientString([].concat(e.from).concat(e.to)),p=this.model.createRecipientString(e.cc);this.composeResponse(a,
"reply-all","Re:",f||r,p);b&&(d.publish("peoplepicker/close"),window.clearTimeout(this.focusBodyTimer),ws.reporting.reportDLAction("Mail-Compose-BCCWarning"),a=ws.widget.Dialogs.okCancel(Config.Strings.BccReplyConfirm,d.hitch(this,function(a){a?this.focusField():(this.resetDirty(),this.cancel())}),!0),setTimeout(d.hitch(a,"focus"),250));if(d.isFF)try{this.editor.textarea.setSelectionRange(0,0)}catch(fa){}},isImageRemoved:function(a){var b=a.message.imagesRemoved;!b||Settings.DisplayImageWarning&&
!this.addressModel.getRecordByEmail(a.message.headers.from[0].email)||(b=!1);return b},forward:function(a){this.disableBtnsForCompose();var b=null;this.isImageRemoved(a)&&(b=Config.Strings.ShowImagesBeforeSending);null!=b?ws.widget.Dialogs.okCancel(b,d.hitch(this,function(b){b?ws.Jws.getMessage(a.message.id,a.message.folder.name,!1).then(d.hitch(this,function(a){this.composeResponse(a,"forward","Fwd:")})):(this.hideImages=!0,this.composeResponse(a,"forward","Fwd:"))})):this.composeResponse(a,"forward",
"Fwd:");if(d.isFF)try{this.editor.textarea.setSelectionRange(0,0)}catch(u){}},composeResponse:function(a,b,c,e,h){var f="";a?f=this.buildOrigMessageBodyHeader(a):a={selectedText:"",uid:null,subject:"",body:"",displayTo:"",displayCc:"",displayBcc:"",displayFrom:""};var g=a.selectedText?"\x3cblockquote style\x3d'border-left: 2px solid blue; padding-left: 3px;'\x3e"+a.selectedText+"\x3c/blockquote\x3e":"",r=a.simpleBody.html;Config.BypassDownloadUrl&&13<d.isSafari&&(r=this.model.fixDownloadUrls(r));
var k=null;this.isPopup||(k="Inline Response");f='\x3cfont size\x3d"2"\x3e'+(f+r)+"\x3c/font\x3e";this.isInlineReply&&this.editor.useRichMode()&&(f='\x3cdiv class\x3d"aolmail_wmstd_quote"\x3e\x3cdiv\x3e'+f+"\x3c/div\x3e\x3c/div\x3e");this.reset({from:this.model.formatRecipients(a.message.headers.from),to:e,cc:h,subject:c+" "+this.model.getBaseSubject(a.message.headers.subject),quote:g,body:f,originalMessage:a,composeType:b,backToString:this.backToString,beaconSuffix:k,isStationeryMode:!1},d.hitch(this,
function(){this.editor.richMode&&(this.encodeLinkUrls(),this.editor.getFunmail().finalizeTemplate())}))},doLinkUrlTest:function(){if(!this.linkUrlTested){this.linkUrlTested=!0;this.linkUrlHowToEncode=0;var a=document.createElement("A");a.href='#"';a=a.href;-1!=a.indexOf("%22")?this.linkUrlHowToEncode=1:-1!=encodeURI(a).indexOf("%22")&&(this.linkUrlHowToEncode=2)}},encodeLinkUrls:function(){this.linkUrlTested||this.doLinkUrlTest();if(this.linkUrlHowToEncode)for(var a=d.query("A",this.editor.editDiv()),
b=0;b<a.length;b++)a[b].href&&(a[b].href=1==this.linkUrlHowToEncode?a[b].href:encodeURI(a[b].href))},preRichContentGet:function(){this.removeShowOrgMsgCntl()},postRichContentGet:function(){this.collapseOriginalMessage()},adviceRichContentSet:function(){this.isInlineReply&&this.collapseOriginalMessage()},adviceIEContentChange:function(){this.checkForInlineCompseVis()},collapseOriginalMessage:function(){var a=d.query(".aolmail_wmstd_quote",this.editor.editDiv());if(a.length){var b=d.hitch(this,this.showOriginalMessage),
c=null,e=a[0],a=d.query(".aolmail_wmstd_ctrl",e),h=null;if(a.length)for(e=0;e<a.length;e++)h=a[e],0===e?c=B(h,"click",b):h.parentNode.removeChild(h);else d.create("a",{contentEditable:"false",href:"#",className:"aolmail_wmstd_ctrl wsLink",aolmail_wmstd_ctrl:Config.Strings.ShowOriginalMessage},e),a=d.query(".aolmail_wmstd_ctrl",e),a.length&&(h=a[0],c=B(h,"click",b));this.showOriginalMessageHandler&&this.showOriginalMessageHandler.remove&&(this.showOriginalMessageHandler.remove(),this.showOriginalMessageHandler.remove());
this.showOriginalMessageHandler=c}},removeShowOrgMsgCntl:function(){this.showOriginalMessageHandler&&this.showOriginalMessageHandler.remove&&this.showOriginalMessageHandler.remove();d.query(".aolmail_wmstd_ctrl",this.editor.editDiv()).forEach(function(a){a.parentNode.removeChild(a)})},showOriginalMessage:function(a){this.removeShowOrgMsgCntl();d.query(".aolmail_wmstd_quote",this.editor.editDiv()).forEach(function(a){d.removeClass(a,"aolmail_wmstd_quote")});this.editor.focus();a.preventDefault();a.stopPropagation()},
buildOrigMessageBodyHeader:function(a){var b=Config.Strings.OriginalMessage+"\n";a=a.message.headers;a.from&&a.from.length&&(b+=Config.Strings.From+": "+this.model.formatRecipients(a.from)+"\n");if(a.to&&a.to.length)var c=this.model.formatRecipients(a.to),b=b+(Config.Strings.To+": "+c+"\n");a.cc&&a.cc.length&&(b+=Config.Strings.Cc+": "+this.model.formatRecipients(a.cc)+"\n");b+=Config.Strings.SentOn+": "+ws.date.formatDateTime(new Date(1E3*parseInt(a.date,10)),Config.Strings.MsgViewDateFormat)+"\n";
null!=a.subject&&""!=a.subject&&(b+=Config.Strings.Subject+": ",b+=a.subject,b+="\n");b=ws.string.escapeXml(b+"\n");return b=b.replace(/\n/g,"\x3cbr\x3e")},showFeedback:function(a,b){a?ws.html.setShowing(this.feedbackNode,!0):(ws.html.setShowing(this.feedbackNode,!1),this.spinner&&this.spinner.stop());b?(this.spinner||(this.spinner=new c("AutoSave",this.feedbackSpin)),this.spinner.spin()):this.spinner&&this.spinner.stop();ws.html.setInnerText(this.feedbackMsg,a||"")},checkEmailFields:function(a){var b=
this.toField.getValue(),c=this.ccField.getValue(),d=this.bccField.getValue();if(Config.ValidateEmailFormat){if(!(a||b&&""!=b||c&&""!=c||d&&""!=d))return ws.widget.Dialogs.ok(Config.Strings.ErrorNoValidRecipient),!0;a="";if(this.fixDomainlessAddresses()){if(a=this.toField.invalidAddresses().join(", "))return ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.InvalidAddressInField,a,Config.Strings.To)),!0;if(a=this.ccField.invalidAddresses().join(", "))return ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.InvalidAddressInField,
a,Config.Strings.Cc)),!0;if(a=this.bccField.invalidAddresses().join(", "))return ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.InvalidAddressInField,a,Config.Strings.Bcc)),!0}else{var e=this.toField.invalidAddresses().join(", "),f=0;e&&""!=e&&(a+="\x3cbr/\x3e\x3cspan style\x3d'font-weight:bold'\x3e"+Config.Strings.To+"\x3c/span\x3e: "+e+"\n",f++);(e=this.ccField.invalidAddresses().join(", "))&&""!=e&&(a+="\x3cbr/\x3e\x3cspan style\x3d'font-weight:bold'\x3e"+Config.Strings.Cc+"\x3c/span\x3e: "+
e+"\n",f++);(e=this.bccField.invalidAddresses().join(", "))&&""!=e&&(a+="\x3cbr/\x3e\x3cspan style\x3d'font-weight:bold'\x3e"+Config.Strings.Bcc+"\x3c/span\x3e: "+e+"\n",f++);e=!1;a&&(a.match(",")||1<f)&&(e=!0);f="";if(a&&""!=a)return f=e?Config.Strings.WrongEmailAddresses:Config.Strings.WrongEmailAddress,f+=a+ws.string.substituteParams(Config.Strings.CorrectFormat,"\x3cspan style\x3d'font-style:italic'\x3e","\x3c/span\x3e"),ws.widget.Dialogs.ok(f),!0}}return Settings.AccountMigratedToOath&&-1!=Config.MaxRecipient&&
this.maxRecipientsExceeded(b,c,d)?(ws.widget.Dialogs.ok(Config.Strings.MaxRecipientError),!0):!1},maxRecipientsExceeded:function(a,b,c){var e=function(a){return a?(a=d.trim(a),","==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1),a=d.trim(a)),","==a.charAt(0)&&(a=a.substr(1),a=d.trim(a)),a?a.split(",").length:0):0};a=0+e(a);a+=e(b);a+=e(c);return a>Config.MaxRecipient?!0:!1},fixDomainlessAddresses:function(a){if(a&&a.isAutoOrPickerOpen()||!(Config.FixDomainlessAddresses&&0<Config.FixDomainlessAddresses.length)||
(a=ws.UserContext.UserAddress.split("@"))&&2!=a.length)return null;a=a[1];var b=Config.FixDomainlessAddresses.toLowerCase().split(",");return 0>d.indexOf(b,a.toLowerCase())?null:a},endDotsRE:/\.+$/,namePartRE:/^[\w.!#$%\u00e2\u20ac\u2122*+\/=?^_`{|}~\'-]+$/,fixAddressesField:function(a){var b=this.fixDomainlessAddresses(a),c=this,e=function(a){if(b&&a&&c.namePartRE.test(a))return a+"@"+b;a=d.trim(a);var f=a.search(c.endDotsRE);-1!=f&&(a=a.substr(0,f));return a},h=d.hitch(this,function(a){if(!a.isAutoOrPickerOpen()){var b=
a.getValue();if(""!=b){for(var b=b.split(/[\n,;]/),c=[],f=0;f<b.length;f++){var h=d.trim(b[f]);if(h){var g=this.addressModel.searchDLName(h);if(g&&g.composeValue)for(h=g.composeValue.split(/[,;]/),g=0;g<h.length;g++){var r=e(h[g]);r&&c.push(r)}else(r=e(h))&&c.push(r)}}a.setValue(c.join(", "))}}});a?h(a):(h(this.toField),h(this.ccField),h(this.bccField))},onBlurAddrFld:function(a){this.onFocusAddressField=null;this.fixAddressesField(a)},onFocusAddrFld:function(a){this.headerCollapse(!1);this.onFocusAddressField=
a;a.repositionPicker()},onResized:function(){this.inherited(arguments)},hideEmptyAddressField:function(a){var b=this[a.toLowerCase()+"Field"];if(b&&this[a+"FieldShowing"]){var c=b.getValue();d.trim(c)?(this.isInlineReply||this.isToaster)&&b.compactField(!0):this.showHideField(a,!1)}},cmpWidgetFocus:function(){d.addClass(this.domNode,"inlineComposeNodeSelected")},cmpWidgetBlur:function(){d.removeClass(this.domNode,"inlineComposeNodeSelected")},onEditorFocus:function(){this.headerCollapse(!0);(this.isInlineReply||
this.isToaster)&&this.toField.compactField(!0);Settings.ShowCcField||this.hideEmptyAddressField("Cc");Settings.ShowBccField||this.hideEmptyAddressField("Bcc")},headerCollapse:function(a){var b=a?"none":"";if(this.isInlineReply||this.isToaster)this.editor.editControl&&this.editor.editControl.closeControls(),this.fromLine.style.display=b,a||(this.toField.compactField(!1),this.ccField.compactField(!1),this.bccField.compactField(!1),this.fromSelect.sizeMyself()),this.isInlineReply&&(this.subjectContainer.style.display=
b),this.layoutSoon()},showHideField:function(a,b){var c=this[a.toLowerCase()+"Field"],d=this.toField["show"+a+"Link"];ws.html.setShowing(c.domNode,b);ws.html.setShowing(d,!b);b&&(c.resizeSelf(),c.focus());this[a+"FieldShowing"]=b;this.toField.resizeSelf();this.layoutSoon()},showCc:function(){this.showHideField("Cc",!0);this.headerCollapse(!1)},showBcc:function(){this.showHideField("Bcc",!0);this.headerCollapse(!1)},showBccParenWarning:function(){var a=this.toField.getValue()+this.ccField.getValue()+
this.bccField.getValue();return-1!=a.indexOf("(")||-1!=a.indexOf(")")?(ws.widget.Dialogs.ok(Config.Strings.ProductName+Config.Strings.BccParenthesesWarning,d.hitch(this,"showBcc")),!0):!1},showMissingAttachmentWarning:function(){var a=Config.Strings.attachmentPhrases;if(a){if(!ws.lang.isEmptyArray(this.sourceAttachments)||!ws.lang.isEmptyArray(this.filledFileItems)||this.missingAttachmentWarningShown)return!1;for(var b=this.editor.getPlainContent().toLocaleLowerCase(),c=b.indexOf(Config.Strings.OriginalMessage.toLocaleLowerCase()),
b=-1==c?this.subjectInput.value+" "+b:b.substring(0,c),a=a.split("|"),c=0;c<a.length;c++)if(-1!=b.indexOf(a[c].toLocaleLowerCase()))return b=Config.Strings.MissingAttachmentWarning,Config.Strings.MissingAttachmentWarning.indexOf("{0}")&&Config.Strings.MissingAttachmentWarning.indexOf("{1}")&&(b=ws.string.substituteParams(Config.Strings.MissingAttachmentWarning,"\x3cbr\x3e\x3cbr\x3e",a[c])),ws.widget.Dialogs.okCancel(b,d.hitch(this,function(a){a&&this.sendMessage()}),!0),this.missingAttachmentWarningShown=
!0}return!1},getSendConfirmationSetUpParams:function(){var a=this.cancelCB;return{cancelCB:function(){a&&a(null,!1,!1,this)},toAddresses:this.toField.getAddressList(),ccAddresses:this.ccField.getAddressList(),bccAddresses:this.bccField.getAddressList()}},launchStationery:function(a){this.stationeryEnabled&&ws.WebSuite.SidePanel&&ws.WebSuite.SidePanel.showStationery(!0,function(){ws.WebSuite.SidePanel.stationeryWidget&&ws.WebSuite.SidePanel.stationeryWidget.selectStationery(a,!0)})},setField:function(a,
b){var c=b.replace(/^\s+/,"").replace(/\s+$/,"");if(""!=c){var d=this[a.toLowerCase()+"Field"],e=d.getValue().replace(/^\s+/,"").replace(/\s+$/,"");"cc"==a.toLowerCase()?this.showCc():"bcc"==a.toLowerCase()&&this.showBcc();e=e?";"==e.charAt(e.length-1)||","==e.charAt(e.length-1)?e+(" "+c+","):e+(", "+c+","):c+",";d.setValue(e)}},idleMonitorStarted:function(){if(this.isPopup&&_ws_isOpenerWS()){var a=function(){opener.dojo.publish("IdleMonitor/activityDetected")};this.connect(window,"scroll",a);this.connect(window,
"resize",a);this.connect(document,"mousemove",a);this.connect(document,"keyup",a)}}})})},"ws/pictures/PictureEditor":function(){define("ws/pictures/PictureEditor","dojo/_base/declare dojo/dom-attr ws/widget/SpellCheckEditor ws/widget/DropDownButton ws/pictures/PictureEditControl ws/reporting ws/widget/util ws/widget/popup".split(" "),function(v,l,m,d,e){return v([m],{hasAccessTokenToPicturePlugin:!1,constructor:function(d){d.isInlineReply&&(this.templateString=this.templateString.replace("dijit/layout/BorderContainer",
"ws/widget/Pane"),this.templateString=this.templateString.replace('data-dojo-attach-point\x3d"layoutWidget"','data-dojo-attach-point\x3d"paneWidget"'));this.inherited(arguments)},startup:function(){this.composeForm=null;this.inherited(arguments);this.imageIdMap={};this.phUrl=Config.BaseImagesURL+"common/progressAnimation_lg.gif";this.maxMessageSize=parseInt(Config.MaxMessageSize)},setContent:function(d,e,b,c,r,p){this.inherited(arguments);this.richMode&&this.setupFileInputForm(b)},convertPicturesInMail:function(){for(var d=
this.docObj.getElementsByTagName("img"),t=0;t<d.length;t++)if(d[t].id&&-1!=d[t].id.indexOf("AOLP")){var b=d[t].id,c=d[t].src;this.imageIdMap[b]={id:b,placeholder:!1,altText:d[t].alt,srcUrl:c,smallUrl:c,mediumUrl:c,largeUrl:c}}d.length&&!this.editControl&&(this.editControl=new e({editor:this}),this._supportingWidgets.push(this.editControl),dojo.body().appendChild(this.editControl.domNode),this.editControl.startup())},updateImageUrlsAfterSave:function(d){if(d=d.message.attachments)for(var e=this.editDiv().getElementsByTagName("img"),
b=0;b<e.length;b++){var c=e[b];if(c.src&&c.id&&-1!==c.id.indexOf("AOLP"))for(var h=0;h<d.length;h++){var p=d[h],m="\x3c"==p.contentId.charAt(0)?p.contentId.substr(1,p.contentId.length-2):p.contentId;if("inline"==p.disposition&&-1!=c.id.indexOf(m)&&""!==p.url){h=p.downloadUrl;Config.BypassDownloadUrl&&13<dojo.isSafari&&(l.set(c,"_src",h),h=this.model.fixDownloadUrls(h));c.src=h;c.className="AOLInlineImage";this.imageIdMap&&this.imageIdMap[c.id]&&this.imageIdMap[c.id].placeholder&&(this.imageIdMap[c.id].placeholder=
!1);break}}}},cleanUpFormAfterSave:function(){var d=[],e;for(e in this.imageIdMap)this.imageIdMap.hasOwnProperty(e)&&this.imageIdMap[e].placeholder&&(this.imageIdMap[e].altText&&(5>d.length?d.push(this.imageIdMap[e].altText):5==d.length&&d.push("...")),this.handleFailedInlineImage(e))},showFailedInlineImgError:function(d,e,b){var c="";d?c=d:e&&"ERR607"==e.toUpperCase()?c=ws.string.substituteParams(Config.Strings.AttachSizeExceeds,this.maxMessageSize/1048576):e&&"ERR608"==e.toUpperCase()?(c=Config.Strings.ImageEmbed_PostNotImage,
b&&(c=b+": "+c)):c=Config.Strings.InlineAttachUploadFailed;ws.widget.Dialogs.ok(c)},setupFileInputForm:function(d){Config.EnablePictures&&this.constructEmbedImageForm()},onSelectFile:function(d){(d=this.embedImageFileInput)&&this.addInlineImages(d,!0)},checkForNonImgFileType:function(d){d=d.type;return!d||-1!=d.toLowerCase().indexOf("image")&&"image/tiff"!=d.toLowerCase()?!1:!0},addInlineImages:function(d,t){this.endSpellCheck&&this.endSpellCheck();if(d&&d.files&&d.files.length){for(var b=[],c=0,
h=0;h<d.files.length;h++){var p=d.files[h],c=c+(p.fileSize||p.size);if(c>this.maxMessageSize){h=ws.string.substituteParams(Config.Strings.AttachSizeExceeds,this.maxMessageSize/1048576);ws.widget.Dialogs.ok(h);t&&(d.parentNode.removeChild(d),this.constructEmbedImageForm());return}this.checkForNonImgFileType(p)&&b.push(ws.string.escapeXml(p.name))}if(b.length)h=b.join(", ")+": "+Config.Strings.ImageEmbed_PostNotImage,ws.widget.Dialogs.ok(h),t&&(d.parentNode.removeChild(d),this.constructEmbedImageForm());
else if(this.editControl||(this.editControl=new e({editor:this}),dojo.body().appendChild(this.editControl.domNode),this.editControl.startup()),this.focus(),""!=d.value){b=[];try{for(h=0;h<d.files.length;h++){var l="AOLP."+(new Date).getTime()%1E6+h;d.files[h].unsavedAttach=!0;d.files[h].inlineImgId=l;var m=this.getFileName(d.files[h]);b.push(this.insertEmbeddedImage(l,m,d.files[h]))}}catch(q){}b.length&&(this.insertHTML(b.join("")),this.editControl.installEventHandlers(!0),this.callWhenReadyForSaveOrSend(this.sendReadyCallback),
this.embedImageFileInput.name=l,this.addedInlineImage(),t||ws.reporting.reportDLAction("Mail-Compose-Drag\x26DropImage"),this.autoSaveMessage(!1,!0),this.constructEmbedImageForm())}}},constructEmbedImageForm:function(){this.embedImageFileInput=dojo.create("input",{type:"file",multiple:"multiple",style:{display:"none"}},dojo.body());this.connect(this.embedImageFileInput,"onchange","onSelectFile")},addedInlineImage:function(){},removedInlineImage:function(){},replaceImgSrcsWithCID:function(){var d=
this.getRichContent(),e=d,b=document.createElement("DIV");b.innerHTML=d;d=b.getElementsByTagName("img");for(b=0;b<d.length;b++){if(d[b].src.toLowerCase()==this.phUrl.toLowerCase())var c=d[b].outerHTML.replace(d[b].src,"cid://"+d[b].id),c=c.replace(d[b].className,"AOLInlineImage"),e=e.replace(d[b].outerHTML,c);l.has(d[b],"_src")&&(c=d[b].outerHTML,d[b].src=l.get(d[b],"_src"),l.remove(d[b],"_src"),e=e.replace(c,d[b].outerHTML))}return e},insertEmbeddedImage:function(d,e,b){var c='\x3cdiv class\x3d"envelope" align\x3d"left" style\x3d"float: none;"\x3e\x3cimg src\x3d"%{0}" width\x3d"'+
Config.InsertedPictureLongestEdge+'" id\x3d"%{1}" style\x3d"%{2}" alt\x3d"%{3}" class\x3d"%{4}" title\x3d"%{3}"\x3e\x3c/div\x3e\x3cdiv\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e';this.imageIdMap[d]={id:d,filledInlineImgItem:b,placeholder:!0,altText:e,srcUrl:"",smallUrl:"",mediumUrl:"",largeUrl:""};return ws.string.substituteParams(c,this.phUrl,d,"margin: 5px; vertical-align: middle;",e,"wsPlaceholder")},getFilledInlineImgItems:function(){var d=[],e;for(e in this.imageIdMap)this.imageIdMap.hasOwnProperty(e)&&
this.imageIdMap[e].filledInlineImgItem&&d.push(this.imageIdMap[e].filledInlineImgItem);return d.length?d:null},handleFailedInlineImage:function(d){this.editControl&&(this.editControl.removeEventHandlers(d),this.editControl.closeControls());var e=dojo.query('[id\x3d"'+d+'"]');e&&e.length&&(dojo.isWebKit?e.orphan():e[0].parentNode.parentNode.removeChild(e[0].parentNode));delete this.imageIdMap[d];this.editControl.installEventHandlers(!0);this.callWhenReadyForSaveOrSend(this.sendReadyCallback)},isReadyForSend:function(){for(var d in this.imageIdMap)if(this.imageIdMap.hasOwnProperty(d)&&
this.imageIdMap[d].placeholder&&this.getElemByIdFromEditDiv(d))return!1;return!0},callWhenReadyForSaveOrSend:function(d){(this.sendReadyCallback=d)&&this.isReadyForSend()&&(this.sendReadyCallback(),this.sendReadyCallback=null)},cancelCallWhenReadyForSaveOrSend:function(){this.sendReadyCallback=null},messageHasEmbeddedImages:function(){return 0<dojo.query('img[class\x3d"AOLInlineImage"]',this.editDiv()).length?!0:!1},refetchMissingImages:function(d){if(d)for(var e=0;e<d.length;++e){var b=d[e].replace(/^AOLP/,
"TIE");if(b=this.getElemByIdFromEditDiv(b))b.removeAttribute("alt"),b.src=""}},prepareForSaveOrSend:function(d){if(d)for(var e in this.imageIdMap)if(this.imageIdMap.hasOwnProperty(e)&&0<=e.indexOf("AOLP")&&(d=this.getElemByIdFromEditDiv(e))&&(d.id=d.id.replace(/^AOLP/,"TIE"),d.getAttribute("_viewlink"))){var b=d.ownerDocument.createElement("a");b.setAttribute("target","_blank");b.href=d.getAttribute("_viewlink");b.appendChild(dojo.clone(ph));d.parentNode.replaceChild(b,ph)}},getFileName:function(d){var e=
"";d&&"undefined"!=typeof d.name&&(e=ws.string.escapeXml(d.name));return e},notifyUploadCompletions:function(d){this.tornEditor=d},cleanUp:function(){this.editControl&&this.editControl.closeControls();this.sendReadyCallback=null},getElemByIdFromEditDiv:function(d){return(d=dojo.query('[id\x3d"'+d+'"]',this.editDiv()))&&d.length?d[0]:null},containsInlineImage:function(){for(var d=this.docObj.getElementsByTagName("img"),e=0;e<d.length;e++)if(d[e].id&&-1!=d[e].id.indexOf("AOLP")&&dojo.hasClass(d[e],
"AOLInlineImage"))return!0;return!1},clean:function(){this.editControl&&(this.editControl.destroy(),this.editControl=null)}})})},"ws/widget/SpellCheckEditor":function(){define("ws/widget/SpellCheckEditor","dojo/_base/declare dojo/text!ws/widget/SpellCheckEditor.css dojo dojo/regexp dojo/_base/window dijit/_Widget dijit/_TemplatedMixin ws/widget/WSEditor ws/widget/WSMenu ws/widget/WSMenuItem ws/widget/WSMenuSeparator ws/widget/Pane ws/dom ws/html ws/io ws/widget/Dialogs".split(" "),function(v,l,m,
d,e,h,t,b,c,r,p,z){return v([h,t,b],{css:{templateString:l},spellNodeCount:0,misspellings:0,spellChecking:!1,startup:function(){this.inherited(arguments);m.addClass(this.domNode,"spellCheckEditor")},enableDesignMode:function(b){this.inherited(arguments);this.connect(this.editDiv(),"onkeypress","endSpellCheck")},toggleSpellCheck:function(){this.spellChecking?this.endSpellCheck():this.spellCheck()},spellCheck:function(b){var c=this.richMode?ws.html.renderedTextContent(this.editDiv()):this.textarea.value;
errStr="Dialogs.ok shown - Error Handler for SpellCheck-WebStdSpellCheck";errFn=function(b){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,errStr,b,"SpellCheckEditor.js");ws.widget.Dialogs.ok(Config.Strings.ErrorSpellChecking)};loadFn=m.hitch(this,"handleSpellCheckResult",b);m.xhrPost({url:"/webmail-std/spellcheck",handleAs:"json",content:{check:c,user:Settings.UserUID},error:errFn,load:loadFn})},handleSpellCheckResult:function(b,c){if(ws.lang.isEmptyObject(c.sets))b?this.focus():ws.widget.Dialogs.ok(Config.Strings.PerfectSpelling,
m.hitch(this,function(){this.focus()})),this.onPerfectSpelling();else{this.onImperfectSpelling();this.spellChecking=!0;this.misspellings=this.spellNodeCount=0;this.sets=c.sets;if(this.richMode)this.spellDoc=this.docObj,this.spellWin=this.win(),this.spellBody=this.editDiv();else{this.spellBodyPane||(this.spellBodyPane=new z({layoutAlign:"client"}),this.spellBodyPane.domNode.className="spellBody wsInput",this.spellBodyPane.hide(),this.layoutWidget?this.layoutWidget.addChild(this.spellBodyPane):this.domNode.appendChild(this.spellBodyPane.domNode),
this.spellBodyPane.domNode.tabIndex=-1,this.connect(this.spellBodyPane.domNode,"onkeypress",this.endSpellCheck));var d=this.textarea.value.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"),d=d.replace(/\r?\n/g,"\x3cbr /\x3e\n");this.spellBodyPane.domNode.innerHTML=d;this.textareaPane.hide();this.spellBodyPane.show();this.layoutWidget&&this.layoutWidget.resize();this.spellDoc=document;this.spellWin=window;this.spellBody=this.spellBodyPane.domNode;m.isSafari&&(this.hide(),ws.lang.setTimeout(this,"show",
0))}this.highlightErrors()}},onPerfectSpelling:function(){},onImperfectSpelling:function(){},highlightErrors:function(){var b=[],c;for(c in this.sets)b.push(d.escapeString(c));var e=new RegExp("\\b("+b.join("|")+")\\b");ws.dom.forEachNode(this.spellBody,null,m.hitch(this,function(a){if(3!=a.nodeType||null!=a.parentNode.id&&"sp-"==a.parentNode.id.substr(0,3))return 0;for(var b=0,c=e.exec(a.nodeValue);c;){var d=c.index,h=c[0],c=this.sets[h];if(!h||!c){c=null;break}a=a.splitText(d);d=a.splitText(h.length);
h=this.spellDoc.createElement("a");h.href="#";h.id="sp-"+this.spellNodeCount;h.title=c.length?Config.Strings.ClickToReplaceWith+(m.isIE?"\n":"")+c.join(", "):Config.Strings.NoSpellingSuggestions;h.className="spell spellingErr";this.connect(h,"onclick","showSpellMenu");a.parentNode.replaceChild(h,a);h.appendChild(a);a=d;this.spellNodeCount++;this.misspellings++;b+=2;c=null;try{c=e.exec(a.nodeValue)}catch(f){}}return b}))},closeSpellMenu:function(b){this.spellMenu&&this.spellMenu.isShowing()&&this.spellMenu.close()},
showSpellMenu:function(b){b=m.fixEvent(b||this.spellWin.event);var d=b.target,h=this.sets[d.childNodes[0].nodeValue];if(h){this.spellMenu?(this.spellMenu.close(),m.forEach(this.spellMenu.getChildren(),function(a){a.destroy()})):(this.spellMenu=new c,this.spellMenu.startup());for(var a=m.hitch(this,function(a,b){var c=new r({caption:a});c.onClick=b;this.spellMenu.addChild(c)}),g=0;g<h.length;g++)a(h[g],m.hitch(this,"correctWord",d,h[g]));0<h.length&&(g=new p,this.spellMenu.addChild(g));a(h.length?
Config.Strings.IgnoreWord:Config.Strings.NoSuggestions,m.hitch(this,"ignoreWord",d));a(Config.Strings.IgnoreAll,m.hitch(this,"ignoreAll",d));h=this.richMode?e.withGlobal(this.win(),"position",m,[d]):{x:b.clientX,y:b.clientY};d=m.contentBox(d);this.spellMenu.open(h.x,h.y+d.h);b.stopPropagation()}},changeWord:function(b,c){if(null==c)if(b&&b.childNodes[0]){var d=b.childNodes[0];(c=d.nodeValue)||(c=m.isIE?d.innerText:d.textContent)}else c="";d=this.spellDoc.createTextNode(c);m.place(d,b,"before");m._destroyElement(b);
this.richMode&&this.editDiv().focus()},correctWord:function(b,c){this.changeWord(b,c);this.misspellings--;0==this.misspellings&&this.endSpellCheck()},ignoreWord:function(b){this.correctWord(b,null)},ignoreAll:function(b){b=b.childNodes[0].nodeValue.toLowerCase();for(var c=0;c<this.spellNodeCount;c++){var d=this.spellDoc.getElementById("sp-"+c);d&&d.childNodes&&1==d.childNodes.length&&3==d.childNodes[0].nodeType&&d.childNodes[0].nodeValue.toLowerCase()==b&&this.correctWord(d,null)}},isSpellCheckRunning:function(){return this.spellChecking},
endSpellCheck:function(){if(this.spellChecking){for(var b=0;b<this.spellNodeCount;b++){var c=this.spellDoc.getElementById("sp-"+b);c&&""!=c.innerHTML&&this.changeWord(c,null)}this.spellMenu&&this.spellMenu.hide();this.richMode?this.editDiv().focus():(this.textarea.value=ws.html.renderedTextContent(this.spellBody),this.spellBodyPane.hide(),this.textareaPane.show(),b=m._getPadBorderExtents(this.textarea),c=this.textarea.style,c.width=parseInt(this.textareaPane.domNode.style.width)-b.w+"px",c.height=
parseInt(this.textareaPane.domNode.style.height)-b.h+"px");this.spellChecking=!1;this.onEndSpellCheck()}},onEndSpellCheck:function(){}})})},"ws/widget/WSEditor":function(){define("ws/widget/WSEditor","dojo/_base/declare dojo/text!ws/widget/WSEditor.html dojo/text!ws/widget/WSEditor.css dojo/text!ws/widget/WSEditorDocument.css dojo dijit dijit/_Widget dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/dom-attr ws/mail/funmail ws/widget/ColorPalette ws/widget/LinkEditor ws/widget/SmileyPalette ws/widget/EmojiPicker ws/browser ws/html ws/string ws/settings ws/widget/util ws/widget/Pane ws/widget/Button ws/widget/WSSelect dijit/layout/BorderContainer".split(" "),
function(v,l,m,d,e,h,t,b,c,r,p,z,B,q,D){ws.widget.fontOptions=[{value:"Arial, Helvetica, sans-serif",display:'\x3cb style\x3d"font-weight: normal; font-family: Arial,Helvetica,sans-serif"\x3eArial\x3c/b\x3e',selected:!0,checked:!0},{value:"Comic Sans MS, sans-serif",display:'\x3cb style\x3d"font-weight: normal; font-family: Comic Sans MS, sans-serif"\x3eComic Sans MS\x3c/b\x3e'},{value:"Courier New, Courier, mono",display:'\x3cb style\x3d"font-weight: normal; font-family: Courier New, Courier, mono"\x3eCourier New\x3c/b\x3e'},
{value:"Georgia, Times New Roman, Times, Serif",display:'\x3cb style\x3d"font-weight: normal; font-family: Georgia, Times New Roman, Times, Serif"\x3eGeorgia\x3c/b\x3e'},{value:"impact, sans-serif",display:'\x3cb style\x3d"font-weight: normal; font-family: impact, sans-serif"\x3eImpact\x3c/b\x3e'},{value:"Tahoma, Arial, Helvetica, sans-serif",display:'\x3cb style\x3d"font-weight: normal; font-family: Tahoma, Arial, Helvetica, sans-serif"\x3eTahoma\x3c/b\x3e'},{value:"Times New Roman, Times, serif",
display:'\x3cb style\x3d"font-weight: normal; font-family: Times New Roman, Times, serif"\x3eTimes New Roman\x3c/b\x3e'},{value:"Verdana, Arial, Helvetica, sans-serif",display:'\x3cb style\x3d"font-weight: normal; font-family: Verdana, Arial, Helvetica, sans-serif"\x3eVerdana\x3c/b\x3e'},{value:"WingDings",display:'\x3cb style\x3d"font-weight: normal;"\x3eWingDings\x3c/b\x3e'}];3<=e.isFF&&ws.widget.fontOptions.splice(ws.widget.fontOptions.length-1,1);if(e.isWebKit){h=e.isChrome?'"':"'";for(var a=
0;a<ws.widget.fontOptions.length;a++){for(var g=ws.widget.fontOptions[a].value.split(","),u=!1,k=0;k<g.length;k++){var w=e.trim(g[k]);g[k]=w;-1!=w.indexOf(" ")&&(u=!0,g[k]=h+w+h)}u&&(ws.widget.fontOptions[a].value=g.join(", "))}}ws.widget.fontSizePicker=[{value:"1",display:"\x3cspan style\x3d'font-size:8pt;'\x3e8 pt\x3c/span\x3e",pointSz:"8pt"},{value:"2",display:"\x3cspan style\x3d'font-size:10pt;'\x3e10 pt\x3c/span\x3e",pointSz:"10pt",selected:!0,checked:!0},{value:"3",display:"\x3cspan style\x3d'font-size:12pt;'\x3e12 pt\x3c/span\x3e",
pointSz:"12pt"},{value:"4",display:"\x3cspan style\x3d'font-size:14pt;'\x3e14 pt\x3c/span\x3e",pointSz:"14pt"},{value:"5",display:"\x3cspan style\x3d'font-size:18pt;'\x3e18 pt\x3c/span\x3e",pointSz:"18pt"},{value:"6",display:"\x3cspan style\x3d'font-size:24pt;'\x3e24 pt\x3c/span\x3e",pointSz:"24pt"},{value:"7",display:"\x3cspan style\x3d'font-size:36pt;'\x3e36 pt\x3c/span\x3e",pointSz:"36pt"}];return v([t,b,c],{templateString:l,css:{templateString:m},bodyCss:{templateString:d},_earlyTemplatedStartup:!0,
rng:null,currentCommand:null,isStationeryMode:!1,contentSizingEnabled:!1,blankLine:"",tabindex:500,doForceRichMode:!1,addNewLinesToRichContent:!0,addDefaultFontStyles:!0,auxDirty:!1,fontPicker:null,fontSizePicker:null,justifyPicker:null,listPicker:null,indentPicker:null,docObj:null,startup:function(){this.docObj=window.document;if(!this._started){this._started=!0;this.connect(this.fontPicker,"valueChanged","changeFont");this.connect(this.fontSizePicker,"valueChanged","changeFontSize");this.connect(this.justifyPicker,
"valueChanged","changeJustify");this.connect(this.listPicker,"valueChanged","changeList");this.connect(this.indentPicker,"valueChanged","changeIndent");this.connect(this.textarea,"onfocus","onFocusHandler");r.remove(this.domNode,"tabindex");this.fontPicker.setOptions(ws.widget.fontOptions);if("undefined"!=typeof Settings.ComposeFont)for(var a=0;a<this.fontPicker.options.length;a++)if(this.compareFontFamilyStr(this.fontPicker.options[a].value,Settings.ComposeFont)){for(var b=0;b<this.fontPicker.options.length;b++)this.fontPicker.options[b].checked=
!1;this.fontPicker.options[a].checked=!0;break}this.fontSizePicker.setOptions(ws.widget.fontSizePicker);if("undefined"!=typeof Settings.ComposeFontSize)for(a=0;a<this.fontSizePicker.options.length;a++)if(this.fontSizePicker.options[a].value==Settings.ComposeFontSize){for(b=0;b<this.fontSizePicker.options.length;b++)this.fontSizePicker.options[b].checked=!1;this.fontSizePicker.options[a].checked=!0;break}this.justifyPicker.setOptions([{value:"justifyleft",display:'\x3cdiv class\x3d"iconMenuItem"\x3e\x3cimg src\x3d"'+
Config.SpacerImageURL+'" class\x3d"justifyleftIcon"\x3e\x3cspan\x3e'+Config.Strings.JustifyLeft+"\x3c/span\x3e\x3c/div\x3e",selected:!0,checked:!0},{value:"justifycenter",display:'\x3cdiv class\x3d"iconMenuItem"\x3e\x3cimg src\x3d"'+Config.SpacerImageURL+'" class\x3d"justifycenterIcon"\x3e\x3cspan\x3e'+Config.Strings.JustifyCenter+"\x3c/span\x3e\x3c/div\x3e"},{value:"justifyright",display:'\x3cdiv class\x3d"iconMenuItem"\x3e\x3cimg src\x3d"'+Config.SpacerImageURL+'" class\x3d"justifyrightIcon"\x3e\x3cspan\x3e'+
Config.Strings.JustifyRight+"\x3c/span\x3e\x3c/div\x3e"}]);this.connect(this.justifyPicker,"createMenu",function(){e.addClass(this.justifyPicker.menu.domNode,"iconMenu");e.toggleClass(this.justifyPicker.domNode,"activated",!0)});this.listPicker.setOptions([{value:"insertorderedlist",display:'\x3cdiv class\x3d"iconMenuItem"\x3e\x3cimg src\x3d"'+Config.SpacerImageURL+'" class\x3d"insertorderedlistIcon"\x3e\x3cspan\x3e'+Config.Strings.OrderedList+"\x3c/span\x3e\x3c/div\x3e"},{value:"insertunorderedlist",
display:'\x3cdiv class\x3d"iconMenuItem"\x3e\x3cimg src\x3d"'+Config.SpacerImageURL+'" class\x3d"insertunorderedlistIcon"\x3e\x3cspan\x3e'+Config.Strings.BulletedList+"\x3c/span\x3e\x3c/div\x3e"}]);this.connect(this.listPicker,"createMenu",function(){e.addClass(this.listPicker.menu.domNode,"iconMenu")});this.indentPicker.setOptions([{value:"outdent",display:'\x3cdiv class\x3d"iconMenuItem"\x3e\x3cimg src\x3d"'+Config.SpacerImageURL+'" class\x3d"indentIcon"\x3e\x3cspan\x3e'+Config.Strings.DecreaseIndent+
"\x3c/span\x3e\x3c/div\x3e"},{value:"indent",display:'\x3cdiv class\x3d"iconMenuItem"\x3e\x3cimg src\x3d"'+Config.SpacerImageURL+'" class\x3d"outdentIcon"\x3e\x3cspan\x3e'+Config.Strings.IncreaseIndent+"\x3c/span\x3e\x3c/div\x3e"}])}},enableContentSizing:function(){this.contentSizingEnabled=!0;e.addClass(this.editDiv(),"contentSizing")},setAuxDirty:function(a){this.auxDirty=a;e.isIE&&this.adviceIEContentChange()},isAuxDirty:function(){return this.auxDirty},setContent:function(a,b,c,d,g,h){this.updateMode();
this.richMode?(this.designModeEnabled?(this.editDiv().innerHTML=a,this.updateToolbar(null,!0),(!h||h&&!this.isStationeryMode)&&this.fixEditorForStationery(),b&&b()):this.enableDesignMode(a,b),this.adviceRichContentSet(),setTimeout(e.hitch(this,function(){e.query(".aol_mobilecontentwrapper",this.editDiv()).removeClass("aol_mobilecontentwrapper")}),100)):(this.textarea.value=d?a:c?a:ws.html.getText(a),this.isInlineReply&&(this.textAreaSizerConnected||(this.connect(this.textarea,"onkeyup","sizeTextAreaToContent"),
this.textAreaSizerConnected=!0),this.sizeTextAreaToContent()),b&&b());this.ieEditorBookmark=this.lastSelIENode=this.lastSelIEType=this.lastSelIERange=this.lastSelRange=null;this.setAuxDirty(!1)},_setup:function(){},enableDesignMode:function(a,b){var c=this.win(),d=this.editDiv();try{d.innerHTML=a,this.bodyCss.templateString?e.withGlobal(c,"insertCssText",ws.widget,[this.bodyCss.templateString,!0]):e.withGlobal(c,"insertCssText",ws.widget,[e._getText(this.bodyCss.templatePath),!0])}catch(E){}d.setAttribute("contentEditable",
"true");d.setAttribute("unselectable","off");e.isIE?(this.connect(d,"onkeyup","editDivEvtSelSaveIE"),this.connect(d,"onmouseup","editDivEvtSelSaveIE")):(this.connect(document.body,"onmousedown","lostFocusSelSave"),e.isWebKit&&this.connect(d,"onblur","lostFocusSelSave"));this.connect(d,"onfocus","onFocusHandler");e.isFF&&window.document.execCommand("enableObjectResizing",!1,!1);this.connect(d,"onkeyup","updateToolbar");this.connect(d,"onmouseup","updateToolbar");e.isIE?this.connect(d,"onkeydown","ieKeyDown"):
e.isMoz?(this.connect(d,"onkeypress","geckoKeyPress"),this.connect(d,"onkeydown",function(a){a.stopPropagation()}),this.connect(d,"onkeyup",function(a){a.stopPropagation()})):e.isWebKit&&this.connect(d,"onkeydown","webkitKeyPress");this.connect(d,"onclick",function(a){e.publish("WSEditor/BodyClick",[{event:a}])});this.connect(d,"ondblclick",function(a){e.publish("WSEditor/BodyDblClick",[{event:a}])});Config.DragDropPictureAttach&&(this.connect(d,"ondragenter",function(a){ws.html.dragEvtContainsFiles(a)&&
(this.WSEditor_ondragenter(a),a.preventDefault(),a.stopPropagation())}),this.connect(d,"ondragover",function(a){ws.html.dragEvtContainsFiles(a)&&(this.WSEditor_ondragover(a),a.preventDefault(),a.stopPropagation())}));this.designModeEnabled=!0;this.reset(null,!1);b&&b()},WSEditor_ondragenter:function(a){},WSEditor_ondragover:function(a){},isEmpty:function(){if(e.isWebKit)if(this.richMode){var a=this.editDiv().innerHTML;if(""==a||"\x3cspan\x3e\x26nbsp;\x3c/span\x3e"==a||"\x3cspan\x3e\x3c/span\x3e"==
a)return!0}else if(!e.trim(this.textarea.value))return!0;return!1},getEmptyHtml:function(){return e.isWebKit?"\x3cspan\x3e\x3c/span\x3e":""},openAttachFileDialog:function(){},enableRichText:function(){},showPlainTextToolBar:function(){e.query("\x3e",this.toolbarPane).forEach(function(a){a.style.display="none"},this)},showRTEToolBar:function(){e.query("\x3e",this.toolbarPane).forEach(function(a){a.style.display=""},this)},toggleFormatToolBar:function(a){var b=!1;"boolean"===typeof a?this.toolbarPaneParent.domNode.style.display=
a?"":"none":ws.html.toggleShowing(this.toolbarPaneParent.domNode);b="none"!=this.toolbarPaneParent.domNode.style.display;this.contentEditDiv.style.borderTop=b?"none":"1px solid #cdcdcd";this.textareaPane.domNode.style.borderTop=b?"none":"1px solid #cdcdcd";return b},checkForFormattingBarOff:function(){this.onResized()},updateMode:function(){(this.richMode=this.useRichMode())?(this.textareaPane.hide(),this.showRTEToolBar(),9<=e.isIE&&(this.contentEditDivPane.domNode.style.overflow="hidden"),this.contentEditDivPane.show()):
(this.textareaPane.show(),this.showPlainTextToolBar(),this.contentEditDivPane.hide());this.toolbarPaneParent.domNode.style.height="26px";this.checkForFormattingBarOff()},useRichMode:function(){return this.doForceRichMode?!0:Settings.UseRichEditor?!0:!1},getBlankLine:function(){this.blankLine||(this.blankLine=e.isMoz?"\x3cdiv\x3e \x3cbr\x3e\x3c/div\x3e":10==e.isIE?"\x3cdiv class\x3d'aOL-ws_iE10-nL'\x3e\x3c/div\x3e":"\x3cbr\x3e");return this.useRichMode()?this.blankLine:"\x3cbr\x3e"},adviceRichContentSet:function(){},
preRichContentGet:function(){},postRichContentGet:function(){},adviceIEContentChange:function(){},getRichContent:function(){this.preRichContentGet();var a="";if(10==e.isIE&&this.editDiv()){var b=e.query(".aOL-ws_iE10-nL",this.editDiv());if(b)for(var c=0;c<b.length;c++){var d=b[c];""==d.innerHTML&&(d.innerHTML="\x26nbsp;");e.removeClass(d,"aOL-ws_iE10-nL")}}if(e.isIE&&Config&&Config.IESanitizeTagsForSend&&0<Config.IESanitizeTagsForSend.length){var g=this.editDiv();if(g){var a=g.innerHTML,h=/([^"'\s>]+)\=(('[^']*')|("[^"]*")|([^"'\s>]+))/g,
b=Config.IESanitizeTagsForSend.split(","),r=[];e.forEach(b,function(a){r=r.concat(e.query(a,g))});e.forEach(r,function(b){var c=b.outerHTML.toLowerCase(),d=c.indexOf("\x3c"+b.nodeName.toLowerCase());if(0<=d&&(c=c.indexOf("\x3e"),0<=c&&c>d)){for(var d=b=b.outerHTML.slice(d,c+1),c=null,f=0;null!=(c=h.exec(b));)if(5<=c.length&&c[2]&&0<c[2].length&&"'"!=c[2].charAt(0)&&'"'!=c[2].charAt(0)){var e=c.index+c[1].length+1+f,d=d.slice(0,e)+'"'+d.slice(e);f++;e+=c[2].length+1;d=d.slice(0,e)+'"'+d.slice(e);f++}d!=
b&&(c=a.indexOf(b),0<=c&&(a=a.slice(0,c)+d+a.slice(c+b.length)))}})}}else a=this.editDiv().innerHTML;b="12pt";c="arial";d="black";if("number"==typeof Settings.ComposeFontSize){var p=Settings.ComposeFontSize;1<=p&&7>=p&&(b=ws.widget.fontSizePicker[p-1].pointSz)}"undefined"!=typeof Settings.ComposeFont&&(c=Settings.ComposeFont,c=ws.string.quoteFix(c));"undefined"!=typeof Settings.ComposeColor&&(d=Settings.ComposeColor);b=ws.widget.fontSizePicker[p-1].pointSz;a='\x3cdiv style\x3d"color:'+d+";font: "+
b+" "+c+';"\x3e'+a+"\x3c/div\x3e";a=a.replace(/<p /gi,"\x3cdiv ").replace(/<p>/gi,"\x3cdiv\x3e").replace(/<\/p>/gi,"\x3c/div\x3e");this.addNewLinesToRichContent&&(a=a.replace(/<div/gi,"\n\x3cdiv").replace(/<\/div>/gi,"\x3c/div\x3e\n").replace(/<br>/gi,"\x3cbr\x3e\n"));e.isIE&&(a=a.replace(/alt=">:O"/gi,'alt\x3d"\x26gt;:O"'));this.postRichContentGet();return a},getPlainContent:function(a){if(this.richMode){a||(a=!1);var b=(this.isStationeryMode?this.getFunmail().stationeryEditDiv():null)||this.editDiv();
(a=ws.html.renderedTextContent(b,a))&&0<a.length&&(a=a.replace(/\u00a0/g," "));return a}return this.textarea.value},getStationeryContent:function(){if(this.isStationeryMode){var a=this.getFunmail().stationeryEditDiv();if(a)return a.innerHTML}return this.getContent()},getContent:function(){return this.richMode?this.getRichContent():this.getPlainContent()},processBeforeSend:function(){return!1},boldClick:function(a){a.preventDefault();e.isIE&&this.ieRangeFix();this.command("bold")},italicClick:function(a){a.preventDefault();
e.isIE&&this.ieRangeFix();this.command("italic")},underlineClick:function(a){a.preventDefault();e.isIE&&this.ieRangeFix();this.command("underline")},horizontalRuleClick:function(a){a.preventDefault();e.isIE?(this.ieRangeFix(),this.insertHTML("\x3chr/\x3e")):this.command("inserthorizontalrule")},fontColorClick:function(a){a.preventDefault();this.dlgColorPalette("forecolor")},backgroundColorClick:function(a){a.preventDefault();this.dlgColorPalette("hilitecolor")},smileyClick:function(a){a.preventDefault();
e.isIE&&this.ieRangeFix();this.dlgSmileyPalette()},linkClick:function(a){a.preventDefault();this.linkEditor=new B({callbackFunc:e.hitch(this,this.linkEditorDone)});this.linkEditor.startup();this.linkEditor.show(this,this.linkButton);ws.reporting.reportDLAction("Mail-ComposeMessage-HyperlinkLinkClicked")},linkEditorDone:function(a){a||this.setAuxDirty(!0);if(ws.browser.isIE11){this.moveSelectionToEditDiv();a=window.getSelection();var b;a.getRangeAt&&a.rangeCount&&(b=a.getRangeAt(0),b.collapse(!1),
a.removeAllRanges(),a.addRange(b))}this.updateToolbar();this.refocusAfterPopup()},command:function(a,b,c,d){d=this.win();try{this.focus(),e.isIE||d.document.execCommand("StyleWithCSS",!1,"fontsize"==a?!1:!0)}catch(E){}try{d.document.execCommand(a,!1,b)}catch(E){}c||(this.updateToolbar(),this.setAuxDirty(!0));return!0},changeFont:function(){this.fontPicker.menu&&this.fontPicker.menu.setChecked([this.fontPicker.currentIndex],!0);this.command("fontname",this.fontPicker.currentValue)},changeFontSize:function(){this.fontSizePicker.menu&&
this.fontSizePicker.menu.setChecked([this.fontSizePicker.currentIndex],!0);this.command("fontsize",this.fontSizePicker.currentValue)},changeJustify:function(){this.justifyPicker.menu.setChecked([this.justifyPicker.currentIndex],!0);this.command(this.justifyPicker.currentValue)},changeList:function(){this.listPicker.menu.setChecked([this.listPicker.currentIndex],!0);this.command(this.listPicker.currentValue)},changeIndent:function(){this.command(this.indentPicker.currentValue)},dlgSmileyPalette:function(){this.smileyPalette||
(this.smileyPalette=Config.UseNewEmojis?new D:new q,this._supportingWidgets.push(this.smileyPalette),this.smileyPalette.startup(),this.connect(this.smileyPalette,"onSmileyClicked","insertSmiley"));this.smileyPalette.isShowing()?ws.widget.popup.close(this.smileyPalette):(ws.widget.popup({popup:this.smileyPalette,around:this.smileyButton}),ws.reporting.reportDLAction("Mail-Compose-Emoticon"))},insertSmiley:function(a,b){ws.widget.popup.close(this.smileyPalette);var c=".gif"==Config.SmileyImageExt?19:
25;this.insertHTML("\x3cimg src\x3d'"+b+"' alt\x3d'"+a+"' title\x3d'"+a+"' height\x3d"+c+" width\x3d"+c+" style\x3d'vertical-align:text-bottom'\x3e")},dlgColorPalette:function(a){this.palette=this[a+"Palette"];this.palette||(this.palette=this[a+"Palette"]=new z({setPreventMouseDefault:!0}),this._supportingWidgets.push(this.palette),this.palette.startup(),this.connect(this.palette,"onPaletteClicked","setColor"));this.palette.isShowing()?ws.widget.popup.close(this.palette):(ws.widget.popup({popup:this.palette,
around:this[a+"Item"]}),this.currentCommand=a)},setColor:function(a){var b=this.currentCommand;if(e.isIE){if("hilitecolor"==b&&(b="backcolor"),this.lastSelIERange&&"Control"!=this.lastSelIEType){var c=this.lastSelIERange;c.select();this.command(b,a);c.collapse(!1);c.select()}}else this.command(b,a)},createStationeryBtn:function(){Config.HasLocalFileSystem&&1!==this.composeView&&!this.stationaryItem&&(this.stationaryItem=e.create("a",{title:Config.Strings.StationeryTooltip,id:"stationeryBtn",className:"stationeryIcon rttLabel"},
this.linkButton,"after"),e.create("div",{className:"rttIcon"},this.stationaryItem),e.create("span",{innerHTML:Config.Strings.Stationery,className:"rttLabel2"},this.stationaryItem),this.connect(this.stationaryItem,"onclick","onClickStationeryBtn"),this.subscribe("stationery/close","onClickStationeryBtn"),e.publish("WSEditor/StationeryBtnCreated",[]))},onClickStationeryBtn:function(a,b){this.loadServicePlugin({serviceId:"stationery",pluginId:"STATIONERY_AOL",apiMessage:"selectStationery",apiArgs:{name:b}})},
updateServiceBtn:function(a,b){},loadServicePlugin:function(a){if(a||a.pluginId)ws.WebSuite.SidePanel.showStationery()?e.addClass(this.stationaryItem,"activated"):e.removeClass(this.stationaryItem,"activated")},getFunmail:function(){this.funmail||(this.funmail=new p,this.funmail.setEditDiv(this.editDiv()));return this.funmail},handleFeaturesDraft:function(){this.convertPicturesInMail();this.handleStationeryDraft()},findStationeryDraftNode:function(){var a=function(a,b,c){for(var d=null,f=0;f<b.length;f++)if(f==
c&&(d=a),a&&a.tagName&&a.tagName.toUpperCase()==b[f])a=a.firstElementChild;else return null;return d},b=a(this.editDiv(),"DIV DIV DIV FONT TABLE TBODY TR TD TABLE".split(" "),3);b||(b=a(this.editDiv(),"DIV DIV FONT TABLE TBODY TR TD TABLE".split(" "),2));return b},handleStationeryDraft:function(){var a=this.findStationeryDraftNode();if(a)if(this.isStationeryMode=!0,a=a.innerHTML,this.fixEditorForStationery(),this.getFunmail().applyTemplate(a,!0))this.isStationeryMode=!1,this.fixEditorForStationery();
else{this.adviceRichContentSet();if(a=this.getFunmail().stationeryEditDiv())a.setAttribute("contentEditable","true"),this.stnryDivFocusConnect=this.connect(a,"onfocus","onFocusHandler");setTimeout(e.hitch(this,function(){this.updateToolbar(null,!0);this.focus();this.getFunmail().moveCursorToBodyRole()}),500)}},resetStationeryState:function(){this.isStationeryMode=!1;this.stationeryState=null},clearStationery:function(){var a=this.getStationeryContent();this.resetStationeryState();this.setContent(a,
null,!1,!1,"");this.focus();this.updateToolbar(null,!1);this.setAuxDirty(!0)},resetPlugins:function(a){if(this.richMode){var b=this.editDiv(),c;e.isFF||(this.focus(),b.scrollTop=0,b.scrollLeft=0,this.docObj.queryCommandState("bold")&&this.command("bold",null,!0),this.docObj.queryCommandState("italic")&&this.command("italic",null,!0),this.docObj.queryCommandState("underline")&&this.command("underline",null,!0),this.docObj.queryCommandState("justifyRight")?this.command("justifyRight",null,!0):this.docObj.queryCommandState("justifyCenter")&&
this.command("justifyCenter",null,!0),this.docObj.queryCommandState("insertOrderedList")?this.command("insertOrderedList",null,!0):this.docObj.queryCommandState("insertUnorderedList")&&this.command("insertUnorderedList",null,!0));if(a.ComposeFontSize)for(c=0;c<this.fontSizePicker.options.length;c++){if(this.fontSizePicker.options[c].value==a.ComposeFontSize){b.style.fontSize=this.fontSizePicker.options[c].pointSz;break}}else b.style.fontSize=this.fontSizePicker.options[0].pointSz;b.style.fontFamily=
a.ComposeFont?ws.string.quoteFix(a.ComposeFont):this.fontPicker.options[0].value;b.style.color=a.ComposeColor?a.ComposeColor:"rgb(0, 0, 0)"}},resetCursor:function(a){void 0==a&&(a=!1);if(this.richMode){var b=this.editDiv(),c=document.createRange(),d=window.getSelection();c.setStart(b,0);c.collapse(a);d.removeAllRanges();d.addRange(c)}else(b=this.textarea)&&"none"!=b.style.display&&(this.textarea.focus(),a?this.textarea.setSelectionRange(0,0):(a=b.value.length)?this.textarea.setSelectionRange(--a,
a):this.textarea.setSelectionRange(0,0))},reset:function(a,b){var c=a?a:Settings;this.richMode&&this.resetPlugins(c);b&&this.resetCursor(!0)},insertStationery:function(a){if(""==a.url)return this.clearStationery();var b={timeout:5E3,handleAs:"text",load:e.hitch(this,function(b){this._loadStationeryTemplate(b,a)}),error:function(a){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ExternalErr,"Err handler for XHR request Stationery Template",a)}};b.url=a.url;e.xhrGet(b)},_loadStationeryTemplate:function(a,
b){this.isStationeryMode=!0;this.stationeryState=b;this.stnryDivFocusConnect&&e.disconnect(this.stnryDivFocusConnect);this.fixEditorForStationery();if(this.getFunmail().applyTemplate(a))this.isStationeryMode=!1,this.fixEditorForStationery();else{var c=this.getFunmail().stationeryEditDiv();c&&(this.stnryDivFocusConnect=this.connect(c,"onfocus","onFocusHandler"));this.adviceRichContentSet();this.setAuxDirty(!0);ws.lang.setTimeout(this,"updateToolbar",500)}},fixEditorForStationery:function(){try{this.isStationeryMode?
(this.editDiv().style.padding="0",this.editDiv().setAttribute("contentEditable","false"),this.editDiv().setAttribute("unselectable","on")):(this.editDiv().style.padding=this.composeView?"10px":"15px",this.editDiv().setAttribute("contentEditable","true"),this.editDiv().setAttribute("unselectable","off"))}catch(f){}},insertHTML:function(a,b){b||this.moveSelectionToEditDiv();if(e.isIE||ws.browser.isIE11){var c=window.getSelection(),d;if(c.getRangeAt&&c.rangeCount){d=c.getRangeAt(0);d.deleteContents();
var f=document.createElement("div");f.innerHTML=a;for(var g=document.createDocumentFragment(),h,r;h=f.firstChild;)r=g.appendChild(h);d.insertNode(g);r&&(d=d.cloneRange(),d.setStartAfter(r),d.collapse(!0),c.removeAllRanges(),c.addRange(d))}}else document.execCommand("insertHTML",!1,a);this.setAuxDirty(!0);this.updateToolbar(null,!0,!0);this.refocusAfterPopup()},refocusAfterPopup:function(){ws.lang.setTimeout(e.hitch(this,function(){this.focus()}),100)},win:function(){return window},editDiv:function(){return this.contentEditDiv},
editNodeForMode:function(){return this.richMode?this.contentEditDiv:this.textarea},getViewWidget:function(){return this.layoutWidget?this.layoutWidget:this.paneWidget},doc:function(){return this.editDiv()},ieRangeFix:function(){var a=window.getSelection();if(a&&a.getRangeAt&&0<a.rangeCount){var b=a.getRangeAt(0);a.removeAllRanges();a.addRange(b)}},isDescendant:function(a,b){for(var c=b;c;){if(c==a)return!0;c=c.parentNode}return!1},editDivEvtSelSaveIE:function(){var a=this.getRange();a&&(this.lastSelRange=
a);this.ieEditorBookmark=null;var a=document.selection,b=a.createRange();"Control"==a.type?this.lastSelIENode=b.item(0):this.ieEditorBookmark=b.getBookmark();this.lastSelIEType=a.type;this.lastSelIERange=b;e.isIE&&this.adviceIEContentChange()},lostFocusSelSave:function(){var a=this.getRange();a&&a.commonAncestorContainer&&this.isDescendant(this.editDiv(),a.commonAncestorContainer)&&(this.lastSelRange=a)},focus:function(){if(this.richMode)if(e.isSafari&&this.moveSelectionToEditDiv(),this.isStationeryMode){var a=
this.getFunmail().stationeryEditDiv();a&&a.focus()}else this.editDiv().focus();else this.textarea.focus()},onFocusHandler:function(){},getRange:function(){var a=null,b=null;(b=window.getSelection())&&b.getRangeAt&&0<b.rangeCount&&(a=b.getRangeAt(0));return a},getSelection:function(){return window.getSelection()},getEditorFirstChild:function(a){var b=null;return b=a.firstChild?a.firstChild:e.create("span",null,a)},moveSelectionToEditDiv:function(){var a=null,b=this.isStationeryMode?this.getFunmail().stationeryEditDiv():
this.editDiv();(a=this.lastSelRange)&&a.commonAncestorContainer&&this.isDescendant(b,a.commonAncestorContainer)?(b=window.getSelection(),b.removeAllRanges(),b.addRange(a)):(a=document.createRange())&&b&&(b=this.getEditorFirstChild(b),b.focus(),e.isIE&&this.editDivEvtSelSaveIE(),a.selectNode(b),a.collapse(!0),b=window.getSelection(),b.removeAllRanges(),b.addRange(a))},ieKeyDown:function(){var a=this.win().event;a.cancelBubble=!0;var b=!1;if(8==a.keyCode){var c=document.selection;c&&"Control"==c.type&&
((b=c.createRange().item(0))&&b.parentNode&&b.parentNode.removeChild(b),b=!0)}if(a.ctrlKey&&13==a.keyCode)this.sendMessage(),b=!0;else if(a.altKey&&187==a.keyCode)this.spellCheck(),b=!0;else if(a.altKey)switch(String.fromCharCode(a.keyCode).toLowerCase()){case Config.Strings.KeyComposeClose:this.cancel(),b=!0}else if(a.ctrlKey&&65<=a.keyCode&&90>=a.keyCode)switch(String.fromCharCode(a.keyCode).toLowerCase()){case Config.Strings.KeyComposeBold:this.command("bold",null);b=!0;break;case Config.Strings.KeyComposeItalic:this.command("italic",
null);b=!0;break;case Config.Strings.KeyComposeUnderline:this.command("underline",null),b=!0}else a.shiftKey||a.keyCode!==e.keys.TAB||(this.insertTab(),b=!0);if(b)return a.returnValue=!1},webkitKeyPress:function(a){a.stopPropagation();var b=!1,c=ws.html.fixKeyCodeForMac(a);a.ctrlKey?c==e.keys.ENTER&&(this.sendMessage(),b=!0):a.altKey?187==c?(this.spellCheck(),b=!0):88==c&&(this.cancel(),b=!0):a.shiftKey||a.keyCode!==e.keys.TAB||(this.insertTab(),b=!0);b&&e.stopEvent(a)},geckoKeyPress:function(a){var b=
!1;if(a.ctrlKey){switch(String.fromCharCode(a.charCode).toLowerCase()){case Config.Strings.KeyComposeBold:this.command("bold",null);b=!0;break;case Config.Strings.KeyComposeItalic:this.command("italic",null);b=!0;break;case Config.Strings.KeyComposeUnderline:this.command("underline",null),b=!0}if(13==a.keyCode||77==a.keyCode&&e.isMac)this.sendMessage(),b=!0}else if(a.altKey)switch(a.keyChar.toLowerCase()){case Config.Strings.KeyComposeClose:this.cancel();b=!0;break;case "\x3d":this.spellCheck(),b=
!0}else a.shiftKey||a.keyCode!==e.keys.TAB||(this.insertTab(),b=!0);b&&a.preventDefault();a.stopPropagation()},insertTab:function(){this.insertHTML(e.isIE?"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;":e.isFF?"\x26nbsp;\x26nbsp; \x26nbsp;":" \x26nbsp; \x26nbsp;",!0)},cancel:function(){},sendMessage:function(){},updateToolbar:function(a,b){var c=!1;a&&"mouseup"==a.type&&(c=!0);var d=ws.WebSuite.SidePanel;this.stationaryItem&&d&&(d.isSelectedPanel(d.stationery)?e.addClass(this.stationaryItem,"activated"):e.removeClass(this.stationaryItem,
"activated"));this.updateToolbarTimeout&&clearTimeout(this.updateToolbarTimeout);b?this._updateToolbar(c):this.updateToolbarTimeout=ws.lang.setTimeout(e.hitch(this,"_updateToolbar",c),300)},compareFontFamilyStr:function(a,b){var c=ws.string.quoteFix(a.toLowerCase()).split(","),d=ws.string.quoteFix(b.toLowerCase()).split(","),f=e.trim(c[0]),g=e.trim(d[0]);return f==g||"arial"==f&&d[1]&&e.trim(d[1])==f&&"helvetica"==g&&c[1]&&e.trim(c[1])==g||"helvetica"==f&&d[1]&&e.trim(d[1])==f&&"arial"==g&&c[1]&&
e.trim(c[1])==g?!0:!1},_updateToolbar:function(a){try{this.editDiv();var b=!0,c,d=null;if(e.isIE){if(c=this.docObj.selection)var f=c.createRange(),d="Control"==c.type?"":f.text}else(c=this.win().getSelection())&&(d=c.toString());null!=d&&""!=d&&(b=!1);var g=this.docObj.queryCommandValue("fontname");c=!1;d=0;if(g)for(var h=0;h<this.fontPicker.options.length;h++)this.fontPicker.options[h].checked=!1,!c&&this.compareFontFamilyStr(this.fontPicker.options[h].value,g)&&(d=h,c=!0);if(!c){if("undefined"!=
typeof Settings.ComposeFont)for(h=0;h<this.fontPicker.options.length;h++)if(this.compareFontFamilyStr(this.fontPicker.options[h].value,Settings.ComposeFont)){d=h;break}this.addDefaultFontStyles&&b&&this.command("fontname",this.fontPicker.options[d].value,!0,a)}this.fontPicker.setOption(d);this.fontPicker.menu?this.fontPicker.menu.setChecked([d],!0):(this.fontPicker.options[0].checked=!1,this.fontPicker.options[d].checked=!0);var r=this.docObj.queryCommandValue("fontsize");c=!1;var p=this.isStationeryMode?
2:1;if(null!=r&&""!=r)for(h=0;h<this.fontSizePicker.options.length;h++){this.fontSizePicker.options[h].checked=!1;var k=this.fontSizePicker.options[h].value;c||r!=k||(p=h,c=!0)}if(!c&&"undefined"!=typeof Settings.ComposeFontSize)for(h=0;h<this.fontSizePicker.options.length;h++)if(this.fontSizePicker.options[h].value==Settings.ComposeFontSize){p=h;break}this.fontSizePicker.setOption(p);!c&&this.addDefaultFontStyles&&b&&this.command("fontsize",this.fontSizePicker.currentValue,!0,a);this.fontSizePicker.menu?
this.fontSizePicker.menu.setChecked([p],!0):(this.fontSizePicker.options[1].checked=!1,this.fontSizePicker.options[p].checked=!0);a=["justifyleft","justifycenter","justifyright"];this.justifyPicker.menu&&this.justifyPicker.menu.setUnchecked();for(h=0;h<a.length;h++)if(this.docObj.queryCommandState(a[h])){this.justifyPicker.menu&&this.justifyPicker.menu.setChecked([h],!0);this.justifyPicker.domNode.className="wsSelect "+a[h]+"Icon";break}else this.justifyPicker.menu&&this.justifyPicker.menu.setChecked([0],
!0),this.justifyPicker.domNode.className="wsSelect justifyleftIcon";e.toggleClass(this.justifyPicker.domNode,"activated",!0);h=["bold","italic","underline"];for(a=0;a<h.length;a++){var l=this[h[a]+"Item"],m=this.docObj.queryCommandState(h[a]);e.toggleClass(l,"activated",m)}l=["insertorderedlist","insertunorderedlist"];this.listPicker.menu&&this.listPicker.menu.setUnchecked();for(m=0;m<l.length;m++)if(this.docObj.queryCommandState(l[m])){this.listPicker.menu&&this.listPicker.menu.setChecked([m],!0);
this.listPicker.domNode.className="wsSelect "+l[m]+"Icon";e.toggleClass(this.listPicker.domNode,"activated",!0);break}else e.toggleClass(this.listPicker.domNode,"activated",!1)}catch(L){}},sizeTextAreaToContent:function(a){if(!this.richMode){var b=this.textarea;b.style.height="1px";a&&b.blur();var c=function(){b.style.height=25+b.scrollHeight+"px";a&&b.focus()},d=window.requestAnimationFrame||window.msRequestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;!a&&d?
d(c):c()}},onResized:function(){this.inherited(arguments);if(this.stationaryItem&&this.richMode)if(1==ws.WebSuite.widthMode)e.style(this.stationaryItem,"display","none");else{e.style(this.stationaryItem,"display","");var a=e.marginBox(this.toolbarPaneParent.domNode).w,b=e.marginBox(this.toolbarPane).w;this.stationaryLabelNode=this.stationaryLabelNode||e.query(".rttLabel2",this.stationaryItem)[0];this.stationeryButtonWidth=this.stationeryButtonWidth||e.marginBox(this.stationaryItem).w;"none"!=this.stationaryLabelNode.style.display?
5>=a-b&&(this.stationaryLabelNode.style.display="none",e.replaceClass(this.stationaryItem,"rttLabelOff","rttLabel")):5<a-(b-32+this.stationeryButtonWidth)&&(e.replaceClass(this.stationaryItem,"rttLabel","rttLabelOff"),this.stationaryLabelNode.style.display="")}this.richMode||(b=e.marginBox(this.textarea.parentNode),a=b.w-(e.isFF?18:28),b=b.h-15,e.isFF&&(b-=10),e.style(this.textarea,{width:(0>=a?0:a)+"px",height:(0>=b?0:b)+"px",margin:"0",padding:"15px 10px",overflow:"auto",fontFamily:"Helvetica,Arial,sans-serif"}))}})})},
"ws/mail/funmail":function(){define("ws/mail/funmail",["dojo/_base/declare"],function(v){return v(null,{_editDiv:null,funEditDiv:null,hasFunBodyAttr:!1,setEditDiv:function(l){this._editDiv=l},removeObsoleteRoleIds:function(l){var m=["role_body","role_ornament","role_layout"];if(l&&l.id)for(var d=0;d<m.length;d++){var e=l.id.toLowerCase();if(ws.string.endsWith(e,m[d]))return l.id="",l.removeAttribute&&l.removeAttribute("id"),0==d?!0:!1}return!1},processTemplate:function(l){if(l){if(l.getAttribute&&
l.setAttribute&&l.removeAttribute){var m=l.getAttribute("data-info");m&&"aolWsStatBody"==m&&(this.hasFunBodyAttr=!0,this.funEditDiv||(this.funEditDiv=l));(m=l.getAttribute("comp_role"))&&l.removeAttribute("comp_role");"body"==m&&(this.hasFunBodyAttr||(this.hasFunBodyAttr=!0,l.setAttribute("data-info","aolWsStatBody")),this.funEditDiv||(this.funEditDiv=l));!this.removeObsoleteRoleIds(l)||this.funEditDiv||this.hasFunBodyAttr||(this.hasFunBodyAttr||(this.hasFunBodyAttr=!0,l.setAttribute("data-info",
"aolWsStatBody")),this.funEditDiv||(this.funEditDiv=l))}for(m=0;m<l.childNodes.length;m++){var d=l.childNodes[m];d&&this.processTemplate(d)}}},applyTemplate:function(l,m){var d="";m||(this.funEditDiv&&"string"==typeof this.funEditDiv.innerHTML?d=this.funEditDiv.innerHTML:this._editDiv&&"string"==typeof this._editDiv.innerHTML&&(d=this._editDiv.innerHTML));l&&(l=l.replace(/(\r|\n)/g,""),l=l.replace(/.*<body[^>]*>/i,""),l=l.replace(/<\/body>.*/i,""),this._editDiv.innerHTML=l);this._editDiv.setAttribute("contentEditable",
"false");this._editDiv.setAttribute("unselectable","on");this.funEditDiv=null;this.hasFunBodyAttr=!1;this.processTemplate(this._editDiv);dojo.query("div",this._editDiv).forEach(function(d){d.style.outline="none"});if(!this.funEditDiv)return!0;d&&(this.funEditDiv.innerHTML=d);d=dojo.isIE?400:0;ws.lang.setTimeout(dojo.hitch(this,function(){this.moveCursorToBodyRole();dojo.isIE&&(this._editDiv.scrollTop=0)}),d);return!1},stationeryEditDiv:function(){return this.funEditDiv},moveCursorToBodyRole:function(){var l=
this.stationeryEditDiv(),m;if(l)if("undefined"!=typeof window&&window.getSelection){l.focus();var d=window.getSelection();m=document.createRange();m.setStart(l,0);m.collapse(!0);d.removeAllRanges();d.addRange(m);d.collapseToStart()}else{document.selection.empty();m=document.selection.createRange();m.selectNodeContents(l);m.collapse(!0);try{l.focus()}catch(e){}}},isWhitespace:function(l){return 0==l.search(/^(\s|\xA0)*$/)},innerText:function(l){return"undefined"!=typeof l.innerHTML?l.innerHTML:null},
finalizeTemplate:function(l){l||(l=this._editDiv);if(l){if(l.getAttribute&&l.removeAttribute){l.getAttribute("comp_role")&&l.removeAttribute("comp_role");var m=l.getAttribute("data-info");m&&"aolWsStatBody"==m&&l.removeAttribute("data-info")}this.removeObsoleteRoleIds(l);for(m=0;m<l.childNodes.length;m++){var d=l.childNodes[m];d&&this.finalizeTemplate(d)}}}})})},"ws/widget/ColorPalette":function(){define("ws/widget/ColorPalette",["dojo/_base/declare","dojo","dijit","dijit/_Widget","dijit/_TemplatedMixin"],
function(v,l,m,d,e){return v([d,e],{templateString:"\x3cdiv class\x3d'wsMenu' style\x3d'width:206px;height:130px;overflow:hidden;background: #fff url(${baseimages}common/colors7x10.png)!important;cursor:pointer;display:none' data-dojo-attach-event\x3d'onclick:onClick'\x3e\x3c/div\x3e",colorNames:["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgrey pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),
"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],
startup:function(){this.inherited(arguments);if(this.setPreventMouseDefault){var d=function(d){d&&d.preventDefault&&d.preventDefault()};this.connect(this.domNode,"onclick",d);this.connect(this.domNode,"onmousedown",d);this.connect(this.domNode,"onmouseup",d)}},onClick:function(d){var e=l.position(this.domNode),b=Math.floor((d.pageY-e.y)/this.colorHeight);d=Math.floor((d.pageX-e.x)/this.colorWidth);6<b&&(b=6);9<d&&(d=9);this.onPaletteClicked(this.colorNames[b][d]);ws.widget.popup.close(this)},colorHeight:20,
colorWidth:20,onPaletteClicked:function(d){}})})},"ws/widget/LinkEditor":function(){define("ws/widget/LinkEditor","dojo/_base/declare dojo/text!ws/widget/LinkEditor.html dojo dijit dijit/_Widget dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ws/widget/popup ws/widget/Button ws/browser".split(" "),function(v,l,m,d,e,h,t){return v([e,h,t],{templateString:l,_earlyTemplatedStartup:!0,callbackFunc:null,startup:function(){m.toggleClass(this.linkText.textbox,"wsInputDefault",!1);this.linkText.textbox.style.paddingLeft=
"2px";this.linkText._updateClass=function(){};this.linkText._onFocus=function(){};m.toggleClass(this.link.textbox,"wsInputDefault",!1);this.link.textbox.style.paddingLeft="2px";this.link._updateClass=function(){};this.link._onFocus=function(){}},show:function(b,c){this.destroyOnClose=!0;this.editor=b;this.editorDoc=window.document;this.editor.moveSelectionToEditDiv();this.selection=m.isIE?this.editorDoc.selection:this.editor.getSelection();this.range=this.createRange();this.schemes=m.query('[name\x3d"scheme"]',
this.domNode);this.schemes.every(m.hitch(this,function(b){m.connect(b,"onclick",m.hitch(this,"schemeChosen"));return!0}));this.url=this.email="";var d=null,d=m.isIE?"Control"==this.selection.type?"":this.range.text:this.range.toString();this.linkText.textbox.value=d;this.currentScheme=0;var e=this.findAnchorNode();e&&(this.link.textbox.value=e.href,e.href.match(/mailto:/i)&&this.schemes&&(this.schemes[1].checked=!0,this.currentScheme=1),""==d&&(this.linkText.textbox.value=m.isIE?e.innerText:e.textContent));
ws.widget.popup({popup:this,around:c,padding:[0,0]});"fi-fi"!=Config.PageLocale&&"ru-ru"!=Config.PageLocale||m.query("br",this.domNode).style("display","block");d?this.link.textbox.focus():this.linkText.textbox.focus();this.link.connect(this.link,"onKeyPress",m.hitch(this,"keyPressed",e));this.okButton.connect(this.okButton.domNode,"ondijitclick",m.hitch(this,"createOrCancelLink",e,1));m.publish("popup/open",[])},schemeChosen:function(b){this.schemes[0].checked?1==this.currentScheme&&(this.currentScheme=
0,this.email=this.link.textbox.value,this.link.textbox.value="",this.link.textbox.value=this.url):0==this.currentScheme&&(this.currentScheme=1,this.url=this.link.textbox.value,this.link.textbox.value="",this.link.textbox.value=this.email);this.link.textbox.focus()},keyPressed:function(b,c){13==c.keyCode&&this.createOrCancelLink(b,1)},onClose:function(){this.destroyRecursive()},close:function(b){ws.widget.popup.close(this);this.callbackFunc&&this.callbackFunc(b)},handleCloseX:function(){m.isIE&&this.range&&
this.range.select();this.close(!0)},createOrCancelLink:function(b,c){switch(c){case 1:var d=this.link.textbox.value;if(""==d){this.createOrCancelLink(b,2);this.close();break}!this.schemes||this.schemes[0].checked?d.match(/^https*:/i)||(d="http://"+d):d.match(/^mailto:/i)||(d="mailto:"+d);b&&(b.href=d);var e=this.linkText.textbox.value;""==e&&"Control"!=this.selection.type&&(e=d,e.match(/^mailto:/)&&(e=e.replace(/^mailto:/,"")));if(m.isIE){if("Control"==this.editor.lastSelIEType)this.range.execCommand("createlink",
!1,d);else if(""!=e){var h=ws.string.escapeXml(e);this.range.text==e?this.range.execCommand("createlink",!1,d):this.range.text?b?b.innerText=e:(this.range.text=h,this.range.moveStart("character",-h.length),this.range.select(),this.range.execCommand("createlink",!1,d),this.range.collapse(!1),this.range.select()):(this.editor.lastSelIERange||(this.editor.ieEditorBookmark?(this.range=this.editor.body.createTextRange(),this.range.moveToBookmark(this.editor.ieEditorBookmark)):(this.editor.focus(),this.range=
this.editorDoc.selection.createRange())),this.range.text=h,this.range.moveStart("character",-h.length),this.range.select(),this.range.execCommand("createlink",!1,d))}"Control"!=this.editor.lastSelIEType&&(this.range.collapse(!1),this.range.select())}else ws.browser.isIE11?b?b.innerText=e:this.editor.insertHTML("\x3ca href\x3d'"+d+"'\x3e"+ws.string.escapeXml(e)+"\x3c/a\x3e"):(e==this.range.toString()?b||(this.editor.moveSelectionToEditDiv(),this.editorDoc.execCommand("createlink",!1,d),this.selection.collapseToEnd()):
b?b.innerText=e:(b=document.createElement("a"),b.href=d,this.range.deleteContents(),d=this.editorDoc.createTextNode(e),b.appendChild(d),this.range.insertNode(b)),b&&this.selection.selectAllChildren(b),this.selection.collapseToEnd(),this.range.detach(),this.editorDoc.execCommand("unlink",!1,null));this.close();break;case 2:if(b)if(m.isIE)this.range.select(),this.editorDoc.execCommand("unlink"),this.editorDoc.execCommand("unselect"),"Control"!=this.selection.type&&(this.range.collapse(!1),this.range.select());
else try{d=b.childNodes.length;e=b.parentNode;for(h=0;h<d;h++)e.insertBefore(b.firstChild,b);e.removeChild(b)}catch(B){}}},createRange:function(){if(!this.selection)return null;var b;if(m.isIE)b=this.editor.lastSelIERange?this.editor.lastSelIERange:this.selection.createRange();else try{b=this.selection.getRangeAt(0)}catch(c){b=this.editorDoc.createRange()}return b},findAnchorNode:function(){var b=null;if(m.isIE)if("None"==this.editor.lastSelIEType){if(b=this.detectAnchorAtPoint())this.range.moveToElementText(b),
this.range.select()}else if("Control"==this.editor.lastSelIEType)b=this.editor.lastSelIENode.parentNode,b.href||(b=null);else{if("Text"==this.editor.lastSelIEType){var c=this.range.htmlText.match(/href="(.+?)"/i);c&&1<c.length&&this.range.findText(this.range.text,0,0);this.range.collapse(!0);b=this.detectAnchorAtPoint();b||(this.range=this.selection.createRange(),this.range.collapse(!1),b=this.detectAnchorAtPoint());this.range=this.selection.createRange()}}else{var c=this.editorDoc.body,d=this.range.startContainer;
do if("a"==d.nodeName.toLowerCase()){b=d;break}while(d!=c&&(d=d.parentNode));if(!b&&!this.range.collapsed){d=this.range.endContainer;do if("a"==d.nodeName.toLowerCase()){b=d;break}while(d!=c&&(d=d.parentNode))}if(ws.browser.isIE11)return b;!b&&!this.range.collapsed&&0<this.range.commonAncestorContainer.childNodes.length&&m.query("a",this.range.commonAncestorContainer).every(m.hitch(this,function(c,d,e){return this.selection.containsNode(c,!0)?(b=c,!1):!0}))}return b},detectAnchorAtPoint:function(){var b=
null;this.range.pasteHTML('\x3cspan id\x3d"le:tmp.id"\x3e\x3c/span\x3e');var c=m.byId("le:tmp.id",this.editorDoc);if(c)for(b=c.parentNode,c.parentNode.removeChild(c);b&&"a"!=b.tagName.toLowerCase();)b="body"==b.tagName.toLowerCase()?null:b.parentNode;return b}})})},"ws/widget/SmileyPalette":function(){define("ws/widget/SmileyPalette",["dojo/_base/declare","dojo","dijit","dijit/_Widget","dijit/_TemplatedMixin"],function(v,l,m,d,e){return v([d,e],{templateString:"\x3cdiv class\x3d'wsMenu' style\x3d'width:103px;height:89px;overflow:hidden;background: #fff url("+
Config.EmojiSpriteURL+")!important;cursor:pointer;display:none' data-dojo-attach-event\x3d'onmousedown:onClick'\x3e\x3c/div\x3e",imageNames:[["smile","wink","kiss","bigkiss"],["cry","frown","indecision","shame"],["grin","greed","shock","yell"],["cool","foot","halo","tongue"]],altTexts:[[":-)",";-)",":-*",":-X"],[":'(",":-(",":-\\",":-["],[":-D",":-$","\x3d-O","\x3e:O"],["8-)",":-!","O:-)",":-P"]],startup:function(){this.inherited(arguments);var d=function(d){d&&d.preventDefault&&d.preventDefault()};
this.connect(this.domNode,"onclick",d);this.connect(this.domNode,"onmousedown",d);this.connect(this.domNode,"onmouseup",d)},onClick:function(d){var e=l.position(this.domNode),b=Math.floor((d.pageY-e.y)/this.smileyHeight),c=Math.floor((d.pageX-e.x)/this.smileyWidth);3<b&&(b=3);3<c&&(c=3);e=this.altTexts[b][c];b=this.imageNames[b][c];c=Config.EmojiBasePath+b+Config.SmileyImageExt;l.stopEvent(d);this.onSmileyClicked(e,c);ws.reporting.reportDLAction("Mail-Emoticon-"+b)},smileyHeight:25,smileyWidth:25,
onSmileyClicked:function(d,e){}})})},"ws/widget/EmojiPicker":function(){define("ws/widget/EmojiPicker",["dojo/_base/declare","dojo","dijit","dijit/_Widget","dijit/_TemplatedMixin"],function(v,l,m,d,e){return v([d,e],{templateString:"\x3cdiv class\x3d'wsMenu emojiMenu' style\x3d'background: #fff url("+Config.EmojiSpriteURL+")!important;display:none' data-dojo-attach-event\x3d'onmousedown:onClick'\x3e\x3c/div\x3e",imageNames:["blush smile wink stuckouttonguewinkingeye relaxed relieved grin laughing joy smilingfacewithhorns".split(" "),
"smilingfacewithhalo stuckouttongueclosedeyes hearteyes kissingheart kissingclosedeyes huggingface yum sunglasses facewithrollingeyes moneymouthface".split(" "),"zippermouthface expressionless sleeping confused thinkingface mask sweat disappointedrelieved flushed angryfacewithhorns".split(" "),"unamused disappointed smirk weary sleepy sob nauseastedface okhand thumbsup crossedfingers".split(" "),"raisedhands V pray hand clap facepunch wave thumbsdown smilingcatfacewithopenmouth grinningcatfacewithsmilingeyes".split(" "),
"catfacewithtearsofjoy smilingcatfacewithhearteyes catfacewithwrysmile kissingcatfacewithclosedeyes wearycatface cryingcatface dogface seenoevil speaknoevil hearnoevil".split(" "),"heart twohearts sunny sparklingheart rose tada notes eyes 100 heavycheckmark".split(" "),"raisinghand womanfacepalming manfacepalming birthdaycake cookie meat clinkingbeermugs tropicaldrink skull fire".split(" ")],startup:function(){this.inherited(arguments);var d=function(b){b&&b.preventDefault&&b.preventDefault()};this.connect(this.domNode,
"onclick",d);this.connect(this.domNode,"onmousedown",d);this.connect(this.domNode,"onmouseup",d);for(var d="\x3cdiv class\x3d'emojiGrid'\x3e",e=1;80>=e;e++)d+="\x3cspan title\x3d'"+Config.Strings["Emoji_"+e]+"'\x3e\x3c/span\x3e";this.domNode.innerHTML+=d+"\x3c/div\x3e"},onClick:function(d){var e=l.position(this.domNode),b=Math.floor((d.pageY-e.y)/this.smileyHeight),c=Math.floor((d.pageX-e.x)/this.smileyWidth);7<b&&(b=7);9<c&&(c=9);e=Config.Strings["Emoji_"+(10*b+c+1)];b=this.imageNames[b][c];c=Config.EmojiBasePath+
b+".png";l.stopEvent(d);this.onSmileyClicked(e,c);ws.reporting.reportDLAction("Mail-Emoticon-"+b)},smileyHeight:26,smileyWidth:26,onSmileyClicked:function(d,e){}})})},"ws/pictures/PictureEditControl":function(){define("ws/pictures/PictureEditControl","dojo/_base/declare dojo/text!ws/pictures/PictureEditControl.html dojo/text!ws/pictures/PictureEditControl.css dojo dijit dijit/_Widget dijit/_TemplatedMixin ws/widget/WSSelect ws/html ws/widget/util".split(" "),function(v,l,m,d,e,h,t,b){return v([h,
t],{templateString:l,css:{templateString:m},editor:null,hoveredImage:null,bkgndLayerNode:null,imageConnections:null,options:[{value:"small",display:Config.Strings.Compose_small,action:"size"},{value:"medium",display:Config.Strings.Compose_medium,action:"size"},{value:"large",display:Config.Strings.Compose_large,action:"size"},{isSeparator:!0},{value:"right",display:Config.Strings.Compose_alignRight,action:"align"},{value:"center",display:Config.Strings.Compose_alignCenter,action:"align"},{value:"left",
display:Config.Strings.Compose_alignLeft,action:"align"},{isSeparator:!0},{value:"none",display:Config.Strings.Compose_noWrap,action:"wrap"},{value:"right",display:Config.Strings.Compose_wrapRight,action:"wrap"},{value:"left",display:Config.Strings.Compose_wrapLeft,action:"wrap"}],startup:function(b,e){this.inherited(arguments);this.imageConnections={};this.createMenu();this.connect(this.optionsMenu.menu,"onMouseDown","setSelectedOption");this.handledImages=[];this.connect(this.deleteButton,"onclick",
d.hitch(this,"execCommand","remove"));var c=this.editor.editDiv();this.keyupConnectHnd=this.connect(c,"onkeyup","handleKeyLayoutEvent");this.mouseupConnectHnd=this.connect(c,"onmouseup","handleMouseLayoutEvent");this.scrollConnectHnd=this.connect(c,"onscroll","handleScrollLayoutEvent");this.editor.composeView&&(this.domNode.style.zIndex=602,this.bkgndLayerNode.style.zIndex=603,this.buttons.style.zIndex=604)},destroy:function(){try{this.disconnect(this.keyupConnectHnd)}catch(c){}try{this.disconnect(this.mouseupConnectHnd)}catch(c){}try{this.disconnect(this.scrollConnectHnd)}catch(c){}try{this.inherited(arguments)}catch(c){}},
closeControls:function(){this.closeMenu();this.domNode.style.display="none";this.bkgndLayerNode.style.display="none";this.hoveredImage=null},setSelectedOption:function(b){if(b.target&&(b=e.getEnclosingWidget(b.target),b.caption))for(var c in this.options)b.caption==this.options[c].display&&this.execCommand(this.options[c].action,this.options[c].value)},createMenu:function(){this.optionsMenu||(this.optionsMenu=new b({options:this.options}),this.optionsMenu.startup(),this.optionsMenu.getMenu())},openMenu:function(){this.optionsMenu.menu.open(this.optionsBtn)},
closeMenu:function(){this.optionsMenu.menu&&this.optionsMenu.menu.close()},removeEventHandlers:function(b,d){var c=this.imageConnections[b];c&&(d&&c[d]?this.disconnect(c[d]):(c.onmouseover&&this.disconnect(c.onmouseover),c.onmouseout&&this.disconnect(c.onmouseout),c.onload&&this.disconnect(c.onload),delete this.imageConnections[b]))},installEventHandlers:function(b){if(b){for(var c in this.imageConnections)this.removeEventHandlers(c);this.handledImages=[]}b=d.query("img",this.editor.editDiv());for(c=
0;c<b.length;c++)b[c].id&&-1!=b[c].id.indexOf("AOLP")&&this.editor.imageIdMap[b[c].id]&&-1==d.indexOf(this.handledImages,b[c])&&(this.imageConnections[b[c].id]=this.imageConnections[b[c].id]||{},this.imageConnections[b[c].id].onmouseover=this.connect(b[c],"onmouseover",d.hitch(this,"onMouseOverImage",b[c])),this.imageConnections[b[c].id].onmouseout=this.connect(b[c],"onmouseout",d.hitch(this,"onMouseOutImage",b[c])),this.imageConnections[b[c].id].onload=this.connect(b[c],"onload",d.hitch(this,"onImageLoaded",
b[c])),this.handledImages.push(b[c]));this.hoveredImage&&!this.hoveredImage.parentNode&&(this.domNode.style.display="none",this.bkgndLayerNode.style.display="none",this.hoveredImage=null)},onImageLoaded:function(b){if(b&&(this.removeEventHandlers(b.id,"onload"),this.bkgndLayerNode&&"none"!=d.style(this.bkgndLayerNode,"display")))this.onMouseOverImage(b)},onMouseOverImage:function(b,d){this.updateImageEditCtlLoc(b);this.hoveredImage=b},handleKeyLayoutEvent:function(){for(var b=0;b<this.handledImages.length;b++)if(this.handledImages[b]&&
!this.handledImages[b].parentNode){this.installEventHandlers(!0);break}this.hoveredImage&&this.updateImageEditCtlLoc(this.hoveredImage)},handleMouseLayoutEvent:function(){for(var b=0;b<this.handledImages.length;b++)if(this.handledImages[b]&&!this.handledImages[b].parentNode){this.installEventHandlers(!0);break}this.hoveredImage&&this.updateImageEditCtlLoc(this.hoveredImage)},handleScrollLayoutEvent:function(){this.hoveredImage&&this.updateImageEditCtlLoc(this.hoveredImage)},updateImageEditCtlLoc:function(b){b=
d.position(b);var c=b.w,e=d.position(this.editor.editDiv());b.x<e.x&&(c-=e.x-b.x,b.x=e.x);b.x+c>e.x+e.w&&(c=e.x+e.w-b.x);b.y<e.y&&(b.y=e.y);this.domNode.style.display="";e=b&&"number"==typeof b.x&&0<b.x?b.x:0;this.domNode.style.left=b.x+"px";e=b&&"number"==typeof b.y&&0<b.y?b.y:0;this.domNode.style.top=e+"px";e="number"==typeof c&&0<c?c:0;this.domNode.style.width=e+"px";this.bkgndLayerNode.style.width=e+"px";this.bkgndLayerNode.style.display="block";this.buttons.style.width=e+"px"},onMouseOutImage:function(b,
d){this.hoveredImage&&ws.html.overElement(this.hoveredImage,d)||this.closeControls()},onMouseOver:function(b){this.domNode.style.display=""},showMenu:function(){this.updateMenuState(this.hoveredImage);this.openMenu()},execCommand:function(b,d){this.bkgndLayerNode.style.display="none";this.domNode.style.display="none";var c=this.hoveredImage;switch(b){case "size":this.setSize(c,d);break;case "align":this.setAlign(c,d);break;case "wrap":this.setWrap(c,d);break;case "remove":this.removeImage(c)}},sizes:{small:Config.InsertedPictureLongestEdge,
medium:600,large:1200},setSize:function(b,d){var c=this.editor.imageIdMap[b.id];"small"==d?b.src=c.smallUrl:"medium"==d?b.src=c.mediumUrl:"large"==d&&(b.src=c.largeUrl);b.width=this.sizes[d];b.style.height="";b.style.width=""},setAlign:function(b,d){var c=this.envelopImage(b);c.align=d;ws.html.setFloat(c,"none")},setWrap:function(b,d){var c={left:"right",right:"left",none:"none"}[d],e=this.envelopImage(b);ws.html.setFloat(e,c);"none"==d&&(e.align="left")},removeImage:function(b){this.removeEventHandlers(b.id);
b.parentNode.removeChild(b);d.isMoz&&this.editor.insertHTML("\x3cspan\x3e\x3c/span\x3e");this.installEventHandlers();this.editor.removedInlineImage()},envelopImage:function(b){var c=this.getEnvelope(b);if(c)return c;c=document.createElement("div");c.className="envelope";var d=b.cloneNode(!1);c.appendChild(d);b.parentNode.replaceChild(c,b);this.installEventHandlers(!0);return c},getEnvelope:function(b){return(b=b.parentNode)&&"envelope"==b.className&&1==b.childNodes.length?b:null},updateMenuState:function(b){var c=
this.getEnvelope(b);b=d.contentBox(b);var e=c?c.align:"left",c=c?ws.html.getFloat(c):"none",h="left"!=c&&"right"!=c;b={sizesmall:b.w==this.sizes.small,sizemedium:b.w==this.sizes.medium,sizelarge:b.w==this.sizes.large,alignleft:h&&("left"==e||""==e),aligncenter:h&&"center"==e,alignright:h&&"right"==e,wrapright:"left"==c,wrapleft:"right"==c,wrapnone:h};this.optionsMenu.menu||this.createMenu();e=this.optionsMenu.menu.getChildren();for(c=0;c<e.length;c++)e[c].isSeparator||e[c].setChecked(b[this.options[c].action+
this.options[c].value])}})})},"ws/pictures/PictureViewControl":function(){define("ws/pictures/PictureViewControl",["dojo/_base/declare","dojo","ws/html","ws/io","ws/widget/util"],function(v,l){return v(null,{picturesModel:null,image:null,isAttachment:!1,folder:"",uid:"",constructor:function(m){l.mixin(this,m);l.query("*",this.domNode).forEach(function(d){var e=d.getAttribute("data-dojo-attach-point");e&&(this[e]=d)},this);ws.lang.setTimeout(this,"positionSelf",0);this.isAttachment=l.hasClass(this.image,
"AOLAttachedImage");Config.EnablePictures||(ws.html.setShowing(this.saveNode,!1),ws.html.setShowing(this.saveNodeSep,!1),ws.html.setShowing(this.savingNode,!1));this.positionSelf()},positionSelf:function(){if(this.domNode)try{l.withDoc(this.domNode.ownerDocument,l.hitch(this,function(){var m=l.position(this.image,!0),d=l.contentBox(this.image);this.domNode.style.left=m.x+"px";this.domNode.style.top=m.y+d.h+1+"px"}))}catch(m){}}})})},"url:ws/mail/DisplayMessageWidget.html":'\x3cdiv\x3e\n\t\x3cdiv data-dojo-type\x3d"ws/widget/Pane" class\x3d"displayMessage" data-dojo-attach-point\x3d"layoutWidget"\x3e\n\t\t\x3cdiv data-dojo-type\x3d"ws/widget/WSToolbar" data-dojo-attach-point\x3d"toolbar" viztype\x3d"Controls"\x3e\n\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: backToInbox" data-dojo-attach-point\x3d"backToMail" title\x3d"${BackToMail}" svgID\x3d"iconInbox" style\x3d"display: none"\x3e${BackToMail}\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: reportNotSpam" data-dojo-attach-point\x3d"notSpamButton" svgID\x3d"iconNotSpam" title\x3d"${NotSpamButton}" style\x3d"display:none"\x3e${NotSpamButton}\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: markUnread" data-dojo-attach-point\x3d"keepNewButton" svgID\x3d"iconNewMail" style\x3d"display:none" tip\x3d"${KeepAsNewActionLabel}"\x3e${KeepAsNewActionLabel}\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: reply, onMouseDown: saveSelection" svgID\x3d"iconReply" title\x3d"${DisplayReply} (${KeyMailReply})" tip\x3d"${DisplayReply} \x3cspan\x3e(${KeyMailReply})\x3c/span\x3e"\x3e${DisplayReply}\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: replyAll, onMouseDown: saveSelection" svgID\x3d"iconReplyAll" title\x3d"${DisplayReplyAll} (${KeyMailReplyAll})" tip\x3d"${DisplayReplyAll} \x3cspan\x3e(${KeyMailReplyAll})\x3c/span\x3e"\x3e${DisplayReplyAll}\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: forward, onMouseDown: saveSelection" svgID\x3d"iconForward" title\x3d"${DisplayForward} (${KeyMailForward})" tip\x3d"${DisplayForward} \x3cspan\x3e(${KeyMailForward})\x3c/span\x3e"\x3e${DisplayForward}\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: deleteMessage" svgID\x3d"iconTrash" title\x3d"${DeleteButton} (${DeleteKey})" tip\x3d"${DeleteButton} \x3cspan\x3e(${DeleteKey})\x3c/span\x3e"\x3e${DeleteButton}\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: restoreMessage" data-dojo-attach-point\x3d"restoreButton" svgID\x3d"iconRestore" style\x3d"display:none" title\x3d"${RestoreButton}"\x3e${RestoreButton}\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: reportSpam" data-dojo-attach-point\x3d"spamButton" svgID\x3d"iconSpam" tip\x3d"${ReportSpamTooltip}" title\x3d"${ReportSpamTooltip}" style\x3d"display:none"\x3e${ReportSpamButton}\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/DropDownButton" data-dojo-attach-point\x3d"actionButton" title\x3d"${ActionButtonTip}" tip\x3d"${ActionButtonTip}"\x3e${ActionButton}\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-props\x3d"toolbarPosition: \'right\'" data-dojo-type\x3d"ws/widget/Pane" style\x3d"white-space: nowrap"\x3e\n\t\t\t\t\x3cdiv class\x3d"invertBtn" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: nextMessage" data-dojo-attach-point\x3d"nextButtonNode" svgID\x3d"iconDown"\x3e\x3c/div\x3e\n\t\t\t\t\x3cdiv class\x3d"invertBtn" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: prevMessage" data-dojo-attach-point\x3d"prevButtonNode" svgID\x3d"iconUp"\x3e\x3c/div\x3e\n\t\t\t\t\x3cdiv class\x3d"invertBtn" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: backToList" data-dojo-attach-point\x3d"backButton" svgID\x3d"iconClose"\x3e\x3c/div\x3e\n\t\t\t\x3c/div\x3e\n\t\t\x3c/div\x3e\n\t\t\x3cdiv class\x3d"headerArea" data-dojo-attach-point\x3d"headerArea"\x3e\n\t\t\t\x3cdiv class\x3d"clrFlt"\x3e\n\t\t\t\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"infoStrips"\x3e\n\t\t\t\x3c/div\x3e\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"subjectContainer" class\x3d"subjectContainer"\x3e\n\t\t\t\t\x3ctable class\x3d"subjectLine"\x3e\x3ctbody\x3e\x3ctr\x3e\n\t\t\t\t\t\x3ctd class\x3d"subjectCol"\x3e\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"editDraft" style\x3d"display: none" class\x3d"wsLink editDraft" data-dojo-attach-event\x3d"onclick: openDraft"\x3e${EditDraft}\x3c/span\x3e\n\t\t\t\t\t\t\x3cspan class\x3d"subject" data-dojo-attach-point\x3d"subjectNode"\x3e\x3c/span\x3e\n\t\t\t\t\t\x3c/td\x3e\n\t\t\t\t\t\x3ctd class\x3d"iconCol"\x3e\x3cspan class\x3d"subjectIcons"\x3e\n\t\t\t\t\t\t\x3cspan data-dojo-attach-event\x3d"onclick: print,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point\x3d"printLink" class\x3d"headerIcon"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconPrint"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/span\x3e\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"addToLinksNode"\x3e\n\t\t\t\t\t\t\t\x3cspan data-dojo-attach-event\x3d"onclick: addToCalendar, onmousedown: saveSelection,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point\x3d"createEventLink" class\x3d"headerIcon"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconMonth"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/span\x3e\n\t\t\t\t\t\t\t\x3cspan data-dojo-attach-event\x3d"onclick: addToTask, onmousedown: saveSelection,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point\x3d"addToTaskLink" class\x3d"headerIcon"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconToDos"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/span\x3e\n\t\t\t\t\t\t\x3c/span\x3e\n\t\t\t\t\t\t\x3cspan class\x3d"headerIcon" data-dojo-attach-event\x3d"onclick: popOut,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point\x3d"newWindowLink"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconPopout"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/span\x3e\n\t\t\t\t\t\t\x3cspan class\x3d"headerIcon" data-dojo-attach-event\x3d"onclick: showFullMessage,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point\x3d"fullMessageLink" title\x3d"${FullMessage}"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconPopout"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/span\x3e\n\t\t\t\t\t\x3c/span\x3e\x3c/td\x3e\n\t\t\t\t\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\n\t\t\t\x3c/div\x3e\n\t\t\x3c/div\x3e\n\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Pane" class\x3d"messageArea" data-dojo-attach-point\x3d"messageArea" tabindex\x3d0\x3e\n\t\t\t\x3cdiv class\x3d\'cardBox\'\x3e\n\t\t\t\t\x3cdiv class\x3d"header" data-dojo-attach-point\x3d"headerNode"\x3e\n\t\t\t\t\t\x3cdiv class\x3d"main" data-dojo-attach-point\x3d"mainHeaderNode"\x3e\n\t\t\t\t\t\t\x3cdiv class\x3d"headerLinksNode" data-dojo-attach-point\x3d"headerLinksNode"\x3e\n\t\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fullDateField" class\x3d"fullDateField"\x3e\x3c/div\x3e\n\t\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"shortHeaderContainer" class\x3d"shortHeader"\x3e\n\t\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"shortHeaderNode"\x3e\x3c/span\x3e\n\t\t\t\t\t\t\t\x3cspan class\x3d"showFullHeader" data-dojo-attach-event\x3d"onclick: showFullHeader"\x3e\n\t\t\t\t\t\t\t\t\x3cspan class\x3d"wsLink moreLessLink" title\x3d"${MoreInfoTip}"\x3e${showDetails}\x3c/span\x3e\x3csvg class\x3d"svgIcon moreLinkArrow"\x3e\x3cuse xlink:href\x3d"#iconDown"\x3e\x3c/use\x3e\x3c/svg\x3e\n\t\t\t\t\t\t\t\x3c/span\x3e\n\t\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"showSlideShowLnk" data-dojo-attach-event\x3d"onclick: showImageSlideshow" class\x3d"wsLink showSlideShow" title\x3d"${showSlideShowTip}"\x3e${showSlideShow}\x3c/span\x3e\n\t\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\t\t\x3ctable data-dojo-attach-point\x3d"fullFromTable" class\x3d"fullFromTable" style\x3d"display: none"\x3e\n\t\t\t\t\t\t\t\x3ctr data-dojo-attach-point\x3d"fromRow" class\x3d"fieldRow" style\x3d"display: none"\x3e\n\t\t\t\t\t\t\t\t\x3ctd data-dojo-attach-point\x3d"fullFromNode" colspan\x3d"2"\x3e\n\t\t\t\t\t\t\t\t\t\x3cspan class\x3d"flag" data-dojo-attach-point\x3d"flagIconFull"\x3e\x3csvg class\x3d"svgIcon"\x3e\x3cuse xlink:href\x3d"#iconFlag"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/span\x3e\n\t\t\t\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"fullFromNode"\x3e\x3c/span\x3e\x3cspan data-dojo-attach-event\x3d"onclick: showShortHeader"\x3e\x3cspan class\x3d"wsLink moreLessLink" title\x3d"${HideDetailsTip}"\x3e${hideDetails}\x3c/span\x3e\x3csvg class\x3d"svgIcon lessLinkArrw"\x3e\x3cuse xlink:href\x3d"#iconDown"\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/span\x3e\n\t\t\t\t\t\t\t\t\x3c/td\x3e\n\t\t\t\t\t\t\t\x3c/tr\x3e\n\t\t\t\t\t\t\t\x3ctr data-dojo-attach-point\x3d"toRow" class\x3d"fieldRow" style\x3d"display: none"\x3e\n\t\t\t\t\t\t\t\t\x3ctd class\x3d"label"\x3e\n\t\t\t\t\t\t\t\t\t${To}\n\t\t\t\t\t\t\t\t\x3c/td\x3e\n\t\t\t\t\t\t\t\t\x3ctd data-dojo-attach-point\x3d"fullToNode"\x3e\n\t\t\t\t\t\t\t\t\x3c/td\x3e\n\t\t\t\t\t\t\t\x3c/tr\x3e\n\t\t\t\t\t\t\t\x3ctr data-dojo-attach-point\x3d"ccRow" class\x3d"fieldRow" style\x3d"display: none"\x3e\n\t\t\t\t\t\t\t\t\x3ctd class\x3d"label"\x3e\n\t\t\t\t\t\t\t\t\t${Cc}\n\t\t\t\t\t\t\t\t\x3c/td\x3e\n\t\t\t\t\t\t\t\t\x3ctd data-dojo-attach-point\x3d"fullCcNode"\x3e\n\t\t\t\t\t\t\t\t\x3c/td\x3e\n\t\t\t\t\t\t\t\x3c/tr\x3e\n\t\t\t\t\t\t\t\x3ctr data-dojo-attach-point\x3d"bccRow" class\x3d"fieldRow" style\x3d"display: none"\x3e\n\t\t\t\t\t\t\t\t\x3ctd class\x3d"label"\x3e\n\t\t\t\t\t\t\t\t\t${Bcc}\n\t\t\t\t\t\t\t\t\x3c/td\x3e\n\t\t\t\t\t\t\t\t\x3ctd data-dojo-attach-point\x3d"fullBccNode"\x3e\n\t\t\t\t\t\t\t\t\x3c/td\x3e\n\t\t\t\t\t\t\t\x3c/tr\x3e\n\t\t\t\t\t\t\t\x3ctr data-dojo-attach-point\x3d"slideShowRow" class\x3d"fieldRow" style\x3d"display: none"\x3e\n\t\t\t\t\t\t\t\t\x3ctd data-dojo-attach-point\x3d"slideShowShowLink" colspan\x3d"2"\x3e\n\t\t\t\t\t\t\t\t\t\x3cspan data-dojo-attach-event\x3d"onclick: showImageSlideshow" class\x3d"wsLink" title\x3d"${showSlideShowTip}"\x3e${showSlideShow}\x3c/span\x3e\n\t\t\t\t\t\t\t\t\x3c/td\x3e\n\t\t\t\t\t\t\t\x3c/tr\x3e\n\t\t\t\t\t\t\x3c/table\x3e\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"attachmentsRow" class\x3d"attachmentsRow" style\x3d"display: none"\x3e\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3cdiv class\x3d"bodyContainer" data-dojo-attach-point\x3d"bodyCont"\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3cdiv class\x3d"inlineCompose_bar" data-dojo-attach-point\x3d"inlineComposeBar" style\x3d"display:none;position:relative;"\x3e\n\t\t\t\t\t\x3cdiv\x3e\n\t\t\t\t\t\t\x3cspan class\x3d"inlineCompose_barButton" data-dojo-attach-event\x3d\'onclick:inlineReply, onMouseDown: saveSelection\' title\x3d"${DisplayReply}"\x3e\n\t\t\t\t\t\t\t\x3csvg class\x3d\'inlineCompose_barBtnIcon\'\x3e\x3cuse xlink:href\x3d\'#iconReply\'/\x3e\x3c/svg\x3e\n\t\t\t\t\t\t\t\x3cspan class\x3d"inlineCompose_barBtnLabel"\x3e${DisplayReply}\x3c/span\x3e\n\t\t\t\t\t\t\x3c/span\x3e\n\t\t\t\t\t\t\x3cspan class\x3d"inlineCompose_barButton" data-dojo-attach-event\x3d\'onclick:inlineReplyAll, onMouseDown: saveSelection\' title\x3d"${DisplayReplyAll}"\x3e\n\t\t\t\t\t\t\t\x3csvg class\x3d\'inlineCompose_barBtnIcon\'\x3e\x3cuse xlink:href\x3d\'#iconReplyAll\'/\x3e\x3c/svg\x3e\n\t\t\t\t\t\t\t\x3cspan class\x3d"inlineCompose_barBtnLabel"\x3e${DisplayReplyAll}\x3c/span\x3e\n\t\t\t\t\t\t\x3c/span\x3e\n\t\t\t\t\t\t\x3cspan class\x3d"inlineCompose_barButton" data-dojo-attach-event\x3d\'onclick:inlineForward, onMouseDown: saveSelection\' title\x3d"${DisplayForward}"\x3e\n\t\t\t\t\t\t\t\x3csvg class\x3d\'inlineCompose_barBtnIcon\'\x3e\x3cuse xlink:href\x3d\'#iconForward\'/\x3e\x3c/svg\x3e\n\t\t\t\t\t\t\t\x3cspan class\x3d"inlineCompose_barBtnLabel"\x3e${DisplayForward}\x3c/span\x3e\n\t\t\t\t\t\t\x3c/span\x3e\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3cdiv class\x3d"inlineCompose" data-dojo-attach-point\x3d"inlineCompose" style\x3d"display:none;"\x3e\x3c/div\x3e\n\t\t\t\x3c/div\x3e\n\t\t\x3c/div\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\n\n',
"url:ws/mail/DisplayMessageWidget.css":"","url:ws/address/PeoplePanelAddContactCard.html":'\x3cdiv class\x3d"peoplePanelAddContactCard hoverCard"\x3e\n\t\x3cdiv class\x3d"wsCloseBtn" data-dojo-attach-event\x3d"onclick: close"\x3e\x3csvg class\x3d\'svgIcon\'\x3e\x3cuse xlink:href\x3d\'#iconClose\'\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/div\x3e\n\t\x3cdiv class\x3d"contentDiv" data-dojo-attach-point\x3d"contentDiv"\x3e\n\t\t\x3ctable data-dojo-attach-point\x3d"inputTable"\x3e\n\t\t\t\x3ctr\x3e\n\t\t\t\t\x3ctd\x3e${Name}\x3c/td\x3e\n\t\t\t\t\x3ctd colspan\x3d"2"\x3e\n\t\t\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/DefaultTextbox" data-dojo-props\x3d"\'class\': \'nameInput ieFirstNameInput\'" data-dojo-attach-point\x3d"firstNameInput" maxlength\x3d"255" defaultValue\x3d"${FirstName}" tabindex\x3d"200"\x3e\x3c/div\x3e\n\t\t\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/DefaultTextbox" data-dojo-props\x3d"\'class\': \'nameInput\'" data-dojo-attach-point\x3d"lastNameInput" maxlength\x3d"255" defaultValue\x3d"${LastName}" tabindex\x3d"201"\x3e\x3c/div\x3e\n\t\t\t\t\x3c/td\x3e\n\t\t\t\x3c/tr\x3e\n\t\t\t\x3ctr\x3e\n\t\t\t\t\x3ctd\x3e${Email}\x3c/td\x3e\n\t\t\t\t\x3ctd colspan\x3d"2"\x3e\x3cinput type\x3d"text" maxlength\x3d"255" data-dojo-attach-point\x3d"emailInput" class\x3d"wsInput emailInput" tabindex\x3d"202"\x3e\x3c/td\x3e\n\t\t\t\x3c/tr\x3e\n\t\t\t\x3ctr\x3e\n\t\t\t\t\x3ctd\x3e${Phone}\x3c/td\x3e\n\t\t\t\t\x3ctd style\x3d"width:130px"\x3e\x3cinput type\x3d"text" maxlength\x3d"255" data-dojo-attach-point\x3d"phoneInput" class\x3d"wsInput" tabindex\x3d"203"\x3e\x3c/td\x3e\n\t\t\t\t\x3ctd style\x3d"width:170px"\x3e\n\t\t\t\t\t\x3cul data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-attach-point\x3d"phoneTypeSelect" style\x3d"margin-left:3px"\x3e\n\t\t\t\t\t\t\x3cli value\x3d"Cellular"\x3e${Cellular}\x3c/li\x3e\n\t\t\t\t\t\t\x3cli value\x3d"Home"\x3e${Home}\x3c/li\x3e\n\t\t\t\t\t\t\x3cli value\x3d"Work"\x3e${Work}\x3c/li\x3e\n\t\t\t\t\t\t\x3cli value\x3d"Pager"\x3e${Pager}\x3c/li\x3e\n\t\t\t\t\t\t\x3cli value\x3d"Fax"\x3e${Fax}\x3c/li\x3e\n\t\t\t\t\t\x3c/ul\x3e\n\t\t\t\t\x3c/td\x3e\n\t\t\t\x3c/tr\x3e\n\t\t\t\x3ctr\x3e\n\t\t\t\x3ctd\x3e\n\t\t\t\t\x3cspan class\x3d"wsLink moreDetailsLink" data-dojo-attach-event\x3d"onclick: moreDetails"\x3e${MoreDetails2}\x3c/span\x3e\n\t\t\t\x3c/td\x3e\n\t\t\t\x3ctd colspan\x3d"2"\x3e\n\t\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: checkRequiredFields"\x3e${AddContact}\x3c/div\x3e\n\t\t\t\x3c/td\x3e\n\t\t\t\x3c/tr\x3e\n\t\t\x3c/table\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\n',
"url:ws/address/PeoplePanel.css":"","url:ws/mail/AddTaskCard.html":'\x3cdiv class\x3d"addTaskCard"\x3e\n\t\x3cdiv class\x3d"todoPanelLabelDiv" data-dojo-attach-point\x3d"todoPanelLabelDiv"\x3e\n\t\t\x3cspan class\x3d"todoPanelLabel"\x3e${Panel_TodoLabel}\x3c/span\x3e\n\t\t\x3cdiv class\x3d"wsSmallCloseBtn" data-dojo-attach-event\x3d"onclick:close"\x3e\x3csvg class\x3d\'svgIcon\'\x3e\x3cuse xlink:href\x3d\'#iconClose\'\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/div\x3e\n\t\x3c/div\x3e\n\t\x3cdiv class\x3d"wsInput addTaskInput"\x3e\n\t\t\x3cinput type\x3d"text" data-dojo-attach-point\x3d"addTaskInputNode" maxlength\x3d"100" data-dojo-attach-event\x3d"onfocus: onFocus, onblur: onBlur, onkeypress: onAddTaskKeyPress" class\x3d"default wsInputBare"/\x3e\n\t\t\x3cdiv title\x3d"${EnterTask}" class\x3d"wsSmallAddButton" data-dojo-attach-point\x3d"addTaskImage" data-dojo-attach-event\x3d"onclick:onClickAddFromInput"\x3e\x3csvg class\x3d\'svgIcon\'\x3e\x3cuse xlink:href\x3d\'#iconAdd\'\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/div\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\n',
"url:ws/mail/AddTaskCard.css":"","url:ws/calendar/AddEventDialog.html":'\x3cdiv class\x3d"addEditEvent WSModalPane" data-dojo-attach-point\x3d"addDialogWidget"\x3e\n\t\x3cdiv style\x3d"overflow: hidden;" data-dojo-attach-event\x3d"onkeypress:onKeyPress,onkeydown:onKeyPress"\x3e\n\t\t\x3cdiv class\x3d"WSModalPaneInner"\x3e\n\t\t\t\x3cdiv class\x3d"wsCloseBtn" data-dojo-attach-event\x3d"onclick:hide"\x3e\x3csvg class\x3d\'svgIcon\'\x3e\x3cuse xlink:href\x3d\'#iconClose\'\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"modalContainer" data-dojo-attach-point\x3d"modalContainer"\x3e\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"dlgTitleDiv"\x3e\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"dlgTitleAdd" class\x3d"dlgTitle"\x3e${AddEventBtn}\x3c/div\x3e\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"dlgTitleEdit" class\x3d"dlgTitle" style\x3d"display:none"\x3e${EditEvent}\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"contentPane" class\x3d"inputData"\x3e\n                    \x3cinput type\x3d"text" class\x3d"wsInput summaryInput" maxlength\x3d"100" data-dojo-attach-point\x3d"summaryInput" data-dojo-attach-event\x3d"onclick:summaryTextClick,onblur:summaryTextBlur,onkeypress:summaryKeyPress" /\x3e\n                    \x3cdiv class\x3d"dateTimeDiv"\x3e\n                        \x3cinput type\x3d"text" class\x3d"wsInput dateInputField" data-dojo-attach-point\x3d"startDateInput" /\x3e\n                        \x3cinput type\x3d"text" class\x3d"wsInput timeInputField" data-dojo-attach-point\x3d"startTimeInput" /\x3e\n                        \x3cspan style\x3d"padding-bottom:2px" data-dojo-attach-point\x3d"toSpan" style\x3d"display:none"\x3e${CalTo}\x3c/span\x3e\n                        \x3cinput type\x3d"text" class\x3d"wsInput timeInputField" data-dojo-attach-point\x3d"endTimeInput" /\x3e\n                        \x3cinput type\x3d"text" class\x3d"wsInput dateInputField" data-dojo-attach-point\x3d"endDateInput" style\x3d"display:none" /\x3e\n\n                    \x3c/div\x3e\n\n                    \x3cdiv class\x3d"allDayDiv"\x3e\n                        \x3cdiv data-dojo-type\x3d"ws/widget/Checkbox" data-dojo-attach-event\x3d"onClick:checkBoxChange" data-dojo-attach-point\x3d"allDayBox" label\x3d"${AllDay}" uncheckedClass\x3d"checkBoxNotChecked"\x3e\x3c/div\x3e\n                    \x3c/div\x3e\n\n                    \x3cdiv class\x3d"menuDivs"\x3e\n                        \x3cdiv data-dojo-type\x3d"ws/calendar/CalendarSelect" data-dojo-attach-point\x3d"calendarMenu" class\x3d"calendarList"\x3e\x3c/div\x3e\n                    \x3c/div\x3e\n\n                    \x3cdiv class\x3d"separator"\x3e\x3c/div\x3e\n\n                    \x3cdiv data-dojo-attach-point\x3d"repeatDiv" class\x3d"menuDivs"\x3e\n                        \x3cul data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-props\x3d"\'class\': \'selectMenu\'" data-dojo-attach-point\x3d"repeatMenu" size\x3d"byValue"\x3e\n                            \x3cli value\x3d"doesNotRepeat"\x3e${DoesNotRepeat}\x3c/li\x3e\n                            \x3cli value\x3d"everyDay"\x3e${EveryDay}\x3c/li\x3e\n                            \x3cli value\x3d"everyWeek"\x3e${EveryWeek}\x3c/li\x3e\n                            \x3cli value\x3d"everyMonth"\x3e${EveryMonth}\x3c/li\x3e\n                            \x3cli value\x3d"everyYear"\x3e${EveryYear}\x3c/li\x3e\n                            \x3cli value\x3d"customRepeat"\x3e${CustomRepeat}\x3c/li\x3e\n                        \x3c/ul\x3e\n\n                        \x3cdiv class\x3d"customDialog" data-dojo-attach-point\x3d"repeatDialog" style\x3d"display:none;overflow: auto;"\x3e\n                            \x3cdiv style\x3d"clear:both;overflow: auto;"\x3e\n                                \x3cspan class\x3d"spanText"\x3e${Every}\x26nbsp;\x3c/span\x3e\n                                \x3cinput type\x3d"text" class\x3d"wsInput everyInput" data-dojo-attach-point\x3d"repeatEveryInput" /\x3e\n                                \x3cul data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-attach-point\x3d"repeatEveryMenu" data-dojo-props\x3d"\'class\': \'repeatOption\'" size\x3d"byValue"\x3e\n                                    \x3cli value\x3d"repeatEveryDay"\x3e${day}\x3c/li\x3e\n                                    \x3cli value\x3d"repeatEveryWeek"\x3e${week}\x3c/li\x3e\n                                    \x3cli value\x3d"repeatEveryMonth"\x3e${month}\x3c/li\x3e\n                                    \x3cli value\x3d"repeatEveryYear"\x3e${year}\x3c/li\x3e\n                                \x3c/ul\x3e\n                            \x3c/div\x3e\n                            \x3cdiv data-dojo-attach-point\x3d"dayIntervalSelect" class\x3d"dayIntervalSelect" style\x3d"overflow: hidden;"\x3e\n                                \x3cspan class\x3d"spanText" data-dojo-attach-point\x3d"onTextSpan"\x3e${CalendarOn}:\x3c/span\x3e\n                                \x3cspan class\x3d"pickDaySpan" data-dojo-attach-point\x3d"day0Span"\x3e\x3c/span\x3e\n                                \x3cspan class\x3d"pickDaySpan" data-dojo-attach-point\x3d"day1Span"\x3e\x3c/span\x3e\n                                \x3cspan class\x3d"pickDaySpan" data-dojo-attach-point\x3d"day2Span"\x3e\x3c/span\x3e\n                                \x3cspan class\x3d"pickDaySpan" data-dojo-attach-point\x3d"day3Span"\x3e\x3c/span\x3e\n                                \x3cspan class\x3d"pickDaySpan" data-dojo-attach-point\x3d"day4Span"\x3e\x3c/span\x3e\n                                \x3cspan class\x3d"pickDaySpan" data-dojo-attach-point\x3d"day5Span"\x3e\x3c/span\x3e\n                                \x3cspan class\x3d"pickDaySpan" data-dojo-attach-point\x3d"day6Span"\x3e\x3c/span\x3e\n                            \x3c/div\x3e\n                            \x3cdiv data-dojo-attach-point\x3d"monthIntervalSelect" class\x3d"monthIntervalSelect" style\x3d"display:none"\x3e\n                                \x3cinput name\x3d"monthSelect" type\x3d"radio" data-dojo-attach-event\x3d"onchange:monthButtonChange" data-dojo-attach-point\x3d"customMonthDateButton" /\x3e\n                                \x3cspan data-dojo-attach-point\x3d"customMonthDate"\x3eon the 15th\x26nbsp;\x3c/span\x3e\n                                \x3cinput name\x3d"monthSelect" type\x3d"radio" data-dojo-attach-event\x3d"onchange:monthButtonChange" data-dojo-attach-point\x3d"customMonthDayButton" /\x3e\n                                \x3cspan data-dojo-attach-point\x3d"customMonthDay"\x3eon the fourth Monday\x3c/span\x3e\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"endMenuRow"\x3e\n                                \x3cul data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-props\x3d"\'class\': \'zeroMarginLeft\'" data-dojo-attach-point\x3d"endDateMenu" size\x3d"byValue"\x3e\n                                    \x3cli value\x3d"noEndDate"\x3e${NoEndDate}\x3c/li\x3e\n                                    \x3cli value\x3d"repeatUntil"\x3e${RepeatUntil}\x3c/li\x3e\n                                \x3c/ul\x3e\n                                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"endRepeatDateInput" class\x3d"wsInput dateInputField" /\x3e\n                            \x3c/div\x3e\n                        \x3c/div\x3e\n                        \x3cdiv data-dojo-attach-point\x3d"repeatCustomSummary" class\x3d"customSummaryDiv" style\x3d"display:none"\x3e\n                            \x3cspan data-dojo-attach-point\x3d"repeatEverySummarySpan"\x3e\x3c/span\x3e\n                        \x3c/div\x3e\n                    \x3c/div\x3e\n\n                    \x3cdiv class\x3d"separator"\x3e\x3c/div\x3e\n\n                    \x3cdiv data-dojo-attach-point\x3d"remindRow" class\x3d"menuDivs"\x3e\n                        \x3cul data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-props\x3d"\'class\': \'selectMenu\'" data-dojo-attach-point\x3d"reminderMenu" size\x3d"byValue"\x3e\x3c/ul\x3e\n                        \x3cdiv data-dojo-attach-point\x3d"remindDialog" class\x3d"customDialog" style\x3d"display:none"\x3e\n                            \x3ctable data-dojo-attach-point\x3d"repeatTable" border\x3d"0" style\x3d"width:100%"\x3e\n                                \x3ctr\x3e\n                                    \x3ctd width\x3d"14" align\x3d"left"\x3e\n                                        \x3cinput type\x3d"text" data-dojo-attach-point\x3d"remindInput" class\x3d"wsInput remindAt" /\x3e\n                                    \x3c/td\x3e\n                                    \x3ctd align\x3d"left"\x3e\n                                        \x3cul data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-attach-point\x3d"customRemindMenu" data-dojo-props\x3d"\'class\': \'customReminderMenu\'" size\x3d"byValue"\x3e\x3c/ul\x3e\n                                        \x3cspan data-dojo-attach-point\x3d"customRemindBeforeSpan" class\x3d"remindBeforeSpan" style\x3d"display:none"\x3e${Before}\x3c/span\x3e\n                                        \x3cinput type\x3d"text" class\x3d"wsInput dateInputField remindBeforeInput" data-dojo-attach-point\x3d"remindAtEndInput" style\x3d"display:none" /\x3e\n                                    \x3c/td\x3e\n                                \x3c/tr\x3e\n                            \x3c/table\x3e\n                        \x3c/div\x3e\n                     \x3c/div\x3e\n\n                    \x3cdiv data-dojo-attach-point\x3d"remindSummaryRow" style\x3d"display:none" class\x3d"customSummaryDiv"\x3e\n                        \x3cspan data-dojo-attach-point\x3d"remindSummarySpan"\x3e\x3c/span\x3e\n                    \x3c/div\x3e\n                    \x3cdiv class\x3d"separator"\x3e\x3c/div\x3e\n                    \x3cdiv data-dojo-attach-point\x3d"locationRow" class\x3d"menuDivs"\x3e\n                        \x3cinput type\x3d"text" class\x3d"wsInput addLocationInputShowNew" data-dojo-attach-event\x3d"onclick:locationTextType" data-dojo-attach-point\x3d"addLocationInputArea" /\x3e\n                        \x3cspan class\x3d"ctrl wsLink" data-dojo-attach-point\x3d"mapLink" data-dojo-attach-event\x3d"onclick:showMapLink"\x3e${ShowMapLink}\x3c/span\x3e\n                    \x3c/div\x3e\n                    \x3cdiv class\x3d"separator"\x3e\x3c/div\x3e\n                    \x3cdiv class\x3d"menuDivs"\x3e\n                        \x3cdiv class\x3d"notesDiv"\x3e\n                            \x3cdiv defaultValue\x3d"${AddNoteHere}" class\x3d"addNotesInputShow" data-dojo-attach-point\x3d"addNotesInput" data-dojo-type\x3d"ws/widget/DefaultTextarea"\x3e\x3c/div\x3e\n                        \x3c/div\x3e\n                    \x3c/div\x3e\n\n                    \x3cdiv data-dojo-type\x3d"ws/widget/WSToolbar" data-dojo-attach-point\x3d"toolbar" data-dojo-props\x3d"region:\'top\'" vizType\x3d"Bare"\x3e\n                        \x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-point\x3d"saveButton" data-dojo-attach-event\x3d"onClick:saveAndClose" data-dojo-props\x3d"toolbarPosition: \'right\'"\x3e${AddEventBtn}\x3c/div\x3e\n                    \x3c/div\x3e\n\n    \t\t\t\x3c/div\x3e\n                \x3cdiv data-dojo-type\x3d"ws/widget/PopupDatePicker" data-dojo-attach-point\x3d"eventDatePopupPicker" hidePickerOnSetDate\x3d"true" closeOnMouseOut\x3d"true"\x3e\x3c/div\x3e\n                \x3cdiv data-dojo-type\x3d"ws/widget/PopupTimePicker" data-dojo-attach-point\x3d"eventTimePopupPicker" hidePickerOnSetTime\x3d"true" closeOnMouseOut\x3d"true"\x3e\x3c/div\x3e\n            \x3c/div\x3e\n\t\t\x3c/div\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\n',
"url:ws/calendar/AddEventDialog.css":"","url:ws/calendar/CalendarSelect.css":"","url:ws/mail/ComposeMessageWidget.html":'\x3cdiv data-dojo-attach-event\x3d"onkeydown: onKeyPressInputField"\x3e\n\t\x3c!-- NOTE  when used as InlineCompose, BorderContainer is changed to a Pane in constructor method, careful with changes here --\x3e\n\t\x3cdiv data-dojo-type\x3d"dijit/layout/BorderContainer" data-dojo-attach-point\x3d"layoutWidget" class\x3d"composeMessage"\x3e\n\t\t\x3cdiv data-dojo-type\x3d"ws/widget/WSToolbar" data-dojo-props\x3d"region:\'top\'" data-dojo-attach-point\x3d"toolbar" vizType\x3d"Controls"\x3e\n\t\t\t\x3c!-- id\x3d"sendButton" the id on this button is for Oasis scripting --removed to allow eventually having concurrent compose widgets --\x3e\n\t\t\t\x3cdiv class\x3d"invertBtn orientH sendButton" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:sendMessage" tip\x3d"${ComposeSendButton}" svgID\x3d"iconSend"\x3e${Button_Label_Send}\x3c/div\x3e\n\t\t\t\x3cdiv style\x3d"display:none" class\x3d"saveDraftButton" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:saveMessage" title\x3d"${SaveDraftTip}" tip\x3d"${ComposeSaveAsDraftButton}" svgID\x3d"iconSave"\x3e${Save}\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"spellCheckButton" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:spellCheck" svgID\x3d"iconSpell"\x3e${ComposeSpellingButton}\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"attachFile" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: openAttachFileDialog" title\x3d"${ChooseFileTooltip}" tip\x3d"${ChooseFileTooltip}" svgID\x3d"iconAttach"\x3e${ChooseFile}\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"inlineImage" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: openInsertPictureDialog" title\x3d"${YGP_OpenPickerTooltip}" tip\x3d"${YGP_OpenPickerTooltip}" svgID\x3d"iconInlineImage"\x3e${YGP_OpenPickerButton}\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"toggleFormat" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:toggleFormatBar" svgID\x3d"iconToggleFormat"\x3e${FormattingToolbar}\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"deleteDraftButton" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:deleteDraft" svgID\x3d"iconTrash" tip\x3d"${ComposeDeleteDraftButton}"\x3e${ComposeDeleteDraftButton}\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"invertBtn cancelButton" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:cancel" title\x3d"${Cancel}" svgID\x3d"iconClose" data-dojo-props\x3d"toolbarPosition: \'right\'"\x3e\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"invertBtn newWindowLink" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:onClickNewWindow" title\x3d"${NewWindowTip}" svgID\x3d"iconPopout" data-dojo-props\x3d"toolbarPosition: \'right\'"\x3e${NewWindow}\x3c/div\x3e\n\t\t\x3c/div\x3e\n\t\t\x3cdiv class\x3d"toastComposeTitleBar" data-dojo-type\x3d"ws/widget/WSToolbar" data-dojo-props\x3d"region:\'top\'" data-dojo-attach-point\x3d"toastTitleBar" data-dojo-attach-event\x3d"onClick:onClickToastTitleBar" vizType\x3d"Controls" noLabels\x3d"1" alwaysShowRightNode\x3dfalse style\x3d"display:none"\x3e\n\t\t\t\x3cspan class\x3d"toastTitle" data-dojo-type\x3d"dijit/_Widget" data-dojo-attach-point\x3d"toastTitle" data-dojo-props\x3d"toolbarPosition: \'left\'"\x3e${ToastTitle}\x3c/span\x3e\n\t\t\t\x3cdiv class\x3d"wsToolbarControls wsIconButton invertBtn" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:cancel" tip\x3d"${Close}" svgID\x3d"iconClose" data-dojo-props\x3d"toolbarPosition: \'right\'" shortButton\x3d"true"\x3e\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"wsToolbarControls wsIconButton invertBtn newWindowLink" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:onClickOpenFullPane" tip\x3d"${ExpandTip}" svgID\x3d"iconExpandView" data-dojo-props\x3d"toolbarPosition: \'right\'"  shortButton\x3d"true"\x3e\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"wsToolbarControls wsIconButton invertBtn minBtn" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:onClickMinView" data-dojo-attach-point\x3d"minimizeLink" tip\x3d"${MinimizeTip}" svgID\x3d"iconMinView" data-dojo-props\x3d"toolbarPosition: \'right\'" shortButton\x3d"true"\x3e\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"wsToolbarControls wsIconButton invertBtn rstBtn" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:onClickRestoreView" data-dojo-attach-point\x3d"restoreLink" tip\x3d"${RestoreTip}" svgID\x3d"iconRestoreView" data-dojo-props\x3d"toolbarPosition: \'right\'" shortButton\x3d"true"\x3e\x3c/div\x3e\n\t\t\x3c/div\x3e\n\t\t\x3cdiv class\x3d"composeContentArea"\x3e\n\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/Pane" data-dojo-props\x3d"region:\'top\'" class\x3d"header" data-dojo-attach-point\x3d"headerWidget"\x3e\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"headerWidgetContent"\x3e\n\t\t\t\t\t\x3cdiv class\x3d"frmFld field" data-dojo-attach-point\x3d"fromLine"\x3e\n\t\t\t\t\t\t\x3cdiv style\x3d"display:none" data-dojo-attach-point\x3d"fromAddressEditBoxDiv"\x3e\n\t\t\t\t\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/DefaultTextbox" data-dojo-attach-point\x3d"fromAddressEditBox" data-dojo-attach-event\x3d"onKeyPress:processEditBoxKeyPress, onBlur:saveFriendlyName" style\x3d"width:20%;float:left;padding:5px;" tabindex\x3d"99"\x3e\x3c/div\x3e\n\t\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\t\t\x3cdiv\x3e\n\t\t\t\t\t\t\t\x3ca href\x3d"#" class\x3d"fnameA" data-dojo-attach-event\x3d"onclick:fromAddressEdit" data-dojo-attach-point\x3d"fromAddressSpan"\x3e${friendlyFromName}\x3c/a\x3e\n\t\t\t\t\t\t\t\x3cdiv data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-attach-point\x3d"fromSelect" size\x3d"byValue"\x3e\x3c/div\x3e\n\t\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\t\t\x3cdiv class\x3d"feedback" data-dojo-attach-point\x3d"feedbackNode"\x3e\x3cspan class\x3d"feedbackSpin" data-dojo-attach-point\x3d"feedbackSpin" data-dojo-attach-point\x3d"feedbackSpin"\x3e\x3c/span\x3e\x3cspan class\x3d"feedbackMsg" data-dojo-attach-point\x3d"feedbackMsg"\x3e\x3c/span\x3e\x3c/div\x3e\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\t\x3cdiv ghostText\x3d"${To}" class\x3d"toField" data-dojo-type\x3d"ws/address/ComposeAddressField" data-dojo-attach-point\x3d"toField" lineHeight\x3d"14" data-dojo-props\x3d"tabindex: 100"\x3e\x3c/div\x3e\n\t\t\t\t\t\x3cdiv ghostText\x3d"${Cc}" class\x3d"ccField" data-dojo-type\x3d"ws/address/ComposeAddressField" data-dojo-attach-point\x3d"ccField" lineHeight\x3d"14" style\x3d"display:none" data-dojo-props\x3d"tabindex: 101"\x3e\x3c/div\x3e\n\t\t\t\t\t\x3cdiv ghostText\x3d"${Bcc}" class\x3d"bccField" data-dojo-type\x3d"ws/address/ComposeAddressField" data-dojo-attach-point\x3d"bccField" lineHeight\x3d"14" style\x3d"display:none" data-dojo-props\x3d"tabindex: 102"\x3e\x3c/div\x3e\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"subjectContainer" class\x3d"subjectContainer field wsInput"\x3e\n\t\t\t\t\t\t\x3cdiv class\x3d"subjectLabel"\x3e${Subject}:\x3c/div\x3e\n\t\t\t\t\t\t\x3cdiv style\x3d"overflow: hidden;"\x3e\x3cinput class\x3d"subject" type\x3d"text" name\x3d"Subject" data-dojo-attach-point\x3d"subjectInput" data-dojo-attach-event\x3d"onblur:updateToastTitle" tabindex\x3d"103" autocomplete\x3d"off"/\x3e\x3c/div\x3e\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"attachmentRow" style\x3d"display:none; position: relative;"\x3e\n\t\t\t\t\t\t\x3cdiv class\x3d"attachmentContainer"\x3e\n\t\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"attachmentDisplay"\x3e\x3c/span\x3e\n\t\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\t\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\x3c/div\x3e\n\t\t\t\x3cdiv  data-dojo-attach-point\x3d"editorDiv"\x3e\x3c/div\x3e\n\t\t\t\x3cdiv  data-dojo-attach-point\x3d"bottomTB" class\x3d"bottomTB"\x3e\n\t\t\t\t\x3cdiv class\x3d"inlineBottomTB" data-dojo-type\x3d"ws/widget/WSToolbar" data-dojo-props\x3d"region:\'bottom\'" data-dojo-attach-point\x3d"toastToolbar" vizType\x3d"Controls" inlineToolBar\x3d"${inlineToolBar}" noLabels\x3d"1" style\x3d"display:none"\x3e\n\t\t\t\t\t\x3cdiv class\x3d"invertBtn orientH sendButton" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:sendMessage" tip\x3d"" tipSide\x3d"top" svgID\x3d"iconSend"\x3e${Button_Label_Send}\x3c/div\x3e\n\t\t\t\t\t\x3cdiv style\x3d"display:none" class\x3d"saveDraftButton" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:saveMessage" title\x3d"${SaveDraftTip}" tip\x3d"${ComposeSaveAsDraftButton}" tipSide\x3d"top" svgID\x3d"iconSave"\x3e${Save}\x3c/div\x3e\n\t\t\t\t\t\x3cdiv class\x3d"spellCheckButton" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:spellCheck"  svgID\x3d"iconSpell" tipSide\x3d"top"\x3e${ComposeSpellingButton}\x3c/div\x3e\n\t\t\t\t\t\x3cdiv class\x3d"attachFile" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: openAttachFileDialog" title\x3d"${ChooseFileTooltip}" tip\x3d"${ChooseFileTooltip}" tipSide\x3d"top" svgID\x3d"iconAttach"\x3e${ChooseFile}\x3c/div\x3e\n\t\t\t\t\t\x3cdiv class\x3d"inlineImage" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick: openInsertPictureDialog" title\x3d"${YGP_OpenPickerTooltip}" tip\x3d"${YGP_OpenPickerTooltip}" tipSide\x3d"top" svgID\x3d"iconInlineImage"\x3e${YGP_OpenPickerButton}\x3c/div\x3e\n\t\t\t\t\t\x3cdiv class\x3d"toggleFormat" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:toggleFormatBar" tipSide\x3d"top" svgID\x3d"iconToggleFormat"\x3e${FormattingToolbar}\x3c/div\x3e\n\t\t\t\t\t\x3cdiv class\x3d"deleteDraftButton" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:deleteDraft" svgID\x3d"iconTrash" tip\x3d"${ComposeDeleteDraftButton}" tipSide\x3d"top" data-dojo-props\x3d"toolbarPosition: \'right\'"\x3e${ComposeDeleteDraftButton}\x3c/div\x3e\n\t\t\t\t\t\x3cdiv class\x3d"toolbarBtnDivider" data-dojo-type\x3d"ws/widget/Pane" data-dojo-props\x3d"toolbarPosition: \'right\'"\x3e\x3c/div\x3e\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"expandViewButton" class\x3d"expandViewButton" data-dojo-type\x3d"ws/widget/Button" data-dojo-attach-event\x3d"onClick:onClickOpenExpanded" tip\x3d"${ExpandTip}" tipSide\x3d"top" svgID\x3d"iconExpandView" data-dojo-props\x3d"toolbarPosition: \'right\'" style\x3d"display:none" shortButton\x3d"true"\x3e\x3c/div\x3e\n\t\t\t\t\x3c/div\x3e\n\t\t\t\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"pinnedTBSpaceNone" data-dojo-attach-point\x3d"bottomTBSpace"\x3e\x3c/div\x3e\n\t\t\x3c/div\x3e\n\t\x3c/div\x3e\n\t\x3cinput data-dojo-attach-point\x3d"focusInput" type\x3d"text" style\x3d"position:absolute;width:0;height:0;border:none;outline:none;padding: 0;margin: 0;"/\x3e\n\x3c/div\x3e\n',
"url:ws/mail/ComposeMessageWidget.css":"","url:ws/widget/SpellCheckEditor.css":"","url:ws/widget/WSEditor.html":'\x3cdiv class\x3d"editorId"\x3e\n\t\x3c!-- NOTE  when used as InlineCompose, BorderContainer is changed to a Pane in constructor method, careful with changes here --\x3e\n\x3cdiv class\x3d"wsEditor" data-dojo-type\x3d"dijit/layout/BorderContainer" data-dojo-attach-point\x3d"layoutWidget"\x3e\n    \x3cdiv data-dojo-type\x3d"ws/widget/Pane" data-dojo-attach-point\x3d"toolbarPaneParent" data-dojo-props\x3d"region:\'top\'" class\x3d"toolbarContainer"\x3e\n        \x3cdiv class\x3d"toolbar" data-dojo-attach-point\x3d"toolbarPane"\x3e\n\t\t\t\x3ca href\x3d"#" data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-attach-point\x3d"fontPicker" title\x3d"${FontType}" data-dojo-props\x3d"\'disableMouseStates\': \'true\',\'setPreventMouseDefault\': \'true\',\'class\': \'fontfamilyIcon\'" \x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-attach-point\x3d"fontSizePicker" title\x3d"${FontSize}" data-dojo-props\x3d"\'disableMouseStates\': \'true\',\'setPreventMouseDefault\': \'true\',\'class\': \'fontsizeIcon\'" \x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" data-dojo-attach-point\x3d"boldItem" title\x3d"${Bold}" data-dojo-attach-event\x3d"onclick: boldClick" class\x3d"boldIcon"\x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" data-dojo-attach-point\x3d"italicItem" title\x3d"${Italic}" data-dojo-attach-event\x3d"onclick: italicClick" class\x3d"italicIcon"\x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" data-dojo-attach-point\x3d"underlineItem" title\x3d"${Underline}" data-dojo-attach-event\x3d"onclick: underlineClick" class\x3d"underlineIcon"\x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" data-dojo-attach-point\x3d"forecolorItem" title\x3d"${FontColor}" data-dojo-attach-event\x3d"onclick: fontColorClick" class\x3d"forecolorIcon"\x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" data-dojo-attach-point\x3d"hilitecolorItem" title\x3d"${BackgroundColor}" data-dojo-attach-event\x3d"onclick: backgroundColorClick" class\x3d"hilitecolorIcon"\x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-attach-point\x3d"justifyPicker" title\x3d"${Alignment}" data-dojo-props\x3d"\'disableMouseStates\': \'true\',\'setPreventMouseDefault\': \'true\',\'class\': \'justifyIcon\'" \x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-attach-point\x3d"listPicker" title\x3d"${Lists}" data-dojo-props\x3d"\'disableMouseStates\': \'true\',\'setPreventMouseDefault\': \'true\',\'class\': \'insertListIcon\'" \x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" data-dojo-type\x3d"ws/widget/WSSelect" data-dojo-attach-point\x3d"indentPicker" title\x3d"${Indentation}" data-dojo-props\x3d"\'disableMouseStates\': \'true\',\'setPreventMouseDefault\': \'true\',\'class\': \'indentPickerIcon\'" \x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" title\x3d"${HorizontalRule}" data-dojo-attach-event\x3d"onclick: horizontalRuleClick" class\x3d"insertHorizontalRuleIcon"\x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" title\x3d"${InsertSmiley}" data-dojo-attach-event\x3d"onclick: smileyClick" class\x3d"smileyIcon" data-dojo-attach-point\x3d"smileyButton"\x3e\x26nbsp;\x3c/a\x3e\n            \x3ca href\x3d"#" title\x3d"${InsertLink}" data-dojo-attach-event\x3d"onclick: linkClick" class\x3d"linkIcon" data-dojo-attach-point\x3d"linkButton"\x3e\x26nbsp;\x3c/a\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e\n\t\x3cdiv class\x3d"wsInput contentEditDivPane" data-dojo-type\x3d"ws/widget/Pane" data-dojo-props\x3d"region:\'center\'" data-dojo-attach-point\x3d"contentEditDivPane"\x3e\n\t\t\x3cdiv class\x3d"contentEditDiv" data-dojo-attach-point\x3d"contentEditDiv" tabindex\x3d"${tabindex}" name\x3d"${id}_body"\x3e\x3c/div\x3e\n\t\x3c/div\x3e\n\t\x3cdiv class\x3d"wsInput textareaPane" data-dojo-type\x3d"ws/widget/Pane" data-dojo-props\x3d"region:\'center\'" data-dojo-attach-point\x3d"textareaPane" style\x3d"display: none; overflow: hidden;"\x3e\n\t\t\x3ctextarea class\x3d"wsInputBare" data-dojo-attach-point\x3d"textarea" tabindex\x3d"105"\x3e\x3c/textarea\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\n\x3c/div\x3e\n',
"url:ws/widget/WSEditor.css":"","url:ws/widget/WSEditorDocument.css":'html, body {padding: 0 0 0 0; margin: 0; border: none; font-family: Helvetica,Arial,sans-serif; font-size: 10pt;}body {padding: 15px 15px 15px 15px;}p {margin: 0; padding: 0;}a.spell {padding-bottom: 2px; background: yellow url("${affinityimages}bg_spellingErr.gif") bottom left repeat-x; color: #000; text-decoration: none; cursor: pointer;}a.spell:hover {color: #b00;}img.wsThumbnail {display: none;}img.wsPlaceholder {background-color: #F4F4F4; border: 1px solid #DADAD6 !important;}.AOLPicturesFullSizeLink {height: 1px; width: 1px; overflow: hidden;}',
"url:ws/widget/LinkEditor.html":'\x3cdiv class\x3d"wsMenu" style\x3d"background:#fff;width:290px;padding:8px 5px"\x3e\n  \x3cdiv class\x3d"wsCloseBtn" data-dojo-attach-event\x3d"onclick: handleCloseX"\x3e\x3csvg class\x3d\'svgIcon\'\x3e\x3cuse xlink:href\x3d\'#iconClose\'\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"contentDiv" data-dojo-attach-point\x3d"contentDiv"\x3e\n\t\x3ctable data-dojo-attach-point\x3d"inputTable"\x3e\n\t  \x3ctbody\x3e\n\t\t\x3ctr\x3e\n\t\t  \x3ctd\x3e${LinkText}\x3c/td\x3e\n\t\t\x3c/tr\x3e\n\t\t\x3ctr\x3e\n\t\t  \x3ctd\x3e\x3cdiv data-dojo-type\x3d"ws/widget/DefaultTextbox" maxlength\x3d"255" fieldWidth\x3d"250px" data-dojo-attach-point\x3d"linkText" tabindex\x3d"232"\x3e\x3c/div\x3e\x3c/td\x3e\n\t\t\x3c/tr\x3e\n\t\t\x3ctr\x3e\n\t\t  \x3ctd\x3e${LinkTo}:\x26nbsp;\x3cbr style\x3d"display:none"\x3e\n\t\t\t\x3cinput name\x3d"scheme" value\x3d"${WebSite}" tabindex\x3d"233" type\x3d"radio" checked\x3e\x26nbsp;${WebSite}\n\t\t\t\x3cinput name\x3d"scheme" value\x3d"${EmailAddress}" tabindex\x3d"234" type\x3d"radio"\x3e\x26nbsp;${EmailAddress}\n\t\t  \x3c/td\x3e\n\t  \x3c/tr\x3e\n\t\t\x3ctr\x3e\n\t\t  \x3ctd\x3e\x3cdiv data-dojo-type\x3d"ws/widget/DefaultTextbox" maxlength\x3d"1024" fieldWidth\x3d"250px" data-dojo-attach-point\x3d"link" tabindex\x3d"235"\x3e\x3c/div\x3e\x3c/td\x3e\n\t\t\x3c/tr\x3e\n\t\t\x3ctr\x3e\n\t\t  \x3ctd style\x3d"margin-top:2px"\x3e\x3cdiv data-dojo-type\x3d"ws/widget/Button" data-dojo-props\x3d"toolbarPosition: \'right\'" style\x3d"float: right;" tabindex\x3d"236" data-dojo-attach-point\x3d"okButton"\x3e${OK}\x3c/div\x3e\x3c/td\x3e\n\t\t\x3c/tr\x3e\n\t  \x3c/tbody\x3e\n\t\x3c/table\x3e\n  \x3c/div\x3e\n\x3c/div\x3e\n',
"url:ws/pictures/PictureEditControl.html":'\x3cdiv class\x3d"pictureEditControl" style\x3d"display: none;"\x3e\n    \x3cdiv class\x3d"bkgndLayer" data-dojo-attach-point\x3d"bkgndLayerNode"\x3e\x3c/div\x3e\n\t\t\x3cdiv class\x3d"buttons" data-dojo-attach-point\x3d"buttons"\x3e\n\t\t\t\x3ca href\x3d"#" data-dojo-attach-point\x3d"optionsBtn" class\x3d"options" data-dojo-attach-event\x3d"onclick: showMenu"\x3e\x3csvg class\x3d\'svgIcon\'\x3e\x3cuse xlink:href\x3d\'#iconOption\'\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/a\x3e\n\t\t\t\x3ca href\x3d"#" class\x3d"delete" data-dojo-attach-point\x3d"deleteButton"\x3e\x3csvg class\x3d\'svgIcon\'\x3e\x3cuse xlink:href\x3d\'#iconClose\'\x3e\x3c/use\x3e\x3c/svg\x3e\x3c/a\x3e\n\t\t\x3c/div\x3e\n\x3c/div\x3e\n',
"url:ws/pictures/PictureEditControl.css":""}});define("release/DisplayMessage",[],1);
//# sourceMappingURL=DisplayMessage.js.map